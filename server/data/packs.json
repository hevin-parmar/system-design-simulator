{
  "packs": [
    {
      "id": "analytics-pipeline",
      "title": "Design Analytics Pipeline",
      "problemStatement": "Design Design Analytics Pipeline\nDesign Design Analytics Pipeline\nDesign Design Analytics Pipeline\nCollect and process event data at scale.",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "queue",
            "label": "Queue",
            "category": "messaging",
            "description": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "data": {
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "details": {
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Backlog growth if consumer slow; DLQ for poison msgs"
                },
                {
                  "type": "FR",
                  "text": "Async task buffering and decoupling"
                },
                {
                  "type": "NFR",
                  "text": "Smooths traffic spikes"
                }
              ],
              "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "description": "Consumes async jobs/events; performs background processing.",
            "data": {
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "At-least-once; idempotency required"
                },
                {
                  "type": "FR",
                  "text": "Background processing of async jobs"
                },
                {
                  "type": "NFR",
                  "text": "Decouples sync path from heavy work"
                }
              ],
              "tradeoffs": "poison messages; retry storms; duplicate processing",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "description": "Durable ordered log for high-throughput event streaming and replay.",
            "data": {
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Consumer lag; hot partition; rebalancing"
                },
                {
                  "type": "FR",
                  "text": "Event streaming, replay, fanout"
                },
                {
                  "type": "NFR",
                  "text": "High-throughput ordered ingest"
                }
              ],
              "tradeoffs": "hot partition; consumer lag; rebalancing storms",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "pubsub",
            "type": "pubsub",
            "label": "Pub/Sub",
            "category": "messaging",
            "description": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "data": {
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            },
            "details": {
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Slow consumer blocks others; use push/pull"
                },
                {
                  "type": "FR",
                  "text": "Fanout to multiple subscribers"
                },
                {
                  "type": "NFR",
                  "text": "Decouples publishers from consumers"
                }
              ],
              "tradeoffs": "slow consumer lag; fanout amplification",
              "failureModes": "slow consumer lag; fanout amplification",
              "metrics": {}
            }
          },
          {
            "id": "stream-processor",
            "type": "stream-processor",
            "label": "Stream Processor",
            "category": "analytics",
            "description": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
            "data": {
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            },
            "details": {
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Late events; state blowup; checkpoint lag"
                },
                {
                  "type": "FR",
                  "text": "Real-time aggregation and enrichment"
                },
                {
                  "type": "NFR",
                  "text": "Stream analytics"
                }
              ],
              "tradeoffs": "late events; state blowups; checkpoint lag",
              "failureModes": "late events; state blowups; checkpoint lag",
              "metrics": {}
            }
          },
          {
            "id": "data-warehouse",
            "type": "data-warehouse",
            "label": "Data Warehouse (OLAP)",
            "category": "analytics",
            "description": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
            "data": {
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            },
            "details": {
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Expensive scans; stale materializations"
                },
                {
                  "type": "FR",
                  "text": "BI queries and analytics"
                },
                {
                  "type": "NFR",
                  "text": "Columnar scan performance"
                }
              ],
              "tradeoffs": "expensive scans; bad partitioning; stale materializations",
              "failureModes": "expensive scans; bad partitioning; stale materializations",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "scheduler",
            "type": "scheduler",
            "label": "Scheduler",
            "category": "compute",
            "description": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
            "data": {
              "notes": {
                "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
                "keyDecisions": [
                  "Configure interval",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "double-run without locking",
                  "missed runs"
                ]
              }
            },
            "details": {
              "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
              "defaults": {
                "interval": "",
                "jitter": "",
                "backfill": "",
                "lock": ""
              },
              "notes": {
                "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
                "keyDecisions": [
                  "Configure interval",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "double-run without locking",
                  "missed runs"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Double-run without locking; missed runs"
                },
                {
                  "type": "FR",
                  "text": "Periodic jobs, cleanup, rollups"
                },
                {
                  "type": "NFR",
                  "text": "Batch processing"
                }
              ],
              "tradeoffs": "double-run without locking; missed runs; clock skew",
              "failureModes": "double-run without locking; missed runs; clock skew",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 360,
              "y": 280
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "queue"
          },
          {
            "source": "app-service",
            "target": "event-log"
          },
          {
            "source": "app-service",
            "target": "pubsub"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "queue",
            "target": "worker"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": {
              "visibilityTimeout": "",
              "maxRetries": "",
              "dlq": "",
              "fifo": "",
              "orderingKey": ""
            },
            "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "interviewHooks": []
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": {
              "concurrency": "",
              "retries": "",
              "idempotency": "",
              "batchSize": ""
            },
            "tradeoffs": "poison messages; retry storms; duplicate processing",
            "failureModes": "poison messages; retry storms; duplicate processing",
            "interviewHooks": []
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": {
              "partitions": "",
              "replication": "",
              "retention": "",
              "compaction": ""
            },
            "tradeoffs": "hot partition; consumer lag; rebalancing storms",
            "failureModes": "hot partition; consumer lag; rebalancing storms",
            "interviewHooks": []
          },
          "pubsub": {
            "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "knobs": {
              "subscriptionFilters": "",
              "retention": "",
              "ackDeadline": "",
              "replay": ""
            },
            "tradeoffs": "slow consumer lag; fanout amplification",
            "failureModes": "slow consumer lag; fanout amplification",
            "interviewHooks": []
          },
          "stream-processor": {
            "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
            "knobs": {
              "windowing": "",
              "watermarks": "",
              "stateStore": "",
              "checkpointing": ""
            },
            "tradeoffs": "late events; state blowups; checkpoint lag",
            "failureModes": "late events; state blowups; checkpoint lag",
            "interviewHooks": []
          },
          "data-warehouse": {
            "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
            "knobs": {
              "partitioning": "",
              "clustering": "",
              "retention": "",
              "materializedViews": ""
            },
            "tradeoffs": "expensive scans; bad partitioning; stale materializations",
            "failureModes": "expensive scans; bad partitioning; stale materializations",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "scheduler": {
            "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
            "knobs": {
              "interval": "",
              "jitter": "",
              "backfill": "",
              "lock": ""
            },
            "tradeoffs": "double-run without locking; missed runs; clock skew",
            "failureModes": "double-run without locking; missed runs; clock skew",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Stream vs batch",
        "Schema evolution"
      ],
      "antiPatterns": [
        "Sync to warehouse"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "pubsub",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "stream-processor",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "data-warehouse",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "scheduler",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "pubsub",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "stream-processor",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "data-warehouse",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "scheduler",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 20,
          "core": 4,
          "optional": 16,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            }
          },
          {
            "id": "worker",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Worker",
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            }
          },
          {
            "id": "event-log",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Event Log / Stream",
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            }
          },
          {
            "id": "pubsub",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Pub/Sub",
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            }
          },
          {
            "id": "search-index",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Search Index",
              "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
              "defaults": {
                "analyzers": "",
                "ranking": "",
                "shards": "",
                "replicas": "",
                "refreshInterval": ""
              },
              "notes": {
                "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
                "keyDecisions": [
                  "Configure analyzers",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale index",
                  "high write amplification"
                ]
              }
            }
          },
          {
            "id": "stream-processor",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Stream Processor",
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            }
          },
          {
            "id": "data-warehouse",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "Data Warehouse (OLAP)",
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "kv-store",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "Key-Value Store",
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 1360
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "scheduler",
            "position": {
              "x": 250,
              "y": 1440
            },
            "data": {
              "label": "Scheduler",
              "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
              "defaults": {
                "interval": "",
                "jitter": "",
                "backfill": "",
                "lock": ""
              },
              "notes": {
                "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
                "keyDecisions": [
                  "Configure interval",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "double-run without locking",
                  "missed runs"
                ]
              }
            }
          },
          {
            "id": "circuit-breaker",
            "position": {
              "x": 250,
              "y": 1520
            },
            "data": {
              "label": "Circuit Breaker",
              "purpose": "Stops calling failing dependencies to prevent cascading failures.",
              "defaults": {
                "errorThreshold": "",
                "openDuration": "",
                "halfOpenProbes": "",
                "fallback": ""
              },
              "notes": {
                "purpose": "Stops calling failing dependencies to prevent cascading failures.",
                "keyDecisions": [
                  "Configure errorThreshold",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad thresholds causing flapping",
                  "no fallback path"
                ]
              }
            }
          },
          {
            "id": "retry-policy",
            "position": {
              "x": 250,
              "y": 1600
            },
            "data": {
              "label": "Retry Policy",
              "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
              "defaults": {
                "maxRetries": "",
                "backoff": "",
                "jitter": "",
                "retryBudget": ""
              },
              "notes": {
                "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
                "keyDecisions": [
                  "Configure maxRetries",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "retry storms",
                  "retrying non-idempotent ops"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1680
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1760
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "tracing",
            "position": {
              "x": 250,
              "y": 1840
            },
            "data": {
              "label": "Tracing",
              "purpose": "Distributed tracing to understand request paths and latency contributors.",
              "defaults": {
                "sampling": "",
                "propagation": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Distributed tracing to understand request paths and latency contributors.",
                "keyDecisions": [
                  "Sample 110% of requests",
                  "Propagate trace context across services"
                ],
                "failureModes": [
                  "Missing propagation",
                  "Sampling hides tail latencies"
                ]
              }
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1920
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-queue",
            "source": "app-service",
            "target": "queue"
          },
          {
            "id": "e-7-app-service-event-log",
            "source": "app-service",
            "target": "event-log"
          },
          {
            "id": "e-8-app-service-pubsub",
            "source": "app-service",
            "target": "pubsub"
          },
          {
            "id": "e-9-app-service-search-index",
            "source": "app-service",
            "target": "search-index"
          },
          {
            "id": "e-10-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-11-app-service-kv-store",
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "id": "e-12-app-service-worker",
            "source": "app-service",
            "target": "worker"
          },
          {
            "id": "e-13-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-14-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-15-app-service-tracing",
            "source": "app-service",
            "target": "tracing"
          },
          {
            "id": "e-16-app-service-circuit-breaker",
            "source": "app-service",
            "target": "circuit-breaker"
          },
          {
            "id": "e-17-app-service-retry-policy",
            "source": "app-service",
            "target": "retry-policy"
          },
          {
            "id": "e-18-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-19-queue-worker",
            "source": "queue",
            "target": "worker"
          },
          {
            "id": "e-20-event-log-worker",
            "source": "event-log",
            "target": "worker"
          },
          {
            "id": "e-21-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "queue",
          "label": "Queue",
          "reason": "Buffers tasks; decouples producers/consumers; smooths spikes."
        },
        {
          "type": "worker",
          "label": "Worker",
          "reason": "Consumes async jobs/events; performs background processing."
        },
        {
          "type": "event-log",
          "label": "Event Log / Stream",
          "reason": "Durable ordered log for high-throughput event streaming and replay."
        },
        {
          "type": "pubsub",
          "label": "Pub/Sub",
          "reason": "Broadcasts events to multiple subscribers; decouples publishers from consumers."
        },
        {
          "type": "stream-processor",
          "label": "Stream Processor",
          "reason": "Processes streams for aggregation, enrichment, windowing; outputs derived streams."
        },
        {
          "type": "data-warehouse",
          "label": "Data Warehouse (OLAP)",
          "reason": "Columnar analytics store for BI queries; optimized for scans/aggregations."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "scheduler",
          "label": "Scheduler",
          "reason": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines)."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "queue"
        },
        {
          "source": "app-service",
          "target": "event-log"
        },
        {
          "source": "app-service",
          "target": "pubsub"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "queue",
          "target": "worker"
        },
        {
          "source": "event-log",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "cache-invalidation",
      "title": "Design Cache Invalidation Service",
      "problemStatement": "Design Design Cache Invalidation Service\nDesign Design Cache Invalidation Service\nDesign Design Cache Invalidation Service\nWhen source data changes, invalidate or update caches across a distributed system.",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "cache-invalidation",
            "type": "cache-invalidation",
            "label": "Cache Invalidation Stream",
            "category": "caching",
            "description": "Propagates invalidation events to caches to keep data fresh.",
            "data": {
              "notes": {
                "purpose": "Propagates invalidation events to caches to keep data fresh.",
                "keyDecisions": [
                  "Configure keys",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "missed invalidations",
                  "out-of-order invalidations"
                ]
              }
            },
            "details": {
              "purpose": "Propagates invalidation events to caches to keep data fresh.",
              "defaults": {
                "keys": "",
                "batching": "",
                "dedupe": ""
              },
              "notes": {
                "purpose": "Propagates invalidation events to caches to keep data fresh.",
                "keyDecisions": [
                  "Configure keys",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "missed invalidations",
                  "out-of-order invalidations"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Missed invalidations cause stale reads"
                },
                {
                  "type": "FR",
                  "text": "Propagate invalidation events"
                },
                {
                  "type": "NFR",
                  "text": "Cache freshness"
                }
              ],
              "tradeoffs": "missed invalidations; out-of-order invalidations",
              "failureModes": "missed invalidations; out-of-order invalidations",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 420,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 460,
              "y": 200
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "cache-invalidation": {
            "purpose": "Propagates invalidation events to caches to keep data fresh.",
            "knobs": {
              "keys": "",
              "batching": "",
              "dedupe": ""
            },
            "tradeoffs": "missed invalidations; out-of-order invalidations",
            "failureModes": "missed invalidations; out-of-order invalidations",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Write-through vs invalidation",
        "Fan-out strategy",
        "Stale-while-revalidate"
      ],
      "antiPatterns": [
        "No invalidation on write"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache-invalidation",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache-invalidation",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 15,
          "core": 4,
          "optional": 11,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "cache-invalidation",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Cache Invalidation Stream",
              "purpose": "Propagates invalidation events to caches to keep data fresh.",
              "defaults": {
                "keys": "",
                "batching": "",
                "dedupe": ""
              },
              "notes": {
                "purpose": "Propagates invalidation events to caches to keep data fresh.",
                "keyDecisions": [
                  "Configure keys",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "missed invalidations",
                  "out-of-order invalidations"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "queue"
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-7-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-8-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-9-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-10-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "cache-invalidation",
          "label": "Cache Invalidation Stream",
          "reason": "Propagates invalidation events to caches to keep data fresh."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "chat",
      "title": "Design a Chat System",
      "problemStatement": "Design Design a Chat System\nDesign Design a Chat System\nDesign Design a Chat System\nBuild a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and work offline.",
      "functionalRequirements": [
        "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
        "Send/receive 1:1 messages",
        "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
        "Send/receive 1:1 messages",
        "Group chats (create, add, leave)",
        "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
        "Send/receive 1:1 messages",
        "Group chats (create, add, leave)",
        "Message ordering per conversation",
        "Offline message sync"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for chat UI"
                },
                {
                  "type": "NFR",
                  "text": "Required for any chat client"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Distribute traffic to gateways"
                },
                {
                  "type": "NFR",
                  "text": "HA and load distribution"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "auth-service",
            "label": "Auth Service",
            "category": "security",
            "description": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "data": {
              "notes": {
                "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
                "keyDecisions": [
                  "JWT vs session; token refresh flow",
                  "Validate on gateway or service mesh"
                ],
                "failureModes": [
                  "Token replay if not bound to request",
                  "Session store overload"
                ]
              }
            },
            "details": {
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "defaults": {
                "tokenTTL": "",
                "refreshTTL": "",
                "rotation": "",
                "mfa": ""
              },
              "notes": {
                "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
                "keyDecisions": [
                  "JWT vs session; token refresh flow",
                  "Validate on gateway or service mesh"
                ],
                "failureModes": [
                  "Token replay if not bound to request",
                  "Session store overload"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Auth failure blocks all requests; needs redundancy"
                },
                {
                  "type": "FR",
                  "text": "Login, session, token issuance"
                },
                {
                  "type": "NFR",
                  "text": "Security and identity"
                }
              ],
              "tradeoffs": "token replay if not bound; clock skew issues; session store overload",
              "failureModes": "token replay if not bound; clock skew issues; session store overload",
              "metrics": {}
            }
          },
          {
            "id": "realtime-gateway",
            "type": "realtime-gateway",
            "label": "Realtime Gateway (WebSocket)",
            "category": "edge",
            "description": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
            "data": {
              "notes": {
                "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
                "keyDecisions": [
                  "Sticky sessions for WebSocket affinity",
                  "Heartbeat/keepalive to detect dead connections"
                ],
                "failureModes": [
                  "Connection storms on mass reconnect",
                  "Stale connections after instance failover"
                ]
              }
            },
            "details": {
              "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
              "defaults": {
                "connectionTimeout": "",
                "heartbeatInterval": "",
                "maxConnectionsPerInstance": "",
                "stickySessions": ""
              },
              "notes": {
                "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
                "keyDecisions": [
                  "Sticky sessions for WebSocket affinity",
                  "Heartbeat/keepalive to detect dead connections"
                ],
                "failureModes": [
                  "Connection storms on mass reconnect",
                  "Stale connections after instance failover"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Connection storms on reconnect; stale after failover"
                },
                {
                  "type": "FR",
                  "text": "WebSocket connections for real-time delivery"
                },
                {
                  "type": "NFR",
                  "text": "Low-latency bidirectional messaging"
                }
              ],
              "tradeoffs": "connection storms on reconnect; stale connections after instance failover",
              "failureModes": "connection storms on reconnect; stale connections after instance failover",
              "metrics": {}
            }
          },
          {
            "id": "presence-service",
            "type": "presence-service",
            "label": "Presence Service",
            "category": "compute",
            "description": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
            "data": {
              "notes": {
                "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
                "keyDecisions": [
                  "Heartbeat TTL; sliding window for last-seen",
                  "Shard by userId for scale"
                ],
                "failureModes": [
                  "Stale presence after client crash",
                  "Hot keys for popular users"
                ]
              }
            },
            "details": {
              "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
              "defaults": {
                "heartbeatTTL": "",
                "slidingWindow": "",
                "shardingKey": ""
              },
              "notes": {
                "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
                "keyDecisions": [
                  "Heartbeat TTL; sliding window for last-seen",
                  "Shard by userId for scale"
                ],
                "failureModes": [
                  "Stale presence after client crash",
                  "Hot keys for popular users"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stale presence after crash; hot keys for popular users"
                },
                {
                  "type": "FR",
                  "text": "Online/offline status, typing indicators"
                },
                {
                  "type": "NFR",
                  "text": "Real-time presence at scale"
                }
              ],
              "tradeoffs": "stale presence after crash; hot keys for popular users",
              "failureModes": "stale presence after crash; hot keys for popular users",
              "metrics": {}
            }
          },
          {
            "id": "conversation-service",
            "type": "conversation-service",
            "label": "Conversation Service",
            "category": "compute",
            "description": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
            "data": {
              "notes": {
                "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
                "keyDecisions": [
                  "Index (userId, lastMessageTs) for list",
                  "Cache hot conversation metadata"
                ],
                "failureModes": [
                  "N+1 queries on list",
                  "Hot partitions for active threads"
                ]
              }
            },
            "details": {
              "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
              "defaults": {
                "pagination": "",
                "indexStrategy": "",
                "cacheTTL": ""
              },
              "notes": {
                "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
                "keyDecisions": [
                  "Index (userId, lastMessageTs) for list",
                  "Cache hot conversation metadata"
                ],
                "failureModes": [
                  "N+1 queries on list",
                  "Hot partitions for active threads"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "N+1 on list; hot partitions"
                }
              ],
              "tradeoffs": "N+1 queries on list; hot partitions for popular conversations",
              "failureModes": "N+1 queries on list; hot partitions for popular conversations",
              "metrics": {}
            }
          },
          {
            "id": "message-service",
            "type": "message-service",
            "label": "Message Service",
            "category": "compute",
            "description": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
            "data": {
              "notes": {
                "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
                "keyDecisions": [
                  "Idempotency key per message; partition by conversationId",
                  "Fanout: event-log for realtime, queue for push"
                ],
                "failureModes": [
                  "Duplicate messages without idempotency",
                  "Ordering breaks under partition rebalance"
                ]
              }
            },
            "details": {
              "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
              "defaults": {
                "idempotencyKey": "",
                "ordering": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
                "keyDecisions": [
                  "Idempotency key per message; partition by conversationId",
                  "Fanout: event-log for realtime, queue for push"
                ],
                "failureModes": [
                  "Duplicate messages without idempotency",
                  "Ordering breaks under partition rebalance"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Duplicates without idempotency; ordering breaks"
                },
                {
                  "type": "FR",
                  "text": "Send/receive messages, fanout to pipelines"
                },
                {
                  "type": "NFR",
                  "text": "Ordering and idempotency"
                }
              ],
              "tradeoffs": "duplicate messages without idempotency; ordering breaks under load",
              "failureModes": "duplicate messages without idempotency; ordering breaks under load",
              "metrics": {}
            }
          },
          {
            "id": "message-store",
            "type": "message-store",
            "label": "Message Store (Sharded KV/Wide-Column)",
            "category": "storage",
            "description": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
            "data": {
              "notes": {
                "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
                "keyDecisions": [
                  "Partition key: conversationId; sort key: messageId or timestamp",
                  "Wide-column or KV; TTL for retention"
                ],
                "failureModes": [
                  "Hot partition for viral threads",
                  "Uneven shard distribution"
                ]
              }
            },
            "details": {
              "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
              "defaults": {
                "partitionKey": "",
                "sortKey": "",
                "ttl": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
                "keyDecisions": [
                  "Partition key: conversationId; sort key: messageId or timestamp",
                  "Wide-column or KV; TTL for retention"
                ],
                "failureModes": [
                  "Hot partition for viral threads",
                  "Uneven shard distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Hot partition for popular convs; uneven shards"
                },
                {
                  "type": "FR",
                  "text": "Durable message storage"
                },
                {
                  "type": "NFR",
                  "text": "Sharded write scale"
                }
              ],
              "tradeoffs": "hot partition for popular conversations; uneven shard distribution",
              "failureModes": "hot partition for popular conversations; uneven shard distribution",
              "metrics": {}
            }
          },
          {
            "id": "conversation-metadata-store",
            "type": "conversation-metadata-store",
            "label": "Conversation Metadata Store",
            "category": "storage",
            "description": "Stores conversation metadata: participants, last message timestamp, read receipts.",
            "data": {
              "notes": {
                "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
                "keyDecisions": [
                  "Document or SQL; index for list-by-user",
                  "Eventual consistency for read receipts OK"
                ],
                "failureModes": [
                  "Hot rows for active conversations",
                  "Read-after-write consistency gaps"
                ]
              }
            },
            "details": {
              "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
              "defaults": {
                "indexes": "",
                "partitionKey": "",
                "cacheLayer": ""
              },
              "notes": {
                "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
                "keyDecisions": [
                  "Document or SQL; index for list-by-user",
                  "Eventual consistency for read receipts OK"
                ],
                "failureModes": [
                  "Hot rows for active conversations",
                  "Read-after-write consistency gaps"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Hot rows; eventual consistency"
                }
              ],
              "tradeoffs": "hot rows for active conversations; eventual consistency for read receipts",
              "failureModes": "hot rows for active conversations; eventual consistency for read receipts",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "description": "Durable ordered log for high-throughput event streaming and replay.",
            "data": {
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Consumer lag; hot partition; rebalancing"
                }
              ],
              "tradeoffs": "hot partition; consumer lag; rebalancing storms",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "description": "Consumes async jobs/events; performs background processing.",
            "data": {
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "At-least-once; idempotency required"
                }
              ],
              "tradeoffs": "poison messages; retry storms; duplicate processing",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "dlq",
            "type": "dlq",
            "label": "Dead Letter Queue",
            "category": "reliability",
            "description": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
            "data": {
              "notes": {
                "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
                "keyDecisions": [
                  "Max retries before DLQ; alert on depth",
                  "Manual triage and redrive"
                ],
                "failureModes": [
                  "Silent accumulation without monitoring",
                  "Reprocessing without fix"
                ]
              }
            },
            "details": {
              "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
              "defaults": {
                "maxReceiveCount": "",
                "redrivePolicy": ""
              },
              "notes": {
                "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
                "keyDecisions": [
                  "Max retries before DLQ; alert on depth",
                  "Manual triage and redrive"
                ],
                "failureModes": [
                  "Silent accumulation without monitoring",
                  "Reprocessing without fix"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Unblocks pipeline; manual triage required"
                },
                {
                  "type": "NFR",
                  "text": "Isolate poison messages"
                }
              ],
              "tradeoffs": "silent accumulation (no monitoring); reprocessing without fix",
              "failureModes": "silent accumulation (no monitoring); reprocessing without fix",
              "metrics": {}
            }
          },
          {
            "id": "notification-service",
            "type": "notification-service",
            "label": "Notification Service (Push)",
            "category": "compute",
            "description": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
            "data": {
              "notes": {
                "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
                "keyDecisions": [
                  "Batch payloads; retry with exponential backoff",
                  "Refresh device tokens periodically"
                ],
                "failureModes": [
                  "Token expiry causes silent drops",
                  "Provider rate limits"
                ]
              }
            },
            "details": {
              "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
              "defaults": {
                "batchSize": "",
                "retryPolicy": "",
                "deviceTokenRefresh": ""
              },
              "notes": {
                "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
                "keyDecisions": [
                  "Batch payloads; retry with exponential backoff",
                  "Refresh device tokens periodically"
                ],
                "failureModes": [
                  "Token expiry causes silent drops",
                  "Provider rate limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Token expiry; provider rate limits"
                },
                {
                  "type": "FR",
                  "text": "Push notifications to offline users"
                },
                {
                  "type": "NFR",
                  "text": "APNs/FCM delivery"
                }
              ],
              "tradeoffs": "token expiry causing silent failures; provider rate limits",
              "failureModes": "token expiry causing silent failures; provider rate limits",
              "metrics": {}
            }
          },
          {
            "id": "object-storage",
            "type": "object-storage",
            "label": "Object Storage",
            "category": "storage",
            "description": "Stores large blobs (images/videos/files); durable and cost-effective.",
            "data": {
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            },
            "details": {
              "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
              "defaults": {
                "storageClass": "",
                "lifecyclePolicy": "",
                "versioning": "",
                "multipartUpload": ""
              },
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Eventual consistency; prefix hot spots"
                },
                {
                  "type": "FR",
                  "text": "Blob/media/file storage"
                },
                {
                  "type": "NFR",
                  "text": "Durability and cost-efficiency"
                }
              ],
              "tradeoffs": "eventual consistency edge cases (some systems); hot prefix",
              "failureModes": "eventual consistency edge cases (some systems); hot prefix",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "media-service",
            "type": "media-service",
            "label": "Media Service",
            "category": "compute",
            "description": "Handles image/video upload, transcoding, thumbnails; stores in object storage, serves via CDN.",
            "data": {
              "notes": {
                "purpose": "Handles image/video upload, transcoding, thumbnails; stores in object storage, serves via CDN.",
                "keyDecisions": [
                  "Async transcoding; store original + variants",
                  "Thumbnail generation pipeline"
                ],
                "failureModes": [
                  "Upload timeout for large files",
                  "Transcoding backlog"
                ]
              }
            },
            "details": {
              "purpose": "Handles image/video upload, transcoding, thumbnails; stores in object storage, serves via CDN.",
              "defaults": {
                "presignedUpload": "",
                "transcodingPipeline": "",
                "thumbnailSize": ""
              },
              "notes": {
                "purpose": "Handles image/video upload, transcoding, thumbnails; stores in object storage, serves via CDN.",
                "keyDecisions": [
                  "Async transcoding; store original + variants",
                  "Thumbnail generation pipeline"
                ],
                "failureModes": [
                  "Upload timeout for large files",
                  "Transcoding backlog"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Upload timeout; transcoding backlog"
                },
                {
                  "type": "FR",
                  "text": "Upload, transcoding, thumbnails"
                },
                {
                  "type": "NFR",
                  "text": "Presigned uploads; async processing"
                }
              ],
              "tradeoffs": "upload timeout for large files; transcoding backlog",
              "failureModes": "upload timeout for large files; transcoding backlog",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "tracing",
            "type": "tracing",
            "label": "Tracing",
            "category": "observability",
            "description": "Distributed tracing to understand request paths and latency contributors.",
            "data": {
              "notes": {
                "purpose": "Distributed tracing to understand request paths and latency contributors.",
                "keyDecisions": [
                  "Sample 110% of requests",
                  "Propagate trace context across services"
                ],
                "failureModes": [
                  "Missing propagation",
                  "Sampling hides tail latencies"
                ]
              }
            },
            "details": {
              "purpose": "Distributed tracing to understand request paths and latency contributors.",
              "defaults": {
                "sampling": "",
                "propagation": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Distributed tracing to understand request paths and latency contributors.",
                "keyDecisions": [
                  "Sample 110% of requests",
                  "Propagate trace context across services"
                ],
                "failureModes": [
                  "Missing propagation",
                  "Sampling hides tail latencies"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Sampling hides tail latencies"
                },
                {
                  "type": "NFR",
                  "text": "Distributed trace for latency debugging"
                }
              ],
              "tradeoffs": "missing propagation; sampling hides tail latencies",
              "failureModes": "missing propagation; sampling hides tail latencies",
              "metrics": {}
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "load-balancer-l7"
          },
          {
            "source": "api-gateway",
            "target": "auth-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "message-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "conversation-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "realtime-gateway"
          },
          {
            "source": "message-service",
            "target": "message-store"
          },
          {
            "source": "message-service",
            "target": "conversation-metadata-store"
          },
          {
            "source": "message-service",
            "target": "event-log"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "worker",
            "target": "realtime-gateway"
          },
          {
            "source": "worker",
            "target": "notification-service"
          },
          {
            "source": "worker",
            "target": "dlq"
          },
          {
            "source": "realtime-gateway",
            "target": "presence-service"
          },
          {
            "source": "message-service",
            "target": "media-service"
          },
          {
            "source": "media-service",
            "target": "object-storage"
          },
          {
            "source": "media-service",
            "target": "cdn"
          },
          {
            "source": "message-service",
            "target": "metrics"
          },
          {
            "source": "conversation-service",
            "target": "metrics"
          },
          {
            "source": "worker",
            "target": "metrics"
          },
          {
            "source": "realtime-gateway",
            "target": "metrics"
          },
          {
            "source": "notification-service",
            "target": "metrics"
          },
          {
            "source": "message-service",
            "target": "logging"
          },
          {
            "source": "message-service",
            "target": "tracing"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": {
              "tokenTTL": "",
              "refreshTTL": "",
              "rotation": "",
              "mfa": ""
            },
            "tradeoffs": "token replay if not bound; clock skew issues; session store overload",
            "failureModes": "token replay if not bound; clock skew issues; session store overload",
            "interviewHooks": []
          },
          "realtime-gateway": {
            "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
            "knobs": {
              "connectionTimeout": "",
              "heartbeatInterval": "",
              "maxConnectionsPerInstance": "",
              "stickySessions": ""
            },
            "tradeoffs": "connection storms on reconnect; stale connections after instance failover",
            "failureModes": "connection storms on reconnect; stale connections after instance failover",
            "interviewHooks": []
          },
          "presence-service": {
            "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
            "knobs": {
              "heartbeatTTL": "",
              "slidingWindow": "",
              "shardingKey": ""
            },
            "tradeoffs": "stale presence after crash; hot keys for popular users",
            "failureModes": "stale presence after crash; hot keys for popular users",
            "interviewHooks": []
          },
          "conversation-service": {
            "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
            "knobs": {
              "pagination": "",
              "indexStrategy": "",
              "cacheTTL": ""
            },
            "tradeoffs": "N+1 queries on list; hot partitions for popular conversations",
            "failureModes": "N+1 queries on list; hot partitions for popular conversations",
            "interviewHooks": []
          },
          "message-service": {
            "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
            "knobs": {
              "idempotencyKey": "",
              "ordering": "",
              "retention": ""
            },
            "tradeoffs": "duplicate messages without idempotency; ordering breaks under load",
            "failureModes": "duplicate messages without idempotency; ordering breaks under load",
            "interviewHooks": []
          },
          "message-store": {
            "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
            "knobs": {
              "partitionKey": "",
              "sortKey": "",
              "ttl": "",
              "compaction": ""
            },
            "tradeoffs": "hot partition for popular conversations; uneven shard distribution",
            "failureModes": "hot partition for popular conversations; uneven shard distribution",
            "interviewHooks": []
          },
          "conversation-metadata-store": {
            "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
            "knobs": {
              "indexes": "",
              "partitionKey": "",
              "cacheLayer": ""
            },
            "tradeoffs": "hot rows for active conversations; eventual consistency for read receipts",
            "failureModes": "hot rows for active conversations; eventual consistency for read receipts",
            "interviewHooks": []
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": {
              "partitions": "",
              "replication": "",
              "retention": "",
              "compaction": ""
            },
            "tradeoffs": "hot partition; consumer lag; rebalancing storms",
            "failureModes": "hot partition; consumer lag; rebalancing storms",
            "interviewHooks": []
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": {
              "concurrency": "",
              "retries": "",
              "idempotency": "",
              "batchSize": ""
            },
            "tradeoffs": "poison messages; retry storms; duplicate processing",
            "failureModes": "poison messages; retry storms; duplicate processing",
            "interviewHooks": []
          },
          "dlq": {
            "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
            "knobs": {
              "maxReceiveCount": "",
              "redrivePolicy": ""
            },
            "tradeoffs": "silent accumulation (no monitoring); reprocessing without fix",
            "failureModes": "silent accumulation (no monitoring); reprocessing without fix",
            "interviewHooks": []
          },
          "notification-service": {
            "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
            "knobs": {
              "batchSize": "",
              "retryPolicy": "",
              "deviceTokenRefresh": ""
            },
            "tradeoffs": "token expiry causing silent failures; provider rate limits",
            "failureModes": "token expiry causing silent failures; provider rate limits",
            "interviewHooks": []
          },
          "object-storage": {
            "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
            "knobs": {
              "storageClass": "",
              "lifecyclePolicy": "",
              "versioning": "",
              "multipartUpload": ""
            },
            "tradeoffs": "eventual consistency edge cases (some systems); hot prefix",
            "failureModes": "eventual consistency edge cases (some systems); hot prefix",
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "media-service": {
            "purpose": "Handles image/video upload, transcoding, thumbnails; stores in object storage, serves via CDN.",
            "knobs": {
              "presignedUpload": "",
              "transcodingPipeline": "",
              "thumbnailSize": ""
            },
            "tradeoffs": "upload timeout for large files; transcoding backlog",
            "failureModes": "upload timeout for large files; transcoding backlog",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "tracing": {
            "purpose": "Distributed tracing to understand request paths and latency contributors.",
            "knobs": {
              "sampling": "",
              "propagation": "",
              "retention": ""
            },
            "tradeoffs": "missing propagation; sampling hides tail latencies",
            "failureModes": "missing propagation; sampling hides tail latencies",
            "interviewHooks": []
          }
        }
      },
      "scoringRubric": [
        "WebSocket vs long-poll tradeoffs",
        "Message ordering guarantees",
        "Offline sync strategy"
      ],
      "antiPatterns": [
        "Polling for new messages",
        "No message queue for delivery"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Send/receive 1:1 messages"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "realtime-gateway",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Send/receive 1:1 messages"
              }
            ]
          },
          {
            "nodeId": "presence-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "conversation-service",
            "justifications": [
              {
                "type": "functional",
                "index": 8,
                "text": "Message ordering per conversation"
              }
            ]
          },
          {
            "nodeId": "message-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 8,
                "text": "Message ordering per conversation"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Offline message sync"
              }
            ]
          },
          {
            "nodeId": "message-store",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Group chats (create, add, leave)"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Group chats (create, add, leave)"
              },
              {
                "type": "functional",
                "index": 8,
                "text": "Message ordering per conversation"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Offline message sync"
              }
            ]
          },
          {
            "nodeId": "conversation-metadata-store",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 8,
                "text": "Message ordering per conversation"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Offline message sync"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "functional",
                "index": 1,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Send/receive 1:1 messages"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "dlq",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Send/receive 1:1 messages"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Send/receive 1:1 messages"
              }
            ]
          },
          {
            "nodeId": "notification-service",
            "justifications": [
              {
                "type": "functional",
                "index": 9,
                "text": "Offline message sync"
              }
            ]
          },
          {
            "nodeId": "object-storage",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "media-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "tracing",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "realtime-gateway",
            "status": "optional",
            "justifications": [
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "presence-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "conversation-service",
            "status": "optional",
            "justifications": [
              "Message ordering per conversation"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "message-service",
            "status": "optional",
            "justifications": [
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Message ordering per conversation",
              "Offline message sync"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "message-store",
            "status": "optional",
            "justifications": [
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Group chats (create, add, leave)",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Group chats (create, add, leave)",
              "Message ordering per conversation",
              "Offline message sync"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "conversation-metadata-store",
            "status": "optional",
            "justifications": [
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Message ordering per conversation",
              "Offline message sync"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Send/receive 1:1 messages",
              "Send/receive 1:1 messages",
              "Send/receive 1:1 messages"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "dlq",
            "status": "optional",
            "justifications": [
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages",
              "Build a 1:1 and group chat like WhatsApp. Messages must be delivered in order, support read receipts, and wor",
              "Send/receive 1:1 messages"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "notification-service",
            "status": "optional",
            "justifications": [
              "Offline message sync"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "object-storage",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "media-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "tracing",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 21,
          "core": 2,
          "optional": 19,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "defaults": {
                "tokenTTL": "",
                "refreshTTL": "",
                "rotation": "",
                "mfa": ""
              },
              "notes": {
                "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
                "keyDecisions": [
                  "JWT vs session; token refresh flow",
                  "Validate on gateway or service mesh"
                ],
                "failureModes": [
                  "Token replay if not bound to request",
                  "Session store overload"
                ]
              }
            }
          },
          {
            "id": "realtime-gateway",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Realtime Gateway (WebSocket)",
              "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
              "defaults": {
                "connectionTimeout": "",
                "heartbeatInterval": "",
                "maxConnectionsPerInstance": "",
                "stickySessions": ""
              },
              "notes": {
                "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
                "keyDecisions": [
                  "Sticky sessions for WebSocket affinity",
                  "Heartbeat/keepalive to detect dead connections"
                ],
                "failureModes": [
                  "Connection storms on mass reconnect",
                  "Stale connections after instance failover"
                ]
              }
            }
          },
          {
            "id": "presence-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "Presence Service",
              "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
              "defaults": {
                "heartbeatTTL": "",
                "slidingWindow": "",
                "shardingKey": ""
              },
              "notes": {
                "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
                "keyDecisions": [
                  "Heartbeat TTL; sliding window for last-seen",
                  "Shard by userId for scale"
                ],
                "failureModes": [
                  "Stale presence after client crash",
                  "Hot keys for popular users"
                ]
              }
            }
          },
          {
            "id": "conversation-service",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Conversation Service",
              "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
              "defaults": {
                "pagination": "",
                "indexStrategy": "",
                "cacheTTL": ""
              },
              "notes": {
                "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
                "keyDecisions": [
                  "Index (userId, lastMessageTs) for list",
                  "Cache hot conversation metadata"
                ],
                "failureModes": [
                  "N+1 queries on list",
                  "Hot partitions for active threads"
                ]
              }
            }
          },
          {
            "id": "message-service",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Message Service",
              "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
              "defaults": {
                "idempotencyKey": "",
                "ordering": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
                "keyDecisions": [
                  "Idempotency key per message; partition by conversationId",
                  "Fanout: event-log for realtime, queue for push"
                ],
                "failureModes": [
                  "Duplicate messages without idempotency",
                  "Ordering breaks under partition rebalance"
                ]
              }
            }
          },
          {
            "id": "message-store",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Message Store (Sharded KV/Wide-Column)",
              "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
              "defaults": {
                "partitionKey": "",
                "sortKey": "",
                "ttl": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
                "keyDecisions": [
                  "Partition key: conversationId; sort key: messageId or timestamp",
                  "Wide-column or KV; TTL for retention"
                ],
                "failureModes": [
                  "Hot partition for viral threads",
                  "Uneven shard distribution"
                ]
              }
            }
          },
          {
            "id": "conversation-metadata-store",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Conversation Metadata Store",
              "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
              "defaults": {
                "indexes": "",
                "partitionKey": "",
                "cacheLayer": ""
              },
              "notes": {
                "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
                "keyDecisions": [
                  "Document or SQL; index for list-by-user",
                  "Eventual consistency for read receipts OK"
                ],
                "failureModes": [
                  "Hot rows for active conversations",
                  "Read-after-write consistency gaps"
                ]
              }
            }
          },
          {
            "id": "event-log",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Event Log / Stream",
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            }
          },
          {
            "id": "worker",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Worker",
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            }
          },
          {
            "id": "dlq",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "Dead Letter Queue",
              "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
              "defaults": {
                "maxReceiveCount": "",
                "redrivePolicy": ""
              },
              "notes": {
                "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
                "keyDecisions": [
                  "Max retries before DLQ; alert on depth",
                  "Manual triage and redrive"
                ],
                "failureModes": [
                  "Silent accumulation without monitoring",
                  "Reprocessing without fix"
                ]
              }
            }
          },
          {
            "id": "notification-service",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "Notification Service (Push)",
              "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
              "defaults": {
                "batchSize": "",
                "retryPolicy": "",
                "deviceTokenRefresh": ""
              },
              "notes": {
                "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
                "keyDecisions": [
                  "Batch payloads; retry with exponential backoff",
                  "Refresh device tokens periodically"
                ],
                "failureModes": [
                  "Token expiry causes silent drops",
                  "Provider rate limits"
                ]
              }
            }
          },
          {
            "id": "object-storage",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "Object Storage",
              "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
              "defaults": {
                "storageClass": "",
                "lifecyclePolicy": "",
                "versioning": "",
                "multipartUpload": ""
              },
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "media-service",
            "position": {
              "x": 250,
              "y": 1360
            },
            "data": {
              "label": "Media Service",
              "purpose": "Handles image/video upload, transcoding, thumbnails; stores in object storage, serves via CDN.",
              "defaults": {
                "presignedUpload": "",
                "transcodingPipeline": "",
                "thumbnailSize": ""
              },
              "notes": {
                "purpose": "Handles image/video upload, transcoding, thumbnails; stores in object storage, serves via CDN.",
                "keyDecisions": [
                  "Async transcoding; store original + variants",
                  "Thumbnail generation pipeline"
                ],
                "failureModes": [
                  "Upload timeout for large files",
                  "Transcoding backlog"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1440
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1520
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "tracing",
            "position": {
              "x": 250,
              "y": 1600
            },
            "data": {
              "label": "Tracing",
              "purpose": "Distributed tracing to understand request paths and latency contributors.",
              "defaults": {
                "sampling": "",
                "propagation": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Distributed tracing to understand request paths and latency contributors.",
                "keyDecisions": [
                  "Sample 110% of requests",
                  "Propagate trace context across services"
                ],
                "failureModes": [
                  "Missing propagation",
                  "Sampling hides tail latencies"
                ]
              }
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-api-gateway",
            "source": "web-app",
            "target": "api-gateway"
          },
          {
            "id": "e-1-api-gateway-edge-rate-limiter",
            "source": "api-gateway",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-load-balancer-l7",
            "source": "edge-rate-limiter",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-3-api-gateway-auth-service",
            "source": "api-gateway",
            "target": "auth-service"
          },
          {
            "id": "e-4-load-balancer-l7-message-service",
            "source": "load-balancer-l7",
            "target": "message-service"
          },
          {
            "id": "e-5-load-balancer-l7-conversation-service",
            "source": "load-balancer-l7",
            "target": "conversation-service"
          },
          {
            "id": "e-6-load-balancer-l7-realtime-gateway",
            "source": "load-balancer-l7",
            "target": "realtime-gateway"
          },
          {
            "id": "e-7-message-service-message-store",
            "source": "message-service",
            "target": "message-store"
          },
          {
            "id": "e-8-message-service-conversation-metadata-store",
            "source": "message-service",
            "target": "conversation-metadata-store"
          },
          {
            "id": "e-9-message-service-event-log",
            "source": "message-service",
            "target": "event-log"
          },
          {
            "id": "e-10-event-log-worker",
            "source": "event-log",
            "target": "worker"
          },
          {
            "id": "e-11-worker-realtime-gateway",
            "source": "worker",
            "target": "realtime-gateway"
          },
          {
            "id": "e-12-worker-notification-service",
            "source": "worker",
            "target": "notification-service"
          },
          {
            "id": "e-13-worker-dlq",
            "source": "worker",
            "target": "dlq"
          },
          {
            "id": "e-14-realtime-gateway-presence-service",
            "source": "realtime-gateway",
            "target": "presence-service"
          },
          {
            "id": "e-15-message-service-media-service",
            "source": "message-service",
            "target": "media-service"
          },
          {
            "id": "e-16-media-service-object-storage",
            "source": "media-service",
            "target": "object-storage"
          },
          {
            "id": "e-17-media-service-cdn",
            "source": "media-service",
            "target": "cdn"
          },
          {
            "id": "e-18-message-service-metrics",
            "source": "message-service",
            "target": "metrics"
          },
          {
            "id": "e-19-conversation-service-metrics",
            "source": "conversation-service",
            "target": "metrics"
          },
          {
            "id": "e-20-worker-metrics",
            "source": "worker",
            "target": "metrics"
          },
          {
            "id": "e-21-realtime-gateway-metrics",
            "source": "realtime-gateway",
            "target": "metrics"
          },
          {
            "id": "e-22-notification-service-metrics",
            "source": "notification-service",
            "target": "metrics"
          },
          {
            "id": "e-23-message-service-logging",
            "source": "message-service",
            "target": "logging"
          },
          {
            "id": "e-24-message-service-tracing",
            "source": "message-service",
            "target": "tracing"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "auth-service",
          "label": "Auth Service",
          "reason": "Issues/validates credentials (sessions, tokens); enforces authentication flows."
        },
        {
          "type": "realtime-gateway",
          "label": "Realtime Gateway (WebSocket)",
          "reason": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients."
        },
        {
          "type": "presence-service",
          "label": "Presence Service",
          "reason": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership."
        },
        {
          "type": "conversation-service",
          "label": "Conversation Service",
          "reason": "Manages conversation metadata: create/archive threads, list conversations, resolve participants."
        },
        {
          "type": "message-service",
          "label": "Message Service",
          "reason": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines."
        },
        {
          "type": "message-store",
          "label": "Message Store (Sharded KV/Wide-Column)",
          "reason": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale."
        },
        {
          "type": "conversation-metadata-store",
          "label": "Conversation Metadata Store",
          "reason": "Stores conversation metadata: participants, last message timestamp, read receipts."
        },
        {
          "type": "event-log",
          "label": "Event Log / Stream",
          "reason": "Durable ordered log for high-throughput event streaming and replay."
        },
        {
          "type": "worker",
          "label": "Worker",
          "reason": "Consumes async jobs/events; performs background processing."
        },
        {
          "type": "dlq",
          "label": "Dead Letter Queue",
          "reason": "Isolates poison messages for inspection and reprocessing without blocking pipelines."
        },
        {
          "type": "notification-service",
          "label": "Notification Service (Push)",
          "reason": "Sends push notifications to offline users via APNs/FCM; batches and retries."
        },
        {
          "type": "object-storage",
          "label": "Object Storage",
          "reason": "Stores large blobs (images/videos/files); durable and cost-effective."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "media-service",
          "label": "Media Service",
          "reason": "Handles image/video upload, transcoding, thumbnails; stores in object storage, serves via CDN."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "tracing",
          "label": "Tracing",
          "reason": "Distributed tracing to understand request paths and latency contributors."
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "load-balancer-l7"
        },
        {
          "source": "api-gateway",
          "target": "auth-service"
        },
        {
          "source": "load-balancer-l7",
          "target": "message-service"
        },
        {
          "source": "load-balancer-l7",
          "target": "conversation-service"
        },
        {
          "source": "load-balancer-l7",
          "target": "realtime-gateway"
        },
        {
          "source": "message-service",
          "target": "message-store"
        },
        {
          "source": "message-service",
          "target": "conversation-metadata-store"
        },
        {
          "source": "message-service",
          "target": "event-log"
        },
        {
          "source": "event-log",
          "target": "worker"
        },
        {
          "source": "worker",
          "target": "realtime-gateway"
        },
        {
          "source": "worker",
          "target": "notification-service"
        },
        {
          "source": "worker",
          "target": "dlq"
        },
        {
          "source": "realtime-gateway",
          "target": "presence-service"
        },
        {
          "source": "message-service",
          "target": "media-service"
        },
        {
          "source": "media-service",
          "target": "object-storage"
        },
        {
          "source": "media-service",
          "target": "cdn"
        },
        {
          "source": "message-service",
          "target": "metrics"
        },
        {
          "source": "conversation-service",
          "target": "metrics"
        },
        {
          "source": "worker",
          "target": "metrics"
        },
        {
          "source": "realtime-gateway",
          "target": "metrics"
        },
        {
          "source": "notification-service",
          "target": "metrics"
        },
        {
          "source": "message-service",
          "target": "logging"
        },
        {
          "source": "message-service",
          "target": "tracing"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "feature-flag",
      "title": "Design a Feature Flag System",
      "problemStatement": "Design Design a Feature Flag System\nDesign Design a Feature Flag System\nDesign Design a Feature Flag System\nRemotely enable/disable features. Support targeting (user, %, cohort) and fast propagation.",
      "functionalRequirements": [
        "Create and toggle flags",
        "Create and toggle flags",
        "Create and toggle flags",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Create and toggle flags"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "kv-store",
            "type": "kv-store",
            "label": "Key-Value Store",
            "category": "storage",
            "description": "Low-latency lookups by key; great for sessions, counters, mappings.",
            "data": {
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            },
            "details": {
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Create and toggle flags"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Hot keys; uneven partitions"
                }
              ],
              "tradeoffs": "hot keys; uneven partitions; eventual consistency surprises",
              "failureModes": "hot keys; uneven partitions; eventual consistency surprises",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 420,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 460,
              "y": 200
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "kv-store": {
            "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
            "knobs": {
              "partitionKey": "",
              "ttl": "",
              "replication": "",
              "consistencyLevel": ""
            },
            "tradeoffs": "hot keys; uneven partitions; eventual consistency surprises",
            "failureModes": "hot keys; uneven partitions; eventual consistency surprises",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Evaluation performance",
        "Targeting model",
        "Propagation latency"
      ],
      "antiPatterns": [
        "DB hit per evaluation"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "kv-store",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "kv-store",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 15,
          "core": 4,
          "optional": 11,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            }
          },
          {
            "id": "worker",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Worker",
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            }
          },
          {
            "id": "event-log",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Event Log / Stream",
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            }
          },
          {
            "id": "pubsub",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Pub/Sub",
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            }
          },
          {
            "id": "stream-processor",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Stream Processor",
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            }
          },
          {
            "id": "data-warehouse",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Data Warehouse (OLAP)",
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "kv-store",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "Key-Value Store",
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1360
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1440
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1520
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-queue",
            "source": "app-service",
            "target": "queue"
          },
          {
            "id": "e-7-app-service-event-log",
            "source": "app-service",
            "target": "event-log"
          },
          {
            "id": "e-8-app-service-pubsub",
            "source": "app-service",
            "target": "pubsub"
          },
          {
            "id": "e-9-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-10-app-service-kv-store",
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "id": "e-11-app-service-worker",
            "source": "app-service",
            "target": "worker"
          },
          {
            "id": "e-12-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-13-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-14-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-15-queue-worker",
            "source": "queue",
            "target": "worker"
          },
          {
            "id": "e-16-event-log-worker",
            "source": "event-log",
            "target": "worker"
          },
          {
            "id": "e-17-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "kv-store",
          "label": "Key-Value Store",
          "reason": "Low-latency lookups by key; great for sessions, counters, mappings."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "kv-store"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "file-upload",
      "title": "Design a File Upload Service",
      "problemStatement": "Design Design a File Upload Service\nDesign Design a File Upload Service\nDesign Design a File Upload Service\nBuild a service for users to upload and download files. Support large files, resume, and CDN delivery.",
      "functionalRequirements": [
        "Design Design a File Upload Service",
        "Design Design a File Upload Service",
        "Design Design a File Upload Service",
        "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
        "Upload file (chunked for large)",
        "Design Design a File Upload Service",
        "Design Design a File Upload Service",
        "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
        "Upload file (chunked for large)",
        "Resume interrupted upload"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "queue",
            "label": "Queue",
            "category": "messaging",
            "description": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "data": {
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "details": {
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Backlog growth if consumer slow; DLQ for poison msgs"
                },
                {
                  "type": "FR",
                  "text": "Async task buffering and decoupling"
                },
                {
                  "type": "NFR",
                  "text": "Smooths traffic spikes"
                }
              ],
              "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "description": "Consumes async jobs/events; performs background processing.",
            "data": {
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "At-least-once; idempotency required"
                },
                {
                  "type": "FR",
                  "text": "Background processing of async jobs"
                },
                {
                  "type": "NFR",
                  "text": "Decouples sync path from heavy work"
                }
              ],
              "tradeoffs": "poison messages; retry storms; duplicate processing",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "description": "Durable ordered log for high-throughput event streaming and replay.",
            "data": {
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Consumer lag; hot partition; rebalancing"
                },
                {
                  "type": "FR",
                  "text": "Event streaming, replay, fanout"
                },
                {
                  "type": "NFR",
                  "text": "High-throughput ordered ingest"
                }
              ],
              "tradeoffs": "hot partition; consumer lag; rebalancing storms",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "object-storage",
            "type": "object-storage",
            "label": "Object Storage",
            "category": "storage",
            "description": "Stores large blobs (images/videos/files); durable and cost-effective.",
            "data": {
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            },
            "details": {
              "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
              "defaults": {
                "storageClass": "",
                "lifecyclePolicy": "",
                "versioning": "",
                "multipartUpload": ""
              },
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design a File Upload Service"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Eventual consistency; prefix hot spots"
                }
              ],
              "tradeoffs": "eventual consistency edge cases (some systems); hot prefix",
              "failureModes": "eventual consistency edge cases (some systems); hot prefix",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design a File Upload Service"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "kv-store",
            "type": "kv-store",
            "label": "Key-Value Store",
            "category": "storage",
            "description": "Low-latency lookups by key; great for sessions, counters, mappings.",
            "data": {
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            },
            "details": {
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Hot keys; uneven partitions"
                },
                {
                  "type": "FR",
                  "text": "Low-latency key lookups (sessions, counters)"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal sharding"
                }
              ],
              "tradeoffs": "hot keys; uneven partitions; eventual consistency surprises",
              "failureModes": "hot keys; uneven partitions; eventual consistency surprises",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 200,
              "y": 280
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "queue"
          },
          {
            "source": "app-service",
            "target": "event-log"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "object-storage"
          },
          {
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "source": "app-service",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "queue",
            "target": "worker"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "cdn"
          },
          {
            "source": "app-service",
            "target": "object-storage"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": {
              "visibilityTimeout": "",
              "maxRetries": "",
              "dlq": "",
              "fifo": "",
              "orderingKey": ""
            },
            "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "interviewHooks": []
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": {
              "concurrency": "",
              "retries": "",
              "idempotency": "",
              "batchSize": ""
            },
            "tradeoffs": "poison messages; retry storms; duplicate processing",
            "failureModes": "poison messages; retry storms; duplicate processing",
            "interviewHooks": []
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": {
              "partitions": "",
              "replication": "",
              "retention": "",
              "compaction": ""
            },
            "tradeoffs": "hot partition; consumer lag; rebalancing storms",
            "failureModes": "hot partition; consumer lag; rebalancing storms",
            "interviewHooks": []
          },
          "object-storage": {
            "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
            "knobs": {
              "storageClass": "",
              "lifecyclePolicy": "",
              "versioning": "",
              "multipartUpload": ""
            },
            "tradeoffs": "eventual consistency edge cases (some systems); hot prefix",
            "failureModes": "eventual consistency edge cases (some systems); hot prefix",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "kv-store": {
            "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
            "knobs": {
              "partitionKey": "",
              "ttl": "",
              "replication": "",
              "consistencyLevel": ""
            },
            "tradeoffs": "hot keys; uneven partitions; eventual consistency surprises",
            "failureModes": "hot keys; uneven partitions; eventual consistency surprises",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Multipart upload flow",
        "Resume strategy",
        "CDN invalidation"
      ],
      "antiPatterns": [
        "Single request for large files",
        "No checksum validation"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Upload file (chunked for large)"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              },
              {
                "type": "functional",
                "index": 8,
                "text": "Upload file (chunked for large)"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Resume interrupted upload"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "object-storage",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Upload file (chunked for large)"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              },
              {
                "type": "functional",
                "index": 8,
                "text": "Upload file (chunked for large)"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "kv-store",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Design Design a File Upload Service"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Design Design a File Upload Service",
              "Design Design a File Upload Service",
              "Design Design a File Upload Service",
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
              "Upload file (chunked for large)",
              "Design Design a File Upload Service",
              "Design Design a File Upload Service",
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
              "Upload file (chunked for large)",
              "Resume interrupted upload"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "Design Design a File Upload Service",
              "Design Design a File Upload Service",
              "Design Design a File Upload Service",
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
              "Design Design a File Upload Service",
              "Design Design a File Upload Service",
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "object-storage",
            "status": "optional",
            "justifications": [
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
              "Upload file (chunked for large)",
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
              "Upload file (chunked for large)"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "kv-store",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Design Design a File Upload Service",
              "Design Design a File Upload Service",
              "Design Design a File Upload Service",
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery.",
              "Design Design a File Upload Service",
              "Design Design a File Upload Service",
              "Build a service for users to upload and download files. Support large files, resume, and CDN delivery."
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 16,
          "core": 4,
          "optional": 12,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            }
          },
          {
            "id": "worker",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Worker",
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            }
          },
          {
            "id": "event-log",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Event Log / Stream",
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            }
          },
          {
            "id": "object-storage",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Object Storage",
              "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
              "defaults": {
                "storageClass": "",
                "lifecyclePolicy": "",
                "versioning": "",
                "multipartUpload": ""
              },
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            }
          },
          {
            "id": "stream-processor",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Stream Processor",
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            }
          },
          {
            "id": "data-warehouse",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Data Warehouse (OLAP)",
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "kv-store",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "Key-Value Store",
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1360
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1440
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-queue",
            "source": "app-service",
            "target": "queue"
          },
          {
            "id": "e-6-app-service-event-log",
            "source": "app-service",
            "target": "event-log"
          },
          {
            "id": "e-7-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-8-app-service-object-storage",
            "source": "app-service",
            "target": "object-storage"
          },
          {
            "id": "e-9-app-service-kv-store",
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "id": "e-10-app-service-worker",
            "source": "app-service",
            "target": "worker"
          },
          {
            "id": "e-11-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-12-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-13-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-14-queue-worker",
            "source": "queue",
            "target": "worker"
          },
          {
            "id": "e-15-event-log-worker",
            "source": "event-log",
            "target": "worker"
          },
          {
            "id": "e-16-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          },
          {
            "id": "e-17-app-service-object-storage",
            "source": "app-service",
            "target": "object-storage"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "queue",
          "label": "Queue",
          "reason": "Buffers tasks; decouples producers/consumers; smooths spikes."
        },
        {
          "type": "worker",
          "label": "Worker",
          "reason": "Consumes async jobs/events; performs background processing."
        },
        {
          "type": "event-log",
          "label": "Event Log / Stream",
          "reason": "Durable ordered log for high-throughput event streaming and replay."
        },
        {
          "type": "object-storage",
          "label": "Object Storage",
          "reason": "Stores large blobs (images/videos/files); durable and cost-effective."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "kv-store",
          "label": "Key-Value Store",
          "reason": "Low-latency lookups by key; great for sessions, counters, mappings."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "queue"
        },
        {
          "source": "app-service",
          "target": "event-log"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "object-storage"
        },
        {
          "source": "app-service",
          "target": "kv-store"
        },
        {
          "source": "app-service",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "queue",
          "target": "worker"
        },
        {
          "source": "event-log",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "cdn"
        },
        {
          "source": "app-service",
          "target": "object-storage"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "metrics-logging",
      "title": "Design Metrics and Logging",
      "problemStatement": "Design Design Metrics and Logging\nDesign Design Metrics and Logging\nDesign Design Metrics and Logging\nCollect metrics and logs from many services.",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "stream-processor",
            "type": "stream-processor",
            "label": "Stream Processor",
            "category": "analytics",
            "description": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
            "data": {
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            },
            "details": {
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Late events; state blowup; checkpoint lag"
                },
                {
                  "type": "FR",
                  "text": "Real-time aggregation and enrichment"
                },
                {
                  "type": "NFR",
                  "text": "Stream analytics"
                }
              ],
              "tradeoffs": "late events; state blowups; checkpoint lag",
              "failureModes": "late events; state blowups; checkpoint lag",
              "metrics": {}
            }
          },
          {
            "id": "data-warehouse",
            "type": "data-warehouse",
            "label": "Data Warehouse (OLAP)",
            "category": "analytics",
            "description": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
            "data": {
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            },
            "details": {
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Expensive scans; stale materializations"
                },
                {
                  "type": "FR",
                  "text": "BI queries and analytics"
                },
                {
                  "type": "NFR",
                  "text": "Columnar scan performance"
                }
              ],
              "tradeoffs": "expensive scans; bad partitioning; stale materializations",
              "failureModes": "expensive scans; bad partitioning; stale materializations",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 460,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 200,
              "y": 280
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "stream-processor": {
            "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
            "knobs": {
              "windowing": "",
              "watermarks": "",
              "stateStore": "",
              "checkpointing": ""
            },
            "tradeoffs": "late events; state blowups; checkpoint lag",
            "failureModes": "late events; state blowups; checkpoint lag",
            "interviewHooks": []
          },
          "data-warehouse": {
            "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
            "knobs": {
              "partitioning": "",
              "clustering": "",
              "retention": "",
              "materializedViews": ""
            },
            "tradeoffs": "expensive scans; bad partitioning; stale materializations",
            "failureModes": "expensive scans; bad partitioning; stale materializations",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Cardinality",
        "Retention"
      ],
      "antiPatterns": [
        "Unbounded cardinality"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "stream-processor",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "data-warehouse",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "stream-processor",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "data-warehouse",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 16,
          "core": 4,
          "optional": 12,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "search-index",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Search Index",
              "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
              "defaults": {
                "analyzers": "",
                "ranking": "",
                "shards": "",
                "replicas": "",
                "refreshInterval": ""
              },
              "notes": {
                "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
                "keyDecisions": [
                  "Configure analyzers",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale index",
                  "high write amplification"
                ]
              }
            }
          },
          {
            "id": "stream-processor",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Stream Processor",
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            }
          },
          {
            "id": "data-warehouse",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Data Warehouse (OLAP)",
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "queue"
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-search-index",
            "source": "app-service",
            "target": "search-index"
          },
          {
            "id": "e-7-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-8-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-9-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-10-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-11-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "stream-processor",
          "label": "Stream Processor",
          "reason": "Processes streams for aggregation, enrichment, windowing; outputs derived streams."
        },
        {
          "type": "data-warehouse",
          "label": "Data Warehouse (OLAP)",
          "reason": "Columnar analytics store for BI queries; optimized for scans/aggregations."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "news-feed",
      "title": "Design a News Feed",
      "problemStatement": "Design Design a News Feed\nDesign Design a News Feed\nDesign Design a News Feed\nBuild a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
      "functionalRequirements": [
        "Design Design a News Feed",
        "Design Design a News Feed",
        "Design Design a News Feed",
        "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
        "Post status update",
        "Design Design a News Feed",
        "Design Design a News Feed",
        "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
        "Post status update",
        "Follow/unfollow users"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design a News Feed"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "queue",
            "label": "Queue",
            "category": "messaging",
            "description": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "data": {
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "details": {
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Backlog growth if consumer slow; DLQ for poison msgs"
                },
                {
                  "type": "FR",
                  "text": "Async task buffering and decoupling"
                },
                {
                  "type": "NFR",
                  "text": "Smooths traffic spikes"
                }
              ],
              "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "description": "Consumes async jobs/events; performs background processing.",
            "data": {
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design a News Feed"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "At-least-once; idempotency required"
                }
              ],
              "tradeoffs": "poison messages; retry storms; duplicate processing",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "description": "Durable ordered log for high-throughput event streaming and replay.",
            "data": {
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design a News Feed"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Consumer lag; hot partition; rebalancing"
                }
              ],
              "tradeoffs": "hot partition; consumer lag; rebalancing storms",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "pubsub",
            "type": "pubsub",
            "label": "Pub/Sub",
            "category": "messaging",
            "description": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "data": {
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            },
            "details": {
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design a News Feed"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Slow consumer blocks others; use push/pull"
                }
              ],
              "tradeoffs": "slow consumer lag; fanout amplification",
              "failureModes": "slow consumer lag; fanout amplification",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design a News Feed"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "kv-store",
            "type": "kv-store",
            "label": "Key-Value Store",
            "category": "storage",
            "description": "Low-latency lookups by key; great for sessions, counters, mappings.",
            "data": {
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            },
            "details": {
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Hot keys; uneven partitions"
                }
              ],
              "tradeoffs": "hot keys; uneven partitions; eventual consistency surprises",
              "failureModes": "hot keys; uneven partitions; eventual consistency surprises",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design a News Feed"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 280,
              "y": 280
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "queue"
          },
          {
            "source": "app-service",
            "target": "event-log"
          },
          {
            "source": "app-service",
            "target": "pubsub"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "source": "app-service",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "queue",
            "target": "worker"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": {
              "visibilityTimeout": "",
              "maxRetries": "",
              "dlq": "",
              "fifo": "",
              "orderingKey": ""
            },
            "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "interviewHooks": []
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": {
              "concurrency": "",
              "retries": "",
              "idempotency": "",
              "batchSize": ""
            },
            "tradeoffs": "poison messages; retry storms; duplicate processing",
            "failureModes": "poison messages; retry storms; duplicate processing",
            "interviewHooks": []
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": {
              "partitions": "",
              "replication": "",
              "retention": "",
              "compaction": ""
            },
            "tradeoffs": "hot partition; consumer lag; rebalancing storms",
            "failureModes": "hot partition; consumer lag; rebalancing storms",
            "interviewHooks": []
          },
          "pubsub": {
            "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "knobs": {
              "subscriptionFilters": "",
              "retention": "",
              "ackDeadline": "",
              "replay": ""
            },
            "tradeoffs": "slow consumer lag; fanout amplification",
            "failureModes": "slow consumer lag; fanout amplification",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "kv-store": {
            "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
            "knobs": {
              "partitionKey": "",
              "ttl": "",
              "replication": "",
              "consistencyLevel": ""
            },
            "tradeoffs": "hot keys; uneven partitions; eventual consistency surprises",
            "failureModes": "hot keys; uneven partitions; eventual consistency surprises",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Fan-out strategy",
        "Celebrity handling",
        "Feed ranking tradeoffs"
      ],
      "antiPatterns": [
        "Naive fan-out on read for celebrities",
        "No caching of hot feeds"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Follow/unfollow users"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Follow/unfollow users"
              }
            ]
          },
          {
            "nodeId": "pubsub",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "kv-store",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
              "Follow/unfollow users"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
              "Follow/unfollow users"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "pubsub",
            "status": "optional",
            "justifications": [
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow.",
              "Build a Twitter-style feed. Users post and see chronologically ordered feed from people they follow."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "kv-store",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 18,
          "core": 4,
          "optional": 14,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            }
          },
          {
            "id": "worker",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Worker",
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            }
          },
          {
            "id": "event-log",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Event Log / Stream",
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            }
          },
          {
            "id": "pubsub",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Pub/Sub",
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            }
          },
          {
            "id": "object-storage",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Object Storage",
              "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
              "defaults": {
                "storageClass": "",
                "lifecyclePolicy": "",
                "versioning": "",
                "multipartUpload": ""
              },
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            }
          },
          {
            "id": "stream-processor",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Stream Processor",
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            }
          },
          {
            "id": "data-warehouse",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "Data Warehouse (OLAP)",
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "kv-store",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "Key-Value Store",
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 1360
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1440
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1520
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1600
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-queue",
            "source": "app-service",
            "target": "queue"
          },
          {
            "id": "e-7-app-service-event-log",
            "source": "app-service",
            "target": "event-log"
          },
          {
            "id": "e-8-app-service-pubsub",
            "source": "app-service",
            "target": "pubsub"
          },
          {
            "id": "e-9-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-10-app-service-object-storage",
            "source": "app-service",
            "target": "object-storage"
          },
          {
            "id": "e-11-app-service-kv-store",
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "id": "e-12-app-service-worker",
            "source": "app-service",
            "target": "worker"
          },
          {
            "id": "e-13-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-14-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-15-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-16-queue-worker",
            "source": "queue",
            "target": "worker"
          },
          {
            "id": "e-17-event-log-worker",
            "source": "event-log",
            "target": "worker"
          },
          {
            "id": "e-18-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          },
          {
            "id": "e-19-app-service-object-storage",
            "source": "app-service",
            "target": "object-storage"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "queue",
          "label": "Queue",
          "reason": "Buffers tasks; decouples producers/consumers; smooths spikes."
        },
        {
          "type": "worker",
          "label": "Worker",
          "reason": "Consumes async jobs/events; performs background processing."
        },
        {
          "type": "event-log",
          "label": "Event Log / Stream",
          "reason": "Durable ordered log for high-throughput event streaming and replay."
        },
        {
          "type": "pubsub",
          "label": "Pub/Sub",
          "reason": "Broadcasts events to multiple subscribers; decouples publishers from consumers."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "kv-store",
          "label": "Key-Value Store",
          "reason": "Low-latency lookups by key; great for sessions, counters, mappings."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "queue"
        },
        {
          "source": "app-service",
          "target": "event-log"
        },
        {
          "source": "app-service",
          "target": "pubsub"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "kv-store"
        },
        {
          "source": "app-service",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "queue",
          "target": "worker"
        },
        {
          "source": "event-log",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "notification",
      "title": "Design a Notification System",
      "problemStatement": "Design Design a Notification System\nDesign Design a Notification System\nDesign Design a Notification System\nBuild a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking.",
      "functionalRequirements": [
        "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking.",
        "Send push, email, SMS",
        "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking.",
        "Send push, email, SMS",
        "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking.",
        "Send push, email, SMS"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "queue",
            "label": "Queue",
            "category": "messaging",
            "description": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "data": {
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "details": {
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Backlog growth if consumer slow; DLQ for poison msgs"
                },
                {
                  "type": "FR",
                  "text": "Async task buffering and decoupling"
                },
                {
                  "type": "NFR",
                  "text": "Smooths traffic spikes"
                }
              ],
              "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "description": "Consumes async jobs/events; performs background processing.",
            "data": {
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "At-least-once; idempotency required"
                },
                {
                  "type": "FR",
                  "text": "Background processing of async jobs"
                },
                {
                  "type": "NFR",
                  "text": "Decouples sync path from heavy work"
                }
              ],
              "tradeoffs": "poison messages; retry storms; duplicate processing",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "description": "Durable ordered log for high-throughput event streaming and replay.",
            "data": {
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Consumer lag; hot partition; rebalancing"
                },
                {
                  "type": "FR",
                  "text": "Event streaming, replay, fanout"
                },
                {
                  "type": "NFR",
                  "text": "High-throughput ordered ingest"
                }
              ],
              "tradeoffs": "hot partition; consumer lag; rebalancing storms",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "pubsub",
            "type": "pubsub",
            "label": "Pub/Sub",
            "category": "messaging",
            "description": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "data": {
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            },
            "details": {
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Slow consumer blocks others; use push/pull"
                },
                {
                  "type": "FR",
                  "text": "Fanout to multiple subscribers"
                },
                {
                  "type": "NFR",
                  "text": "Decouples publishers from consumers"
                }
              ],
              "tradeoffs": "slow consumer lag; fanout amplification",
              "failureModes": "slow consumer lag; fanout amplification",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "scheduler",
            "type": "scheduler",
            "label": "Scheduler",
            "category": "compute",
            "description": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
            "data": {
              "notes": {
                "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
                "keyDecisions": [
                  "Configure interval",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "double-run without locking",
                  "missed runs"
                ]
              }
            },
            "details": {
              "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
              "defaults": {
                "interval": "",
                "jitter": "",
                "backfill": "",
                "lock": ""
              },
              "notes": {
                "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
                "keyDecisions": [
                  "Configure interval",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "double-run without locking",
                  "missed runs"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Double-run without locking; missed runs"
                },
                {
                  "type": "FR",
                  "text": "Periodic jobs, cleanup, rollups"
                },
                {
                  "type": "NFR",
                  "text": "Batch processing"
                }
              ],
              "tradeoffs": "double-run without locking; missed runs; clock skew",
              "failureModes": "double-run without locking; missed runs; clock skew",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 280,
              "y": 280
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "queue"
          },
          {
            "source": "app-service",
            "target": "event-log"
          },
          {
            "source": "app-service",
            "target": "pubsub"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "queue",
            "target": "worker"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": {
              "visibilityTimeout": "",
              "maxRetries": "",
              "dlq": "",
              "fifo": "",
              "orderingKey": ""
            },
            "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "interviewHooks": []
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": {
              "concurrency": "",
              "retries": "",
              "idempotency": "",
              "batchSize": ""
            },
            "tradeoffs": "poison messages; retry storms; duplicate processing",
            "failureModes": "poison messages; retry storms; duplicate processing",
            "interviewHooks": []
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": {
              "partitions": "",
              "replication": "",
              "retention": "",
              "compaction": ""
            },
            "tradeoffs": "hot partition; consumer lag; rebalancing storms",
            "failureModes": "hot partition; consumer lag; rebalancing storms",
            "interviewHooks": []
          },
          "pubsub": {
            "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "knobs": {
              "subscriptionFilters": "",
              "retention": "",
              "ackDeadline": "",
              "replay": ""
            },
            "tradeoffs": "slow consumer lag; fanout amplification",
            "failureModes": "slow consumer lag; fanout amplification",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "scheduler": {
            "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
            "knobs": {
              "interval": "",
              "jitter": "",
              "backfill": "",
              "lock": ""
            },
            "tradeoffs": "double-run without locking; missed runs; clock skew",
            "failureModes": "double-run without locking; missed runs; clock skew",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Channel abstraction",
        "Batching for email",
        "Idempotency"
      ],
      "antiPatterns": [
        "Synchronous send"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking."
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking."
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "pubsub",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "scheduler",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking."
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking."
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking.",
              "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking.",
              "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "pubsub",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "scheduler",
            "status": "optional",
            "justifications": [
              "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking.",
              "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking.",
              "Build a system to send push, email, SMS to users. Support preferences, batching, and delivery tracking."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 18,
          "core": 4,
          "optional": 14,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            }
          },
          {
            "id": "worker",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Worker",
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            }
          },
          {
            "id": "event-log",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Event Log / Stream",
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            }
          },
          {
            "id": "pubsub",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Pub/Sub",
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "scheduler",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "Scheduler",
              "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
              "defaults": {
                "interval": "",
                "jitter": "",
                "backfill": "",
                "lock": ""
              },
              "notes": {
                "purpose": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines).",
                "keyDecisions": [
                  "Configure interval",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "double-run without locking",
                  "missed runs"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1360
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-queue",
            "source": "app-service",
            "target": "queue"
          },
          {
            "id": "e-7-app-service-event-log",
            "source": "app-service",
            "target": "event-log"
          },
          {
            "id": "e-8-app-service-pubsub",
            "source": "app-service",
            "target": "pubsub"
          },
          {
            "id": "e-9-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-10-app-service-worker",
            "source": "app-service",
            "target": "worker"
          },
          {
            "id": "e-11-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-12-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-13-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-14-queue-worker",
            "source": "queue",
            "target": "worker"
          },
          {
            "id": "e-15-event-log-worker",
            "source": "event-log",
            "target": "worker"
          },
          {
            "id": "e-16-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "queue",
          "label": "Queue",
          "reason": "Buffers tasks; decouples producers/consumers; smooths spikes."
        },
        {
          "type": "worker",
          "label": "Worker",
          "reason": "Consumes async jobs/events; performs background processing."
        },
        {
          "type": "event-log",
          "label": "Event Log / Stream",
          "reason": "Durable ordered log for high-throughput event streaming and replay."
        },
        {
          "type": "pubsub",
          "label": "Pub/Sub",
          "reason": "Broadcasts events to multiple subscribers; decouples publishers from consumers."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "scheduler",
          "label": "Scheduler",
          "reason": "Runs periodic jobs (cleanup, compaction, rollups, batch pipelines)."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "queue"
        },
        {
          "source": "app-service",
          "target": "event-log"
        },
        {
          "source": "app-service",
          "target": "pubsub"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "queue",
          "target": "worker"
        },
        {
          "source": "event-log",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "pack-1771299341492-design-cache-invalidation-serv",
      "title": "Designing Design Cache Invalidation Service",
      "problemStatement": "Design Designing Design Cache Invalidation Service\nDesign Designing Design Cache Invalidation Service\nDesign Designing Design Cache Invalidation Service\nDesign Design Cache Invalidation Service",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraints": [],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "designPlan": {
        "workload": {
          "traffic": "moderate",
          "storage": "moderate",
          "latency": "p99 < 200ms",
          "availability": "99.9%"
        },
        "coreFlows": [
          {
            "id": "flow-1",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-2",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-3",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-4",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-5",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-6",
            "description": "User can perform core actions",
            "type": "primary"
          }
        ],
        "entities": [
          "User",
          "Resource"
        ],
        "accessPatterns": [],
        "risks": [],
        "qualityGoals": []
      },
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "cache-invalidation",
            "type": "cache-invalidation",
            "label": "Cache Invalidation Stream",
            "category": "caching",
            "description": "Propagates invalidation events to caches to keep data fresh.",
            "data": {
              "notes": {
                "purpose": "Propagates invalidation events to caches to keep data fresh.",
                "keyDecisions": [
                  "Configure keys",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "missed invalidations",
                  "out-of-order invalidations"
                ]
              }
            },
            "details": {
              "purpose": "Propagates invalidation events to caches to keep data fresh.",
              "defaults": {
                "keys": "",
                "batching": "",
                "dedupe": ""
              },
              "notes": {
                "purpose": "Propagates invalidation events to caches to keep data fresh.",
                "keyDecisions": [
                  "Configure keys",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "missed invalidations",
                  "out-of-order invalidations"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Missed invalidations cause stale reads"
                },
                {
                  "type": "FR",
                  "text": "Propagate invalidation events"
                },
                {
                  "type": "NFR",
                  "text": "Cache freshness"
                }
              ],
              "tradeoffs": "missed invalidations; out-of-order invalidations",
              "failureModes": "missed invalidations; out-of-order invalidations",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 420,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 460,
              "y": 200
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "cache-invalidation": {
            "purpose": "Propagates invalidation events to caches to keep data fresh.",
            "knobs": {
              "keys": "",
              "batching": "",
              "dedupe": ""
            },
            "tradeoffs": "missed invalidations; out-of-order invalidations",
            "failureModes": "missed invalidations; out-of-order invalidations",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache-invalidation",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache-invalidation",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 15,
          "core": 4,
          "optional": 11,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "scoringRubric": [],
      "antiPatterns": [],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "cache-invalidation",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Cache Invalidation Stream",
              "purpose": "Propagates invalidation events to caches to keep data fresh.",
              "defaults": {
                "keys": "",
                "batching": "",
                "dedupe": ""
              },
              "notes": {
                "purpose": "Propagates invalidation events to caches to keep data fresh.",
                "keyDecisions": [
                  "Configure keys",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "missed invalidations",
                  "out-of-order invalidations"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "queue"
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-7-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-8-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-9-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-10-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "cache-invalidation",
          "label": "Cache Invalidation Stream",
          "reason": "Propagates invalidation events to caches to keep data fresh."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "pack-1771299402156-design-cache-invalidation-serv",
      "title": "Designing Design Cache Invalidation Service",
      "problemStatement": "Design Designing Design Cache Invalidation Service\nDesign Designing Design Cache Invalidation Service\nDesign Designing Design Cache Invalidation Service\nDesign Design Cache Invalidation Service",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraints": [],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "designPlan": {
        "workload": {
          "traffic": "moderate",
          "storage": "moderate",
          "latency": "p99 < 200ms",
          "availability": "99.9%"
        },
        "coreFlows": [
          {
            "id": "flow-1",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-2",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-3",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-4",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-5",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-6",
            "description": "User can perform core actions",
            "type": "primary"
          }
        ],
        "entities": [
          "User",
          "Resource"
        ],
        "accessPatterns": [],
        "risks": [],
        "qualityGoals": []
      },
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "cache-invalidation",
            "type": "cache-invalidation",
            "label": "Cache Invalidation Stream",
            "category": "caching",
            "description": "Propagates invalidation events to caches to keep data fresh.",
            "data": {
              "notes": {
                "purpose": "Propagates invalidation events to caches to keep data fresh.",
                "keyDecisions": [
                  "Configure keys",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "missed invalidations",
                  "out-of-order invalidations"
                ]
              }
            },
            "details": {
              "purpose": "Propagates invalidation events to caches to keep data fresh.",
              "defaults": {
                "keys": "",
                "batching": "",
                "dedupe": ""
              },
              "notes": {
                "purpose": "Propagates invalidation events to caches to keep data fresh.",
                "keyDecisions": [
                  "Configure keys",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "missed invalidations",
                  "out-of-order invalidations"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Missed invalidations cause stale reads"
                },
                {
                  "type": "FR",
                  "text": "Propagate invalidation events"
                },
                {
                  "type": "NFR",
                  "text": "Cache freshness"
                }
              ],
              "tradeoffs": "missed invalidations; out-of-order invalidations",
              "failureModes": "missed invalidations; out-of-order invalidations",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 420,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 460,
              "y": 200
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "cache-invalidation": {
            "purpose": "Propagates invalidation events to caches to keep data fresh.",
            "knobs": {
              "keys": "",
              "batching": "",
              "dedupe": ""
            },
            "tradeoffs": "missed invalidations; out-of-order invalidations",
            "failureModes": "missed invalidations; out-of-order invalidations",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache-invalidation",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache-invalidation",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 15,
          "core": 4,
          "optional": 11,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "scoringRubric": [],
      "antiPatterns": [],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "cache-invalidation",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Cache Invalidation Stream",
              "purpose": "Propagates invalidation events to caches to keep data fresh.",
              "defaults": {
                "keys": "",
                "batching": "",
                "dedupe": ""
              },
              "notes": {
                "purpose": "Propagates invalidation events to caches to keep data fresh.",
                "keyDecisions": [
                  "Configure keys",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "missed invalidations",
                  "out-of-order invalidations"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "queue"
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-7-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-8-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-9-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-10-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "cache-invalidation",
          "label": "Cache Invalidation Stream",
          "reason": "Propagates invalidation events to caches to keep data fresh."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "payment",
      "title": "Design Payment System",
      "problemStatement": "Design Design Payment System\nDesign Design Payment System\nDesign Design Payment System\nProcess charges, refunds, idempotency.",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 380,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 420,
              "y": 200
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Idempotency"
      ],
      "antiPatterns": [
        "No idempotency"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 14,
          "core": 4,
          "optional": 10,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "queue"
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-7-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-8-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-9-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-10-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "rate-limiter",
      "title": "Design a Rate Limiter",
      "problemStatement": "Design Design a Rate Limiter\nDesign Design a Rate Limiter\nDesign Design a Rate Limiter\nBuild a distributed rate limiter. Limit requests per user/IP/key. Must work across multiple servers.",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 380,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 420,
              "y": 200
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Token bucket vs sliding window",
        "Redis data structure",
        "Distributed sync"
      ],
      "antiPatterns": [
        "In-memory only (not distributed)"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 14,
          "core": 4,
          "optional": 10,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "queue"
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-7-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-8-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-9-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-10-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "ride-sharing",
      "title": "Design Ride Sharing (Uber/Lyft)",
      "problemStatement": "Design Design Ride Sharing (Uber/Lyft)\nDesign Design Ride Sharing (Uber/Lyft)\nDesign Design Ride Sharing (Uber/Lyft)\nMatch riders with drivers. Real-time location, ETA, surge pricing.",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "queue",
            "label": "Queue",
            "category": "messaging",
            "description": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "data": {
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "details": {
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Backlog growth if consumer slow; DLQ for poison msgs"
                },
                {
                  "type": "FR",
                  "text": "Async task buffering and decoupling"
                },
                {
                  "type": "NFR",
                  "text": "Smooths traffic spikes"
                }
              ],
              "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "description": "Consumes async jobs/events; performs background processing.",
            "data": {
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "At-least-once; idempotency required"
                },
                {
                  "type": "FR",
                  "text": "Background processing of async jobs"
                },
                {
                  "type": "NFR",
                  "text": "Decouples sync path from heavy work"
                }
              ],
              "tradeoffs": "poison messages; retry storms; duplicate processing",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "description": "Durable ordered log for high-throughput event streaming and replay.",
            "data": {
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Consumer lag; hot partition; rebalancing"
                },
                {
                  "type": "FR",
                  "text": "Event streaming, replay, fanout"
                },
                {
                  "type": "NFR",
                  "text": "High-throughput ordered ingest"
                }
              ],
              "tradeoffs": "hot partition; consumer lag; rebalancing storms",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "pubsub",
            "type": "pubsub",
            "label": "Pub/Sub",
            "category": "messaging",
            "description": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "data": {
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            },
            "details": {
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Slow consumer blocks others; use push/pull"
                },
                {
                  "type": "FR",
                  "text": "Fanout to multiple subscribers"
                },
                {
                  "type": "NFR",
                  "text": "Decouples publishers from consumers"
                }
              ],
              "tradeoffs": "slow consumer lag; fanout amplification",
              "failureModes": "slow consumer lag; fanout amplification",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 240,
              "y": 280
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "queue"
          },
          {
            "source": "app-service",
            "target": "event-log"
          },
          {
            "source": "app-service",
            "target": "pubsub"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "queue",
            "target": "worker"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": {
              "visibilityTimeout": "",
              "maxRetries": "",
              "dlq": "",
              "fifo": "",
              "orderingKey": ""
            },
            "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "interviewHooks": []
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": {
              "concurrency": "",
              "retries": "",
              "idempotency": "",
              "batchSize": ""
            },
            "tradeoffs": "poison messages; retry storms; duplicate processing",
            "failureModes": "poison messages; retry storms; duplicate processing",
            "interviewHooks": []
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": {
              "partitions": "",
              "replication": "",
              "retention": "",
              "compaction": ""
            },
            "tradeoffs": "hot partition; consumer lag; rebalancing storms",
            "failureModes": "hot partition; consumer lag; rebalancing storms",
            "interviewHooks": []
          },
          "pubsub": {
            "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "knobs": {
              "subscriptionFilters": "",
              "retention": "",
              "ackDeadline": "",
              "replay": ""
            },
            "tradeoffs": "slow consumer lag; fanout amplification",
            "failureModes": "slow consumer lag; fanout amplification",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Geohash vs grid",
        "Matching algorithm",
        "Location update frequency"
      ],
      "antiPatterns": [
        "DB scan for nearby"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "pubsub",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "pubsub",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 17,
          "core": 4,
          "optional": 13,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            }
          },
          {
            "id": "worker",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Worker",
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            }
          },
          {
            "id": "event-log",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Event Log / Stream",
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            }
          },
          {
            "id": "pubsub",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Pub/Sub",
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "notes": {
                "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "keyDecisions": [
                  "Configure subscriptionFilters",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "slow consumer lag",
                  "fanout amplification"
                ]
              }
            }
          },
          {
            "id": "stream-processor",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Stream Processor",
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            }
          },
          {
            "id": "data-warehouse",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Data Warehouse (OLAP)",
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1360
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1440
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-queue",
            "source": "app-service",
            "target": "queue"
          },
          {
            "id": "e-7-app-service-event-log",
            "source": "app-service",
            "target": "event-log"
          },
          {
            "id": "e-8-app-service-pubsub",
            "source": "app-service",
            "target": "pubsub"
          },
          {
            "id": "e-9-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-10-app-service-worker",
            "source": "app-service",
            "target": "worker"
          },
          {
            "id": "e-11-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-12-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-13-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-14-queue-worker",
            "source": "queue",
            "target": "worker"
          },
          {
            "id": "e-15-event-log-worker",
            "source": "event-log",
            "target": "worker"
          },
          {
            "id": "e-16-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "queue",
          "label": "Queue",
          "reason": "Buffers tasks; decouples producers/consumers; smooths spikes."
        },
        {
          "type": "worker",
          "label": "Worker",
          "reason": "Consumes async jobs/events; performs background processing."
        },
        {
          "type": "event-log",
          "label": "Event Log / Stream",
          "reason": "Durable ordered log for high-throughput event streaming and replay."
        },
        {
          "type": "pubsub",
          "label": "Pub/Sub",
          "reason": "Broadcasts events to multiple subscribers; decouples publishers from consumers."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "queue"
        },
        {
          "source": "app-service",
          "target": "event-log"
        },
        {
          "source": "app-service",
          "target": "pubsub"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "queue",
          "target": "worker"
        },
        {
          "source": "event-log",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "search-autocomplete",
      "title": "Design Search Autocomplete",
      "problemStatement": "Design Design Search Autocomplete\nDesign Design Search Autocomplete\nDesign Design Search Autocomplete\nBuild Google-like autocomplete. As user types, show top K suggestions. Low latency critical.",
      "functionalRequirements": [
        "Design Design Search Autocomplete",
        "Design Design Search Autocomplete",
        "Design Design Search Autocomplete",
        "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical.",
        "Design Design Search Autocomplete",
        "Design Design Search Autocomplete",
        "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical.",
        "Design Design Search Autocomplete",
        "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical.",
        "Millions of search terms"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical."
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "search-index",
            "type": "search-index",
            "label": "Search Index",
            "category": "search",
            "description": "Supports text search, filtering, ranking; maintains inverted index.",
            "data": {
              "notes": {
                "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
                "keyDecisions": [
                  "Configure analyzers",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale index",
                  "high write amplification"
                ]
              }
            },
            "details": {
              "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
              "defaults": {
                "analyzers": "",
                "ranking": "",
                "shards": "",
                "replicas": "",
                "refreshInterval": ""
              },
              "notes": {
                "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
                "keyDecisions": [
                  "Configure analyzers",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale index",
                  "high write amplification"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design Search Autocomplete"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stale index; high write amplification"
                }
              ],
              "tradeoffs": "stale index; high write amplification; hot shards",
              "failureModes": "stale index; high write amplification; hot shards",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Design Design Search Autocomplete"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 420,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 460,
              "y": 200
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "search-index"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "search-index": {
            "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
            "knobs": {
              "analyzers": "",
              "ranking": "",
              "shards": "",
              "replicas": "",
              "refreshInterval": ""
            },
            "tradeoffs": "stale index; high write amplification; hot shards",
            "failureModes": "stale index; high write amplification; hot shards",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Trie vs n-gram",
        "Caching hot prefixes",
        "Update propagation"
      ],
      "antiPatterns": [
        "DB query per keystroke",
        "No caching"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical."
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 6,
                "text": "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical."
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 8,
                "text": "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical."
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "search-index",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Design Design Search Autocomplete"
              },
              {
                "type": "functional",
                "index": 9,
                "text": "Millions of search terms"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical.",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical.",
              "Design Design Search Autocomplete",
              "Build Google-like autocomplete. As user types, show top K suggestions. Low latency critical.",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "search-index",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Design Design Search Autocomplete",
              "Millions of search terms"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 15,
          "core": 4,
          "optional": 11,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "search-index",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Search Index",
              "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
              "defaults": {
                "analyzers": "",
                "ranking": "",
                "shards": "",
                "replicas": "",
                "refreshInterval": ""
              },
              "notes": {
                "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
                "keyDecisions": [
                  "Configure analyzers",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale index",
                  "high write amplification"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "circuit-breaker",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Circuit Breaker",
              "purpose": "Stops calling failing dependencies to prevent cascading failures.",
              "defaults": {
                "errorThreshold": "",
                "openDuration": "",
                "halfOpenProbes": "",
                "fallback": ""
              },
              "notes": {
                "purpose": "Stops calling failing dependencies to prevent cascading failures.",
                "keyDecisions": [
                  "Configure errorThreshold",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad thresholds causing flapping",
                  "no fallback path"
                ]
              }
            }
          },
          {
            "id": "retry-policy",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Retry Policy",
              "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
              "defaults": {
                "maxRetries": "",
                "backoff": "",
                "jitter": "",
                "retryBudget": ""
              },
              "notes": {
                "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
                "keyDecisions": [
                  "Configure maxRetries",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "retry storms",
                  "retrying non-idempotent ops"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "tracing",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "Tracing",
              "purpose": "Distributed tracing to understand request paths and latency contributors.",
              "defaults": {
                "sampling": "",
                "propagation": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Distributed tracing to understand request paths and latency contributors.",
                "keyDecisions": [
                  "Sample 110% of requests",
                  "Propagate trace context across services"
                ],
                "failureModes": [
                  "Missing propagation",
                  "Sampling hides tail latencies"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "queue"
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1360
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-search-index",
            "source": "app-service",
            "target": "search-index"
          },
          {
            "id": "e-7-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-8-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-9-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-10-app-service-tracing",
            "source": "app-service",
            "target": "tracing"
          },
          {
            "id": "e-11-app-service-circuit-breaker",
            "source": "app-service",
            "target": "circuit-breaker"
          },
          {
            "id": "e-12-app-service-retry-policy",
            "source": "app-service",
            "target": "retry-policy"
          },
          {
            "id": "e-13-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-14-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "search-index",
          "label": "Search Index",
          "reason": "Supports text search, filtering, ranking; maintains inverted index."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "search-index"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "url-shortener",
      "title": "Design a URL Shortener",
      "problemStatement": "Design Design a URL Shortener\nDesign Design a URL Shortener\nDesign Design a URL Shortener\nBuild a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly available.",
      "functionalRequirements": [
        "Design Design a URL Shortener",
        "Design Design a URL Shortener",
        "Design Design a URL Shortener",
        "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly",
        "Shorten a long URL to a short alias",
        "Design Design a URL Shortener",
        "Design Design a URL Shortener",
        "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly",
        "Shorten a long URL to a short alias",
        "Redirect short URL to original URL"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "stream-processor",
            "type": "stream-processor",
            "label": "Stream Processor",
            "category": "analytics",
            "description": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
            "data": {
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            },
            "details": {
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Late events; state blowup; checkpoint lag"
                },
                {
                  "type": "FR",
                  "text": "Real-time aggregation and enrichment"
                },
                {
                  "type": "NFR",
                  "text": "Stream analytics"
                }
              ],
              "tradeoffs": "late events; state blowups; checkpoint lag",
              "failureModes": "late events; state blowups; checkpoint lag",
              "metrics": {}
            }
          },
          {
            "id": "data-warehouse",
            "type": "data-warehouse",
            "label": "Data Warehouse (OLAP)",
            "category": "analytics",
            "description": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
            "data": {
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            },
            "details": {
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Expensive scans; stale materializations"
                },
                {
                  "type": "FR",
                  "text": "BI queries and analytics"
                },
                {
                  "type": "NFR",
                  "text": "Columnar scan performance"
                }
              ],
              "tradeoffs": "expensive scans; bad partitioning; stale materializations",
              "failureModes": "expensive scans; bad partitioning; stale materializations",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 460,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 200,
              "y": 280
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "stream-processor": {
            "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
            "knobs": {
              "windowing": "",
              "watermarks": "",
              "stateStore": "",
              "checkpointing": ""
            },
            "tradeoffs": "late events; state blowups; checkpoint lag",
            "failureModes": "late events; state blowups; checkpoint lag",
            "interviewHooks": []
          },
          "data-warehouse": {
            "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
            "knobs": {
              "partitioning": "",
              "clustering": "",
              "retention": "",
              "materializedViews": ""
            },
            "tradeoffs": "expensive scans; bad partitioning; stale materializations",
            "failureModes": "expensive scans; bad partitioning; stale materializations",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "Hash or encoding for short code (base62)",
        "Cache for redirect path (read-heavy)",
        "DB choice: SQL vs NoSQL with rationale",
        "Collision handling for custom alias",
        "Analytics: async, approximate vs exact"
      ],
      "antiPatterns": [
        "Synchronous DB on every redirect",
        "No cache for hot redirects",
        "Sequential ID for short code (predictable)"
      ],
      "starterHints": [
        "Start with read:write ratio",
        "Hash vs encoding for short code",
        "Cache redirect path"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "functional",
                "index": 9,
                "text": "Redirect short URL to original URL"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
              }
            ]
          },
          {
            "nodeId": "stream-processor",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "data-warehouse",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "functional",
                "index": 3,
                "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
              },
              {
                "type": "functional",
                "index": 7,
                "text": "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly",
              "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Redirect short URL to original URL"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly",
              "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "stream-processor",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "data-warehouse",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly",
              "Build a service like bit.ly. Users submit long URLs and get short aliases. Redirects must be fast and highly"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 16,
          "core": 4,
          "optional": 12,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "stream-processor",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Stream Processor",
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            }
          },
          {
            "id": "data-warehouse",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Data Warehouse (OLAP)",
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "kv-store",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Key-Value Store",
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "queue"
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-7-app-service-kv-store",
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "id": "e-8-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-9-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-10-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-11-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "stream-processor",
          "label": "Stream Processor",
          "reason": "Processes streams for aggregation, enrichment, windowing; outputs derived streams."
        },
        {
          "type": "data-warehouse",
          "label": "Data Warehouse (OLAP)",
          "reason": "Columnar analytics store for BI queries; optimized for scans/aggregations."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "video-streaming",
      "title": "Design Video Streaming",
      "problemStatement": "Design Design Video Streaming\nDesign Design Video Streaming\nDesign Design Video Streaming\nBuild YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
      "functionalRequirements": [
        "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
        "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
        "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
        "Upload video",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "queue",
            "label": "Queue",
            "category": "messaging",
            "description": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "data": {
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "details": {
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Backlog growth if consumer slow; DLQ for poison msgs"
                },
                {
                  "type": "FR",
                  "text": "Async task buffering and decoupling"
                },
                {
                  "type": "NFR",
                  "text": "Smooths traffic spikes"
                }
              ],
              "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "description": "Consumes async jobs/events; performs background processing.",
            "data": {
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "At-least-once; idempotency required"
                }
              ],
              "tradeoffs": "poison messages; retry storms; duplicate processing",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "description": "Durable ordered log for high-throughput event streaming and replay.",
            "data": {
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Consumer lag; hot partition; rebalancing"
                }
              ],
              "tradeoffs": "hot partition; consumer lag; rebalancing storms",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "object-storage",
            "type": "object-storage",
            "label": "Object Storage",
            "category": "storage",
            "description": "Stores large blobs (images/videos/files); durable and cost-effective.",
            "data": {
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            },
            "details": {
              "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
              "defaults": {
                "storageClass": "",
                "lifecyclePolicy": "",
                "versioning": "",
                "multipartUpload": ""
              },
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Eventual consistency; prefix hot spots"
                }
              ],
              "tradeoffs": "eventual consistency edge cases (some systems); hot prefix",
              "failureModes": "eventual consistency edge cases (some systems); hot prefix",
              "metrics": {}
            }
          },
          {
            "id": "stream-processor",
            "type": "stream-processor",
            "label": "Stream Processor",
            "category": "analytics",
            "description": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
            "data": {
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            },
            "details": {
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Late events; state blowup; checkpoint lag"
                }
              ],
              "tradeoffs": "late events; state blowups; checkpoint lag",
              "failureModes": "late events; state blowups; checkpoint lag",
              "metrics": {}
            }
          },
          {
            "id": "data-warehouse",
            "type": "data-warehouse",
            "label": "Data Warehouse (OLAP)",
            "category": "analytics",
            "description": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
            "data": {
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            },
            "details": {
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Expensive scans; stale materializations"
                },
                {
                  "type": "FR",
                  "text": "BI queries and analytics"
                },
                {
                  "type": "NFR",
                  "text": "Columnar scan performance"
                }
              ],
              "tradeoffs": "expensive scans; bad partitioning; stale materializations",
              "failureModes": "expensive scans; bad partitioning; stale materializations",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
                },
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "kv-store",
            "type": "kv-store",
            "label": "Key-Value Store",
            "category": "storage",
            "description": "Low-latency lookups by key; great for sessions, counters, mappings.",
            "data": {
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            },
            "details": {
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Hot keys; uneven partitions"
                },
                {
                  "type": "FR",
                  "text": "Low-latency key lookups (sessions, counters)"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal sharding"
                }
              ],
              "tradeoffs": "hot keys; uneven partitions; eventual consistency surprises",
              "failureModes": "hot keys; uneven partitions; eventual consistency surprises",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 280,
              "y": 280
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "queue"
          },
          {
            "source": "app-service",
            "target": "event-log"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "object-storage"
          },
          {
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "source": "app-service",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "queue",
            "target": "worker"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "cdn"
          },
          {
            "source": "app-service",
            "target": "object-storage"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": {
              "visibilityTimeout": "",
              "maxRetries": "",
              "dlq": "",
              "fifo": "",
              "orderingKey": ""
            },
            "tradeoffs": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
            "interviewHooks": []
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": {
              "concurrency": "",
              "retries": "",
              "idempotency": "",
              "batchSize": ""
            },
            "tradeoffs": "poison messages; retry storms; duplicate processing",
            "failureModes": "poison messages; retry storms; duplicate processing",
            "interviewHooks": []
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": {
              "partitions": "",
              "replication": "",
              "retention": "",
              "compaction": ""
            },
            "tradeoffs": "hot partition; consumer lag; rebalancing storms",
            "failureModes": "hot partition; consumer lag; rebalancing storms",
            "interviewHooks": []
          },
          "object-storage": {
            "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
            "knobs": {
              "storageClass": "",
              "lifecyclePolicy": "",
              "versioning": "",
              "multipartUpload": ""
            },
            "tradeoffs": "eventual consistency edge cases (some systems); hot prefix",
            "failureModes": "eventual consistency edge cases (some systems); hot prefix",
            "interviewHooks": []
          },
          "stream-processor": {
            "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
            "knobs": {
              "windowing": "",
              "watermarks": "",
              "stateStore": "",
              "checkpointing": ""
            },
            "tradeoffs": "late events; state blowups; checkpoint lag",
            "failureModes": "late events; state blowups; checkpoint lag",
            "interviewHooks": []
          },
          "data-warehouse": {
            "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
            "knobs": {
              "partitioning": "",
              "clustering": "",
              "retention": "",
              "materializedViews": ""
            },
            "tradeoffs": "expensive scans; bad partitioning; stale materializations",
            "failureModes": "expensive scans; bad partitioning; stale materializations",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "kv-store": {
            "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
            "knobs": {
              "partitionKey": "",
              "ttl": "",
              "replication": "",
              "consistencyLevel": ""
            },
            "tradeoffs": "hot keys; uneven partitions; eventual consistency surprises",
            "failureModes": "hot keys; uneven partitions; eventual consistency surprises",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "ABR strategy",
        "Transcode pipeline",
        "CDN strategy"
      ],
      "antiPatterns": [
        "Single quality",
        "Sync transcode"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 3,
                "text": "Upload video"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              }
            ]
          },
          {
            "nodeId": "object-storage",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "stream-processor",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              }
            ]
          },
          {
            "nodeId": "data-warehouse",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              }
            ]
          },
          {
            "nodeId": "kv-store",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 1,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              },
              {
                "type": "functional",
                "index": 2,
                "text": "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Upload video"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "object-storage",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "stream-processor",
            "status": "optional",
            "justifications": [
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "data-warehouse",
            "status": "optional",
            "justifications": [
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "kv-store",
            "status": "optional",
            "justifications": [
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate.",
              "Build YouTube/Netflix-style streaming. Upload, transcode, store, and serve video with adaptive bitrate."
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 18,
          "core": 4,
          "optional": 14,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "notes": {
                "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "keyDecisions": [
                  "Configure visibilityTimeout",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "backlog growth",
                  "duplicate delivery"
                ]
              }
            }
          },
          {
            "id": "worker",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "Worker",
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "notes": {
                "purpose": "Consumes async jobs/events; performs background processing.",
                "keyDecisions": [
                  "Idempotent processing; DLQ for poison",
                  "Scale consumers with partition count"
                ],
                "failureModes": [
                  "Poison messages block partition",
                  "Retry storms without backoff"
                ]
              }
            }
          },
          {
            "id": "event-log",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "Event Log / Stream",
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "notes": {
                "purpose": "Durable ordered log for high-throughput event streaming and replay.",
                "keyDecisions": [
                  "Partition by conversationId for ordering",
                  "Retention policy; compaction for deletes"
                ],
                "failureModes": [
                  "Hot partition; consumer lag",
                  "Rebalancing storms"
                ]
              }
            }
          },
          {
            "id": "object-storage",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Object Storage",
              "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
              "defaults": {
                "storageClass": "",
                "lifecyclePolicy": "",
                "versioning": "",
                "multipartUpload": ""
              },
              "notes": {
                "purpose": "Stores large blobs (images/videos/files); durable and cost-effective.",
                "keyDecisions": [
                  "Presigned URLs for direct upload",
                  "Lifecycle policies for archival"
                ],
                "failureModes": [
                  "Eventual consistency edge cases",
                  "Hot prefix for popular media"
                ]
              }
            }
          },
          {
            "id": "stream-processor",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Stream Processor",
              "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
              "defaults": {
                "windowing": "",
                "watermarks": "",
                "stateStore": "",
                "checkpointing": ""
              },
              "notes": {
                "purpose": "Processes streams for aggregation, enrichment, windowing; outputs derived streams.",
                "keyDecisions": [
                  "Configure windowing",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "late events",
                  "state blowups"
                ]
              }
            }
          },
          {
            "id": "data-warehouse",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Data Warehouse (OLAP)",
              "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
              "defaults": {
                "partitioning": "",
                "clustering": "",
                "retention": "",
                "materializedViews": ""
              },
              "notes": {
                "purpose": "Columnar analytics store for BI queries; optimized for scans/aggregations.",
                "keyDecisions": [
                  "Configure partitioning",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "expensive scans",
                  "bad partitioning"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "kv-store",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "Key-Value Store",
              "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
              "defaults": {
                "partitionKey": "",
                "ttl": "",
                "replication": "",
                "consistencyLevel": ""
              },
              "notes": {
                "purpose": "Low-latency lookups by key; great for sessions, counters, mappings.",
                "keyDecisions": [
                  "Configure partitionKey",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "hot keys",
                  "uneven partitions"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 1200
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 1280
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 1360
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1440
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-queue",
            "source": "app-service",
            "target": "queue"
          },
          {
            "id": "e-7-app-service-event-log",
            "source": "app-service",
            "target": "event-log"
          },
          {
            "id": "e-8-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-9-app-service-object-storage",
            "source": "app-service",
            "target": "object-storage"
          },
          {
            "id": "e-10-app-service-kv-store",
            "source": "app-service",
            "target": "kv-store"
          },
          {
            "id": "e-11-app-service-worker",
            "source": "app-service",
            "target": "worker"
          },
          {
            "id": "e-12-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-13-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-14-queue-worker",
            "source": "queue",
            "target": "worker"
          },
          {
            "id": "e-15-event-log-worker",
            "source": "event-log",
            "target": "worker"
          },
          {
            "id": "e-16-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          },
          {
            "id": "e-17-app-service-object-storage",
            "source": "app-service",
            "target": "object-storage"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "queue",
          "label": "Queue",
          "reason": "Buffers tasks; decouples producers/consumers; smooths spikes."
        },
        {
          "type": "worker",
          "label": "Worker",
          "reason": "Consumes async jobs/events; performs background processing."
        },
        {
          "type": "event-log",
          "label": "Event Log / Stream",
          "reason": "Durable ordered log for high-throughput event streaming and replay."
        },
        {
          "type": "object-storage",
          "label": "Object Storage",
          "reason": "Stores large blobs (images/videos/files); durable and cost-effective."
        },
        {
          "type": "stream-processor",
          "label": "Stream Processor",
          "reason": "Processes streams for aggregation, enrichment, windowing; outputs derived streams."
        },
        {
          "type": "data-warehouse",
          "label": "Data Warehouse (OLAP)",
          "reason": "Columnar analytics store for BI queries; optimized for scans/aggregations."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "kv-store",
          "label": "Key-Value Store",
          "reason": "Low-latency lookups by key; great for sessions, counters, mappings."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "queue"
        },
        {
          "source": "app-service",
          "target": "event-log"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "object-storage"
        },
        {
          "source": "app-service",
          "target": "kv-store"
        },
        {
          "source": "app-service",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "queue",
          "target": "worker"
        },
        {
          "source": "event-log",
          "target": "worker"
        },
        {
          "source": "app-service",
          "target": "cdn"
        },
        {
          "source": "app-service",
          "target": "object-storage"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "web-crawler",
      "title": "Design Web Crawler",
      "problemStatement": "Design Design Web Crawler\nDesign Design Web Crawler\nDesign Design Web Crawler\nDiscover and fetch web pages at scale.",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "diagramSpec": {
        "nodes": [
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "description": "Client-facing UI; calls APIs; manages user interactions.",
            "data": {
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FR",
                  "text": "User entry point for all actions"
                },
                {
                  "type": "NFR",
                  "text": "Required for any user-facing system"
                }
              ],
              "tradeoffs": "",
              "failureModes": "",
              "metrics": {}
            }
          },
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "description": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "data": {
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Cache miss falls back to origin; stale content risk"
                },
                {
                  "type": "FR",
                  "text": "Serve static/media at edge"
                },
                {
                  "type": "NFR",
                  "text": "Latency reduction and origin offload"
                }
              ],
              "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "description": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "data": {
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Mitigates attack traffic; false positives can block good traffic"
                },
                {
                  "type": "NFR",
                  "text": "Security: blocks SQLi, XSS, bots"
                }
              ],
              "tradeoffs": "false positives blocking good traffic; rules drift",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "description": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "data": {
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Protects downstream from traffic spikes"
                },
                {
                  "type": "NFR",
                  "text": "Abuse protection and fairness"
                }
              ],
              "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "description": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "data": {
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF; needs HA deployment"
                },
                {
                  "type": "FR",
                  "text": "Single API entry, auth, routing"
                },
                {
                  "type": "NFR",
                  "text": "Request shaping and quotas"
                }
              ],
              "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "description": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "data": {
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "SPOF if single LB; health checks route around failures"
                },
                {
                  "type": "FR",
                  "text": "Routes HTTP requests to app instances"
                },
                {
                  "type": "NFR",
                  "text": "Availability and traffic distribution"
                }
              ],
              "tradeoffs": "bad health checks flapping; uneven load distribution",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "description": "Core business logic service handling requests and orchestrating dependencies.",
            "data": {
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stateless; instance failure only loses in-flight requests"
                },
                {
                  "type": "FR",
                  "text": "Business logic and request orchestration"
                },
                {
                  "type": "NFR",
                  "text": "Horizontal scaling of compute"
                }
              ],
              "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "search-index",
            "type": "search-index",
            "label": "Search Index",
            "category": "search",
            "description": "Supports text search, filtering, ranking; maintains inverted index.",
            "data": {
              "notes": {
                "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
                "keyDecisions": [
                  "Configure analyzers",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale index",
                  "high write amplification"
                ]
              }
            },
            "details": {
              "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
              "defaults": {
                "analyzers": "",
                "ranking": "",
                "shards": "",
                "replicas": "",
                "refreshInterval": ""
              },
              "notes": {
                "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
                "keyDecisions": [
                  "Configure analyzers",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale index",
                  "high write amplification"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stale index; high write amplification"
                },
                {
                  "type": "FR",
                  "text": "Full-text search and discovery"
                },
                {
                  "type": "NFR",
                  "text": "Query performance at scale"
                }
              ],
              "tradeoffs": "stale index; high write amplification; hot shards",
              "failureModes": "stale index; high write amplification; hot shards",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "description": "Relational storage with transactions and strong consistency options.",
            "data": {
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication reduces data loss; failover to replica"
                },
                {
                  "type": "FR",
                  "text": "Primary persistent storage with transactions"
                },
                {
                  "type": "NFR",
                  "text": "Consistency and durability"
                }
              ],
              "tradeoffs": "lock contention; replication lag; hot rows",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "description": "Scales reads; offloads primary; may have replication lag.",
            "data": {
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Replication lag; stale reads; failover complexity"
                },
                {
                  "type": "NFR",
                  "text": "Read scaling; offload primary"
                }
              ],
              "tradeoffs": "stale reads due to lag; failover complexity",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "description": "Speeds reads and reduces backend load; stores computed/queried data.",
            "data": {
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "Stampede on miss; stale data; cache node failure"
                },
                {
                  "type": "FR",
                  "text": "Fast reads for hot data"
                },
                {
                  "type": "NFR",
                  "text": "Latency and DB load reduction"
                }
              ],
              "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "description": "Collects time-series measurements for monitoring and alerting.",
            "data": {
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "High cardinality costs; missing metrics"
                },
                {
                  "type": "NFR",
                  "text": "Monitoring and alerting"
                }
              ],
              "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "description": "Stores logs for debugging/auditing; supports search and retention.",
            "data": {
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            },
            "justification": {
              "reasons": [
                {
                  "type": "FAILURE_MITIGATION",
                  "text": "PII leakage; cost explosion"
                },
                {
                  "type": "NFR",
                  "text": "Debugging and audit trail"
                }
              ],
              "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "default",
            "position": {
              "x": 420,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "source": "enrichment"
            }
          },
          {
            "id": "auth-service",
            "type": "default",
            "position": {
              "x": 460,
              "y": 200
            },
            "data": {
              "label": "Auth Service",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "source": "enrichment"
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "waf"
          },
          {
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "app-service",
            "target": "search-index"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cdn"
          }
        ],
        "notesByNodeId": {
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": {
              "cache": "",
              "prefetch": "",
              "offlineMode": ""
            },
            "tradeoffs": [],
            "failureModes": [],
            "interviewHooks": []
          },
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": {
              "cacheTTL": "",
              "cacheKey": "",
              "staleWhileRevalidate": "",
              "purge": "",
              "geoRestrictions": ""
            },
            "tradeoffs": "cache poisoning; stale content; origin overload when cache miss spikes",
            "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
            "interviewHooks": []
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": {
              "rules": "",
              "botProtection": "",
              "ipAllowDeny": "",
              "rateRules": ""
            },
            "tradeoffs": "false positives blocking good traffic; rules drift",
            "failureModes": "false positives blocking good traffic; rules drift",
            "interviewHooks": []
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": {
              "limitKey": "",
              "limits": "",
              "burst": "",
              "window": "",
              "tokenBucket": "",
              "leakyBucket": ""
            },
            "tradeoffs": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
            "interviewHooks": []
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": {
              "routes": "",
              "auth": "",
              "quotas": "",
              "timeouts": "",
              "payloadLimits": ""
            },
            "tradeoffs": "single point of failure; misconfigured routing; latency overhead",
            "failureModes": "single point of failure; misconfigured routing; latency overhead",
            "interviewHooks": []
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": {
              "algorithm": "",
              "healthChecks": "",
              "timeouts": "",
              "connectionDraining": ""
            },
            "tradeoffs": "bad health checks flapping; uneven load distribution",
            "failureModes": "bad health checks flapping; uneven load distribution",
            "interviewHooks": []
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": {
              "autoscaling": "",
              "timeouts": "",
              "retries": "",
              "circuitBreaker": ""
            },
            "tradeoffs": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
            "interviewHooks": []
          },
          "search-index": {
            "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
            "knobs": {
              "analyzers": "",
              "ranking": "",
              "shards": "",
              "replicas": "",
              "refreshInterval": ""
            },
            "tradeoffs": "stale index; high write amplification; hot shards",
            "failureModes": "stale index; high write amplification; hot shards",
            "interviewHooks": []
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": {
              "indexes": "",
              "replication": "",
              "partitioning": "",
              "connectionPool": "",
              "isolationLevel": ""
            },
            "tradeoffs": "lock contention; replication lag; hot rows",
            "failureModes": "lock contention; replication lag; hot rows",
            "interviewHooks": []
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": {
              "replicationMode": "",
              "readRouting": "",
              "lagBudget": ""
            },
            "tradeoffs": "stale reads due to lag; failover complexity",
            "failureModes": "stale reads due to lag; failover complexity",
            "interviewHooks": []
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": {
              "ttl": "",
              "evictionPolicy": "",
              "maxMemory": "",
              "sharding": "",
              "replication": ""
            },
            "tradeoffs": "stampede on miss; stale data; cache node failure causing DB overload",
            "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
            "interviewHooks": []
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": {
              "cardinalityGuards": "",
              "scrapeInterval": "",
              "retention": ""
            },
            "tradeoffs": "high cardinality costs; missing metrics due to scraping issues",
            "failureModes": "high cardinality costs; missing metrics due to scraping issues",
            "interviewHooks": []
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": {
              "sampling": "",
              "retention": "",
              "redaction": ""
            },
            "tradeoffs": "PII leakage; cost explosion; missing correlation IDs",
            "failureModes": "PII leakage; cost explosion; missing correlation IDs",
            "interviewHooks": []
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ]
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ]
          }
        }
      },
      "scoringRubric": [
        "URL frontier",
        "Politeness"
      ],
      "antiPatterns": [
        "Single queue"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "validation": {
        "coverage": [
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "search-index",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "search-index",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 15,
          "core": 4,
          "optional": 11,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "starterHints": [],
      "baselineDesign": {
        "nodes": [
          {
            "id": "web-app",
            "position": {
              "x": 250,
              "y": 0
            },
            "data": {
              "label": "Web App / UI",
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "notes": {
                "purpose": "Client-facing UI; calls APIs; manages user interactions.",
                "keyDecisions": [
                  "Configure cache",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale UI state",
                  "over-fetching"
                ]
              }
            }
          },
          {
            "id": "cdn",
            "position": {
              "x": 250,
              "y": 80
            },
            "data": {
              "label": "CDN",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "notes": {
                "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "keyDecisions": [
                  "Cache media by content hash or path",
                  "Purge on update; stale-while-revalidate"
                ],
                "failureModes": [
                  "Cache poisoning",
                  "Origin overload on miss spike"
                ]
              }
            }
          },
          {
            "id": "waf",
            "position": {
              "x": 250,
              "y": 160
            },
            "data": {
              "label": "WAF",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "notes": {
                "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "keyDecisions": [
                  "Configure rules",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "false positives blocking good traffic",
                  "rules drift"
                ]
              }
            }
          },
          {
            "id": "edge-rate-limiter",
            "position": {
              "x": 250,
              "y": 240
            },
            "data": {
              "label": "Rate Limiter",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "notes": {
                "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "keyDecisions": [
                  "Token bucket or sliding window per user/IP",
                  "Distributed state (Redis) for global limits"
                ],
                "failureModes": [
                  "Hot keys on limiter storage",
                  "Incorrect keying causes unfair limits"
                ]
              }
            }
          },
          {
            "id": "api-gateway",
            "position": {
              "x": 250,
              "y": 320
            },
            "data": {
              "label": "API Gateway",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "notes": {
                "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "keyDecisions": [
                  "Route by path/version; validate auth before backend",
                  "Centralize rate limits and request shaping"
                ],
                "failureModes": [
                  "SPOF; deploy HA with health checks",
                  "Misconfigured routes cause 404/5xx"
                ]
              }
            }
          },
          {
            "id": "load-balancer-l7",
            "position": {
              "x": 250,
              "y": 400
            },
            "data": {
              "label": "Load Balancer (L7)",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "notes": {
                "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "keyDecisions": [
                  "Configure algorithm",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "bad health checks flapping",
                  "uneven load distribution"
                ]
              }
            }
          },
          {
            "id": "app-service",
            "position": {
              "x": 250,
              "y": 480
            },
            "data": {
              "label": "App Service",
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "notes": {
                "purpose": "Core business logic service handling requests and orchestrating dependencies.",
                "keyDecisions": [
                  "Configure autoscaling",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "dependency timeouts cascading",
                  "resource exhaustion"
                ]
              }
            }
          },
          {
            "id": "search-index",
            "position": {
              "x": 250,
              "y": 560
            },
            "data": {
              "label": "Search Index",
              "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
              "defaults": {
                "analyzers": "",
                "ranking": "",
                "shards": "",
                "replicas": "",
                "refreshInterval": ""
              },
              "notes": {
                "purpose": "Supports text search, filtering, ranking; maintains inverted index.",
                "keyDecisions": [
                  "Configure analyzers",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale index",
                  "high write amplification"
                ]
              }
            }
          },
          {
            "id": "sql-db",
            "position": {
              "x": 250,
              "y": 640
            },
            "data": {
              "label": "SQL Database",
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "notes": {
                "purpose": "Relational storage with transactions and strong consistency options.",
                "keyDecisions": [
                  "Configure indexes",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "lock contention",
                  "replication lag"
                ]
              }
            }
          },
          {
            "id": "sql-read-replica",
            "position": {
              "x": 250,
              "y": 720
            },
            "data": {
              "label": "SQL Read Replica",
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "notes": {
                "purpose": "Scales reads; offloads primary; may have replication lag.",
                "keyDecisions": [
                  "Configure replicationMode",
                  "Follow best practices for scale"
                ],
                "failureModes": [
                  "stale reads due to lag",
                  "failover complexity"
                ]
              }
            }
          },
          {
            "id": "cache",
            "position": {
              "x": 250,
              "y": 800
            },
            "data": {
              "label": "Cache",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "notes": {
                "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
                "keyDecisions": [
                  "Cache-aside for conversation/metadata",
                  "TTL + invalidation stream for freshness"
                ],
                "failureModes": [
                  "Stampede on miss",
                  "Stale data after write"
                ]
              }
            }
          },
          {
            "id": "metrics",
            "position": {
              "x": 250,
              "y": 880
            },
            "data": {
              "label": "Metrics",
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "notes": {
                "purpose": "Collects time-series measurements for monitoring and alerting.",
                "keyDecisions": [
                  "Cardinality guards; sample high-volume metrics",
                  "SLI/SLO dashboards"
                ],
                "failureModes": [
                  "High cardinality costs",
                  "Missing metrics"
                ]
              }
            }
          },
          {
            "id": "logging",
            "position": {
              "x": 250,
              "y": 960
            },
            "data": {
              "label": "Logging",
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "notes": {
                "purpose": "Stores logs for debugging/auditing; supports search and retention.",
                "keyDecisions": [
                  "Structured JSON; correlation IDs",
                  "Sampling for high-volume paths"
                ],
                "failureModes": [
                  "PII leakage",
                  "Cost explosion"
                ]
              }
            }
          },
          {
            "id": "queue",
            "position": {
              "x": 250,
              "y": 1040
            },
            "data": {
              "label": "queue"
            }
          },
          {
            "id": "auth-service",
            "position": {
              "x": 250,
              "y": 1120
            },
            "data": {
              "label": "auth-service"
            }
          }
        ],
        "edges": [
          {
            "id": "e-0-web-app-waf",
            "source": "web-app",
            "target": "waf"
          },
          {
            "id": "e-1-waf-edge-rate-limiter",
            "source": "waf",
            "target": "edge-rate-limiter"
          },
          {
            "id": "e-2-edge-rate-limiter-api-gateway",
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "id": "e-3-api-gateway-load-balancer-l7",
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "id": "e-4-load-balancer-l7-app-service",
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "id": "e-5-app-service-cache",
            "source": "app-service",
            "target": "cache"
          },
          {
            "id": "e-6-app-service-search-index",
            "source": "app-service",
            "target": "search-index"
          },
          {
            "id": "e-7-app-service-sql-db",
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "id": "e-8-app-service-metrics",
            "source": "app-service",
            "target": "metrics"
          },
          {
            "id": "e-9-app-service-logging",
            "source": "app-service",
            "target": "logging"
          },
          {
            "id": "e-10-sql-db-sql-read-replica",
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "id": "e-11-app-service-cdn",
            "source": "app-service",
            "target": "cdn"
          }
        ]
      },
      "suggestedNodes": [
        {
          "type": "web-app",
          "label": "Web App / UI",
          "reason": "Client-facing UI; calls APIs; manages user interactions."
        },
        {
          "type": "cdn",
          "label": "CDN",
          "reason": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
        },
        {
          "type": "waf",
          "label": "WAF",
          "reason": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
        },
        {
          "type": "edge-rate-limiter",
          "label": "Rate Limiter",
          "reason": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
        },
        {
          "type": "api-gateway",
          "label": "API Gateway",
          "reason": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
        },
        {
          "type": "load-balancer-l7",
          "label": "Load Balancer (L7)",
          "reason": "Distributes HTTP traffic across healthy instances; supports routing rules."
        },
        {
          "type": "app-service",
          "label": "App Service",
          "reason": "Core business logic service handling requests and orchestrating dependencies."
        },
        {
          "type": "search-index",
          "label": "Search Index",
          "reason": "Supports text search, filtering, ranking; maintains inverted index."
        },
        {
          "type": "sql-db",
          "label": "SQL Database",
          "reason": "Relational storage with transactions and strong consistency options."
        },
        {
          "type": "sql-read-replica",
          "label": "SQL Read Replica",
          "reason": "Scales reads; offloads primary; may have replication lag."
        },
        {
          "type": "cache",
          "label": "Cache",
          "reason": "Speeds reads and reduces backend load; stores computed/queried data."
        },
        {
          "type": "metrics",
          "label": "Metrics",
          "reason": "Collects time-series measurements for monitoring and alerting."
        },
        {
          "type": "logging",
          "label": "Logging",
          "reason": "Stores logs for debugging/auditing; supports search and retention."
        },
        {
          "type": "default",
          "label": "queue",
          "reason": ""
        },
        {
          "type": "default",
          "label": "auth-service",
          "reason": ""
        }
      ],
      "suggestedEdges": [
        {
          "source": "web-app",
          "target": "waf"
        },
        {
          "source": "waf",
          "target": "edge-rate-limiter"
        },
        {
          "source": "edge-rate-limiter",
          "target": "api-gateway"
        },
        {
          "source": "api-gateway",
          "target": "load-balancer-l7"
        },
        {
          "source": "load-balancer-l7",
          "target": "app-service"
        },
        {
          "source": "app-service",
          "target": "cache"
        },
        {
          "source": "app-service",
          "target": "search-index"
        },
        {
          "source": "app-service",
          "target": "sql-db"
        },
        {
          "source": "app-service",
          "target": "metrics"
        },
        {
          "source": "app-service",
          "target": "logging"
        },
        {
          "source": "sql-db",
          "target": "sql-read-replica"
        },
        {
          "source": "app-service",
          "target": "cdn"
        }
      ],
      "packVersion": 2
    },
    {
      "id": "pack-1771346990777-design-design-a-chat-system-de",
      "title": "Designing Design Design a Chat System Design",
      "problemStatement": "Design Design Design a Chat System Design",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraints": [
        "RPS: 50K"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "designPlan": {
        "workload": {
          "traffic": "50K",
          "storage": "moderate",
          "latency": "p99 < 200ms",
          "availability": "99.9%"
        },
        "coreFlows": [
          {
            "id": "flow-1",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-2",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-3",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-4",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-5",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-6",
            "description": "User can perform core actions",
            "type": "primary"
          }
        ],
        "entities": [
          "User",
          "Resource"
        ],
        "accessPatterns": [],
        "risks": [],
        "qualityGoals": []
      },
      "diagramSpec": {
        "nodes": [
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "position": {
              "x": 0,
              "y": 0
            },
            "data": {
              "label": "CDN",
              "layer": "edge",
              "role": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "risks": [
                "cache poisoning",
                "stale content",
                "origin overload when cache miss spikes"
              ],
              "scalingStrategy": "Distributed; replication for HA",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "defaultNotes": {
                "what": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "why": "Required for edge layer",
                "scalingModel": "Distributed; replication for HA",
                "failureRisk": "cache poisoning; stale content; origin overload when cache miss spikes"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "position": {
              "x": 180,
              "y": 0
            },
            "data": {
              "label": "WAF",
              "layer": "edge",
              "role": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "risks": [
                "false positives blocking good traffic",
                "rules drift"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "defaultNotes": {
                "what": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "false positives blocking good traffic; rules drift"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "position": {
              "x": 360,
              "y": 0
            },
            "data": {
              "label": "Rate Limiter",
              "layer": "edge",
              "role": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "risks": [
                "hot keys on limiter storage",
                "incorrect keying causing unfair limits"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "defaultNotes": {
                "what": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot keys on limiter storage; incorrect keying causing unfair limits"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "position": {
              "x": 540,
              "y": 0
            },
            "data": {
              "label": "API Gateway",
              "layer": "gateway",
              "role": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "risks": [
                "single point of failure",
                "misconfigured routing",
                "latency overhead"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "defaultNotes": {
                "what": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "why": "Required for gateway layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "single point of failure; misconfigured routing; latency overhead"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "position": {
              "x": 720,
              "y": 0
            },
            "data": {
              "label": "Load Balancer (L7)",
              "layer": "gateway",
              "role": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "risks": [
                "bad health checks flapping",
                "uneven load distribution"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules."
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "defaultNotes": {
                "what": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "why": "Required for gateway layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "bad health checks flapping; uneven load distribution"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "position": {
              "x": 0,
              "y": 100
            },
            "data": {
              "label": "Web App / UI",
              "layer": "edge",
              "role": "Client-facing UI; calls APIs; manages user interactions.",
              "risks": [
                "stale UI state",
                "over-fetching"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Client-facing UI; calls APIs; manages user interactions."
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "defaultNotes": {
                "what": "Client-facing UI; calls APIs; manages user interactions.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "stale UI state; over-fetching"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stale UI state; over-fetching",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "position": {
              "x": 180,
              "y": 100
            },
            "data": {
              "label": "App Service",
              "layer": "app",
              "role": "Core business logic service handling requests and orchestrating dependencies.",
              "risks": [
                "dependency timeouts cascading",
                "resource exhaustion",
                "thundering herd"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Core business logic service handling requests and orchestrating dependencies."
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "defaultNotes": {
                "what": "Core business logic service handling requests and orchestrating dependencies.",
                "why": "Required for app layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "dependency timeouts cascading; resource exhaustion; thundering herd"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "auth-service",
            "label": "Auth Service",
            "category": "security",
            "position": {
              "x": 360,
              "y": 100
            },
            "data": {
              "label": "Auth Service",
              "layer": "app",
              "role": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "risks": [
                "token replay if not bound",
                "clock skew issues",
                "session store overload"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows."
            },
            "details": {
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "defaults": {
                "tokenTTL": "",
                "refreshTTL": "",
                "rotation": "",
                "mfa": ""
              },
              "defaultNotes": {
                "what": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
                "why": "Required for app layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "token replay if not bound; clock skew issues; session store overload"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "token replay if not bound; clock skew issues; session store overload",
              "metrics": {}
            }
          },
          {
            "id": "realtime-gateway",
            "type": "realtime-gateway",
            "label": "Realtime Gateway (WebSocket)",
            "category": "edge",
            "position": {
              "x": 420,
              "y": 100
            },
            "data": {
              "label": "Realtime Gateway (WebSocket)",
              "layer": "domain",
              "role": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
              "risks": [
                "connection storms on reconnect",
                "stale connections after instance failover"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients."
            },
            "details": {
              "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
              "defaults": {
                "connectionTimeout": "",
                "heartbeatInterval": "",
                "maxConnectionsPerInstance": "",
                "stickySessions": ""
              },
              "defaultNotes": {
                "what": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "connection storms on reconnect; stale connections after instance failover"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "connection storms on reconnect; stale connections after instance failover",
              "metrics": {}
            }
          },
          {
            "id": "presence-service",
            "type": "presence-service",
            "label": "Presence Service",
            "category": "compute",
            "position": {
              "x": 600,
              "y": 100
            },
            "data": {
              "label": "Presence Service",
              "layer": "domain",
              "role": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
              "risks": [
                "stale presence after crash",
                "hot keys for popular users"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership."
            },
            "details": {
              "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
              "defaults": {
                "heartbeatTTL": "",
                "slidingWindow": "",
                "shardingKey": ""
              },
              "defaultNotes": {
                "what": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "stale presence after crash; hot keys for popular users"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stale presence after crash; hot keys for popular users",
              "metrics": {}
            }
          },
          {
            "id": "conversation-service",
            "type": "conversation-service",
            "label": "Conversation Service",
            "category": "compute",
            "position": {
              "x": 540,
              "y": 100
            },
            "data": {
              "label": "Conversation Service",
              "layer": "domain",
              "role": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
              "risks": [
                "N+1 queries on list",
                "hot partitions for popular conversations"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants."
            },
            "details": {
              "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
              "defaults": {
                "pagination": "",
                "indexStrategy": "",
                "cacheTTL": ""
              },
              "defaultNotes": {
                "what": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "N+1 queries on list; hot partitions for popular conversations"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "N+1 queries on list; hot partitions for popular conversations",
              "metrics": {}
            }
          },
          {
            "id": "message-service",
            "type": "message-service",
            "label": "Message Service",
            "category": "compute",
            "position": {
              "x": 720,
              "y": 100
            },
            "data": {
              "label": "Message Service",
              "layer": "domain",
              "role": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
              "risks": [
                "duplicate messages without idempotency",
                "ordering breaks under load"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines."
            },
            "details": {
              "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
              "defaults": {
                "idempotencyKey": "",
                "ordering": "",
                "retention": ""
              },
              "defaultNotes": {
                "what": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "duplicate messages without idempotency; ordering breaks under load"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "duplicate messages without idempotency; ordering breaks under load",
              "metrics": {}
            }
          },
          {
            "id": "notification-service",
            "type": "notification-service",
            "label": "Notification Service (Push)",
            "category": "compute",
            "position": {
              "x": 900,
              "y": 100
            },
            "data": {
              "label": "Notification Service (Push)",
              "layer": "domain",
              "role": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
              "risks": [
                "token expiry causing silent failures",
                "provider rate limits"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries."
            },
            "details": {
              "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
              "defaults": {
                "batchSize": "",
                "retryPolicy": "",
                "deviceTokenRefresh": ""
              },
              "defaultNotes": {
                "what": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "token expiry causing silent failures; provider rate limits"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "token expiry causing silent failures; provider rate limits",
              "metrics": {}
            }
          },
          {
            "id": "circuit-breaker",
            "type": "circuit-breaker",
            "label": "Circuit Breaker",
            "category": "reliability",
            "position": {
              "x": 1080,
              "y": 100
            },
            "data": {
              "label": "Circuit Breaker",
              "layer": "resilience",
              "role": "Stops calling failing dependencies to prevent cascading failures.",
              "risks": [
                "bad thresholds causing flapping",
                "no fallback path"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Stops calling failing dependencies to prevent cascading failures."
            },
            "details": {
              "purpose": "Stops calling failing dependencies to prevent cascading failures.",
              "defaults": {
                "errorThreshold": "",
                "openDuration": "",
                "halfOpenProbes": "",
                "fallback": ""
              },
              "defaultNotes": {
                "what": "Stops calling failing dependencies to prevent cascading failures.",
                "why": "Required for resilience layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "bad thresholds causing flapping; no fallback path"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "bad thresholds causing flapping; no fallback path",
              "metrics": {}
            }
          },
          {
            "id": "retry-policy",
            "type": "retry-policy",
            "label": "Retry Policy",
            "category": "reliability",
            "position": {
              "x": 1260,
              "y": 100
            },
            "data": {
              "label": "Retry Policy",
              "layer": "resilience",
              "role": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
              "risks": [
                "retry storms",
                "retrying non-idempotent ops"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification."
            },
            "details": {
              "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
              "defaults": {
                "maxRetries": "",
                "backoff": "",
                "jitter": "",
                "retryBudget": ""
              },
              "defaultNotes": {
                "what": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
                "why": "Required for resilience layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "retry storms; retrying non-idempotent ops"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "retry storms; retrying non-idempotent ops",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "queue",
            "label": "Queue",
            "category": "messaging",
            "position": {
              "x": 0,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "layer": "async",
              "role": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "risks": [
                "backlog growth",
                "duplicate delivery",
                "hot partitions (FIFO)"
              ],
              "scalingStrategy": "Partition-based scale; consumers per partition",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes."
            },
            "details": {
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "defaultNotes": {
                "what": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "why": "Required for async layer",
                "scalingModel": "Partition-based scale; consumers per partition",
                "failureRisk": "backlog growth; duplicate delivery; hot partitions (FIFO)"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "position": {
              "x": 100,
              "y": 200
            },
            "data": {
              "label": "Event Log / Stream",
              "layer": "async",
              "role": "Durable ordered log for high-throughput event streaming and replay.",
              "risks": [
                "hot partition",
                "consumer lag",
                "rebalancing storms"
              ],
              "scalingStrategy": "Partition-based scale; consumers per partition",
              "purpose": "Durable ordered log for high-throughput event streaming and replay."
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "defaultNotes": {
                "what": "Durable ordered log for high-throughput event streaming and replay.",
                "why": "Required for async layer",
                "scalingModel": "Partition-based scale; consumers per partition",
                "failureRisk": "hot partition; consumer lag; rebalancing storms"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "pubsub",
            "type": "pubsub",
            "label": "Pub/Sub",
            "category": "messaging",
            "position": {
              "x": 0,
              "y": 200
            },
            "data": {
              "label": "Pub/Sub",
              "layer": "async",
              "role": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "risks": [
                "slow consumer lag",
                "fanout amplification"
              ],
              "scalingStrategy": "Partition-based scale; consumers per partition",
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers."
            },
            "details": {
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "defaultNotes": {
                "what": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "why": "Required for async layer",
                "scalingModel": "Partition-based scale; consumers per partition",
                "failureRisk": "slow consumer lag; fanout amplification"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "slow consumer lag; fanout amplification",
              "metrics": {}
            }
          },
          {
            "id": "dlq",
            "type": "dlq",
            "label": "Dead Letter Queue",
            "category": "reliability",
            "position": {
              "x": 180,
              "y": 200
            },
            "data": {
              "label": "Dead Letter Queue",
              "layer": "async",
              "role": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
              "risks": [
                "silent accumulation (no monitoring)",
                "reprocessing without fix"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines."
            },
            "details": {
              "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
              "defaults": {
                "maxReceiveCount": "",
                "redrivePolicy": ""
              },
              "defaultNotes": {
                "what": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
                "why": "Required for async layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "silent accumulation (no monitoring); reprocessing without fix"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "silent accumulation (no monitoring); reprocessing without fix",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "position": {
              "x": 360,
              "y": 200
            },
            "data": {
              "label": "Worker",
              "layer": "async",
              "role": "Consumes async jobs/events; performs background processing.",
              "risks": [
                "poison messages",
                "retry storms",
                "duplicate processing"
              ],
              "scalingStrategy": "Partition-based scale; consumers per partition",
              "purpose": "Consumes async jobs/events; performs background processing."
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "defaultNotes": {
                "what": "Consumes async jobs/events; performs background processing.",
                "why": "Required for async layer",
                "scalingModel": "Partition-based scale; consumers per partition",
                "failureRisk": "poison messages; retry storms; duplicate processing"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "position": {
              "x": 0,
              "y": 300
            },
            "data": {
              "label": "SQL Database",
              "layer": "data",
              "role": "Relational storage with transactions and strong consistency options.",
              "risks": [
                "lock contention",
                "replication lag",
                "hot rows"
              ],
              "scalingStrategy": "Replication + sharding",
              "purpose": "Relational storage with transactions and strong consistency options."
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "defaultNotes": {
                "what": "Relational storage with transactions and strong consistency options.",
                "why": "Required for data layer",
                "scalingModel": "Replication + sharding",
                "failureRisk": "lock contention; replication lag; hot rows"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "position": {
              "x": 420,
              "y": 300
            },
            "data": {
              "label": "SQL Read Replica",
              "layer": "data",
              "role": "Scales reads; offloads primary; may have replication lag.",
              "risks": [
                "stale reads due to lag",
                "failover complexity"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Scales reads; offloads primary; may have replication lag."
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "defaultNotes": {
                "what": "Scales reads; offloads primary; may have replication lag.",
                "why": "Required for data layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "stale reads due to lag; failover complexity"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "message-store",
            "type": "message-store",
            "label": "Message Store (Sharded KV/Wide-Column)",
            "category": "storage",
            "position": {
              "x": 0,
              "y": 300
            },
            "data": {
              "label": "Message Store (Sharded KV/Wide-Column)",
              "layer": "data",
              "role": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
              "risks": [
                "hot partition for popular conversations",
                "uneven shard distribution"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale."
            },
            "details": {
              "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
              "defaults": {
                "partitionKey": "",
                "sortKey": "",
                "ttl": "",
                "compaction": ""
              },
              "defaultNotes": {
                "what": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
                "why": "Required for data layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot partition for popular conversations; uneven shard distribution"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot partition for popular conversations; uneven shard distribution",
              "metrics": {}
            }
          },
          {
            "id": "conversation-metadata-store",
            "type": "conversation-metadata-store",
            "label": "Conversation Metadata Store",
            "category": "storage",
            "position": {
              "x": 180,
              "y": 300
            },
            "data": {
              "label": "Conversation Metadata Store",
              "layer": "data",
              "role": "Stores conversation metadata: participants, last message timestamp, read receipts.",
              "risks": [
                "hot rows for active conversations",
                "eventual consistency for read receipts"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts."
            },
            "details": {
              "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
              "defaults": {
                "indexes": "",
                "partitionKey": "",
                "cacheLayer": ""
              },
              "defaultNotes": {
                "what": "Stores conversation metadata: participants, last message timestamp, read receipts.",
                "why": "Required for data layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot rows for active conversations; eventual consistency for read receipts"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot rows for active conversations; eventual consistency for read receipts",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "position": {
              "x": 600,
              "y": 300
            },
            "data": {
              "label": "Cache",
              "layer": "caching",
              "role": "Speeds reads and reduces backend load; stores computed/queried data.",
              "risks": [
                "stampede on miss",
                "stale data",
                "cache node failure causing DB overload"
              ],
              "scalingStrategy": "Distributed; replication for HA",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data."
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "defaultNotes": {
                "what": "Speeds reads and reduces backend load; stores computed/queried data.",
                "why": "Required for caching layer",
                "scalingModel": "Distributed; replication for HA",
                "failureRisk": "stampede on miss; stale data; cache node failure causing DB overload"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "cache-invalidation",
            "type": "cache-invalidation",
            "label": "Cache Invalidation Stream",
            "category": "caching",
            "position": {
              "x": 360,
              "y": 300
            },
            "data": {
              "label": "Cache Invalidation Stream",
              "layer": "caching",
              "role": "Propagates invalidation events to caches to keep data fresh.",
              "risks": [
                "missed invalidations",
                "out-of-order invalidations"
              ],
              "scalingStrategy": "Distributed; replication for HA",
              "purpose": "Propagates invalidation events to caches to keep data fresh."
            },
            "details": {
              "purpose": "Propagates invalidation events to caches to keep data fresh.",
              "defaults": {
                "keys": "",
                "batching": "",
                "dedupe": ""
              },
              "defaultNotes": {
                "what": "Propagates invalidation events to caches to keep data fresh.",
                "why": "Required for caching layer",
                "scalingModel": "Distributed; replication for HA",
                "failureRisk": "missed invalidations; out-of-order invalidations"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "missed invalidations; out-of-order invalidations",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "position": {
              "x": 0,
              "y": 400
            },
            "data": {
              "label": "Metrics",
              "layer": "observability",
              "role": "Collects time-series measurements for monitoring and alerting.",
              "risks": [
                "high cardinality costs",
                "missing metrics due to scraping issues"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Collects time-series measurements for monitoring and alerting."
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "defaultNotes": {
                "what": "Collects time-series measurements for monitoring and alerting.",
                "why": "Required for observability layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "high cardinality costs; missing metrics due to scraping issues"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "position": {
              "x": 180,
              "y": 400
            },
            "data": {
              "label": "Logging",
              "layer": "observability",
              "role": "Stores logs for debugging/auditing; supports search and retention.",
              "risks": [
                "PII leakage",
                "cost explosion",
                "missing correlation IDs"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Stores logs for debugging/auditing; supports search and retention."
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "defaultNotes": {
                "what": "Stores logs for debugging/auditing; supports search and retention.",
                "why": "Required for observability layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "PII leakage; cost explosion; missing correlation IDs"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "tracing",
            "type": "tracing",
            "label": "Tracing",
            "category": "observability",
            "position": {
              "x": 360,
              "y": 400
            },
            "data": {
              "label": "Tracing",
              "layer": "observability",
              "role": "Distributed tracing to understand request paths and latency contributors.",
              "risks": [
                "missing propagation",
                "sampling hides tail latencies"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Distributed tracing to understand request paths and latency contributors."
            },
            "details": {
              "purpose": "Distributed tracing to understand request paths and latency contributors.",
              "defaults": {
                "sampling": "",
                "propagation": "",
                "retention": ""
              },
              "defaultNotes": {
                "what": "Distributed tracing to understand request paths and latency contributors.",
                "why": "Required for observability layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "missing propagation; sampling hides tail latencies"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "missing propagation; sampling hides tail latencies",
              "metrics": {}
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "cdn"
          },
          {
            "source": "web-app",
            "target": "api-gateway"
          },
          {
            "source": "cdn",
            "target": "api-gateway"
          },
          {
            "source": "waf",
            "target": "api-gateway"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "api-gateway",
            "target": "auth-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "auth-service",
            "target": "app-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "conversation-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "message-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "realtime-gateway"
          },
          {
            "source": "app-service",
            "target": "queue"
          },
          {
            "source": "queue",
            "target": "worker"
          },
          {
            "source": "worker",
            "target": "dlq"
          },
          {
            "source": "app-service",
            "target": "event-log"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "message-service",
            "target": "message-store"
          },
          {
            "source": "message-service",
            "target": "event-log"
          },
          {
            "source": "conversation-service",
            "target": "conversation-metadata-store"
          },
          {
            "source": "worker",
            "target": "realtime-gateway"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "message-service",
            "target": "metrics"
          },
          {
            "source": "conversation-service",
            "target": "metrics"
          },
          {
            "source": "worker",
            "target": "metrics"
          },
          {
            "source": "notification-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "app-service",
            "target": "tracing"
          }
        ],
        "notesByNodeId": {
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": [
              "cacheTTL",
              "cacheKey",
              "staleWhileRevalidate",
              "purge",
              "geoRestrictions"
            ],
            "tradeoffs": [
              "cache poisoning",
              "stale content",
              "origin overload when cache miss spikes"
            ],
            "failureModes": [
              "cache poisoning",
              "stale content",
              "origin overload when cache miss spikes"
            ],
            "interviewHooks": [
              "What do you cache? How do you invalidate? Cache key design?"
            ],
            "what": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "why": "Required for edge layer",
            "scalingModel": "Distributed; replication for HA",
            "failureRisk": "cache poisoning; stale content; origin overload when cache miss spikes"
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": [
              "rules",
              "botProtection",
              "ipAllowDeny",
              "rateRules"
            ],
            "tradeoffs": [
              "false positives blocking good traffic",
              "rules drift"
            ],
            "failureModes": [
              "false positives blocking good traffic",
              "rules drift"
            ],
            "interviewHooks": [
              "How do you tune rules? Whats your rollout strategy?"
            ],
            "what": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "false positives blocking good traffic; rules drift"
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": [
              "limitKey",
              "limits",
              "burst",
              "window",
              "tokenBucket",
              "leakyBucket"
            ],
            "tradeoffs": [
              "hot keys on limiter storage",
              "incorrect keying causing unfair limits"
            ],
            "failureModes": [
              "hot keys on limiter storage",
              "incorrect keying causing unfair limits"
            ],
            "interviewHooks": [
              "Token bucket vs fixed window? Distributed rate limiting?"
            ],
            "what": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot keys on limiter storage; incorrect keying causing unfair limits"
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": [
              "routes",
              "auth",
              "quotas",
              "timeouts",
              "payloadLimits"
            ],
            "tradeoffs": [
              "single point of failure",
              "misconfigured routing",
              "latency overhead"
            ],
            "failureModes": [
              "single point of failure",
              "misconfigured routing",
              "latency overhead"
            ],
            "interviewHooks": [
              "Why gateway vs LB only? How do you avoid SPOF?"
            ],
            "what": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "why": "Required for gateway layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "single point of failure; misconfigured routing; latency overhead"
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": [
              "algorithm",
              "healthChecks",
              "timeouts",
              "connectionDraining"
            ],
            "tradeoffs": [
              "bad health checks flapping",
              "uneven load distribution"
            ],
            "failureModes": [
              "bad health checks flapping",
              "uneven load distribution"
            ],
            "interviewHooks": [
              "Round-robin vs least-connections? L4 vs L7?"
            ],
            "what": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "why": "Required for gateway layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "bad health checks flapping; uneven load distribution"
          },
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": [
              "cache",
              "prefetch",
              "offlineMode"
            ],
            "tradeoffs": [
              "stale UI state",
              "over-fetching"
            ],
            "failureModes": [
              "stale UI state",
              "over-fetching"
            ],
            "interviewHooks": [
              "How do you optimize roundtrips? Error handling?"
            ],
            "what": "Client-facing UI; calls APIs; manages user interactions.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "stale UI state; over-fetching"
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": [
              "autoscaling",
              "timeouts",
              "retries",
              "circuitBreaker"
            ],
            "tradeoffs": [
              "dependency timeouts cascading",
              "resource exhaustion",
              "thundering herd"
            ],
            "failureModes": [
              "dependency timeouts cascading",
              "resource exhaustion",
              "thundering herd"
            ],
            "interviewHooks": [
              "Timeout budgets? Bulkheads? Retries with jitter?"
            ],
            "what": "Core business logic service handling requests and orchestrating dependencies.",
            "why": "Required for app layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "dependency timeouts cascading; resource exhaustion; thundering herd"
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ],
            "what": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "why": "Required for app layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "token replay if not bound; clock skew issues; session store overload"
          },
          "realtime-gateway": {
            "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
            "knobs": [
              "connectionTimeout",
              "heartbeatInterval",
              "maxConnectionsPerInstance",
              "stickySessions"
            ],
            "tradeoffs": [
              "connection storms on reconnect",
              "stale connections after instance failover"
            ],
            "failureModes": [
              "connection storms on reconnect",
              "stale connections after instance failover"
            ],
            "interviewHooks": [
              "How do you scale WebSocket servers? Sticky sessions? Reconnection strategy?"
            ],
            "what": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "connection storms on reconnect; stale connections after instance failover"
          },
          "presence-service": {
            "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
            "knobs": [
              "heartbeatTTL",
              "slidingWindow",
              "shardingKey"
            ],
            "tradeoffs": [
              "stale presence after crash",
              "hot keys for popular users"
            ],
            "failureModes": [
              "stale presence after crash",
              "hot keys for popular users"
            ],
            "interviewHooks": [
              "How do you handle flaky networks? Scale presence for millions?"
            ],
            "what": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "stale presence after crash; hot keys for popular users"
          },
          "conversation-service": {
            "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
            "knobs": [
              "pagination",
              "indexStrategy",
              "cacheTTL"
            ],
            "tradeoffs": [
              "N+1 queries on list",
              "hot partitions for popular conversations"
            ],
            "failureModes": [
              "N+1 queries on list",
              "hot partitions for popular conversations"
            ],
            "interviewHooks": [
              "How do you paginate? Order by last message?"
            ],
            "what": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "N+1 queries on list; hot partitions for popular conversations"
          },
          "message-service": {
            "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
            "knobs": [
              "idempotencyKey",
              "ordering",
              "retention"
            ],
            "tradeoffs": [
              "duplicate messages without idempotency",
              "ordering breaks under load"
            ],
            "failureModes": [
              "duplicate messages without idempotency",
              "ordering breaks under load"
            ],
            "interviewHooks": [
              "Idempotency? Ordering guarantees? Fanout strategy?"
            ],
            "what": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "duplicate messages without idempotency; ordering breaks under load"
          },
          "notification-service": {
            "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
            "knobs": [
              "batchSize",
              "retryPolicy",
              "deviceTokenRefresh"
            ],
            "tradeoffs": [
              "token expiry causing silent failures",
              "provider rate limits"
            ],
            "failureModes": [
              "token expiry causing silent failures",
              "provider rate limits"
            ],
            "interviewHooks": [
              "How do you handle token refresh? Batching for scale?"
            ],
            "what": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "token expiry causing silent failures; provider rate limits"
          },
          "circuit-breaker": {
            "purpose": "Stops calling failing dependencies to prevent cascading failures.",
            "knobs": [
              "errorThreshold",
              "openDuration",
              "halfOpenProbes",
              "fallback"
            ],
            "tradeoffs": [
              "bad thresholds causing flapping",
              "no fallback path"
            ],
            "failureModes": [
              "bad thresholds causing flapping",
              "no fallback path"
            ],
            "interviewHooks": [
              "Where do you place it? How do you choose thresholds?"
            ],
            "what": "Stops calling failing dependencies to prevent cascading failures.",
            "why": "Required for resilience layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "bad thresholds causing flapping; no fallback path"
          },
          "retry-policy": {
            "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
            "knobs": [
              "maxRetries",
              "backoff",
              "jitter",
              "retryBudget"
            ],
            "tradeoffs": [
              "retry storms",
              "retrying non-idempotent ops"
            ],
            "failureModes": [
              "retry storms",
              "retrying non-idempotent ops"
            ],
            "interviewHooks": [
              "Which calls are safe to retry? Retry budget?"
            ],
            "what": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
            "why": "Required for resilience layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "retry storms; retrying non-idempotent ops"
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ],
            "what": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "why": "Required for async layer",
            "scalingModel": "Partition-based scale; consumers per partition",
            "failureRisk": "backlog growth; duplicate delivery; hot partitions (FIFO)"
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": [
              "partitions",
              "replication",
              "retention",
              "compaction"
            ],
            "tradeoffs": [
              "hot partition",
              "consumer lag",
              "rebalancing storms"
            ],
            "failureModes": [
              "hot partition",
              "consumer lag",
              "rebalancing storms"
            ],
            "interviewHooks": [
              "Partition key design? Exactly-once processing patterns?"
            ],
            "what": "Durable ordered log for high-throughput event streaming and replay.",
            "why": "Required for async layer",
            "scalingModel": "Partition-based scale; consumers per partition",
            "failureRisk": "hot partition; consumer lag; rebalancing storms"
          },
          "pubsub": {
            "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "knobs": [
              "subscriptionFilters",
              "retention",
              "ackDeadline",
              "replay"
            ],
            "tradeoffs": [
              "slow consumer lag",
              "fanout amplification"
            ],
            "failureModes": [
              "slow consumer lag",
              "fanout amplification"
            ],
            "interviewHooks": [
              "Delivery guarantees? Replay strategy? Consumer isolation?"
            ],
            "what": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "why": "Required for async layer",
            "scalingModel": "Partition-based scale; consumers per partition",
            "failureRisk": "slow consumer lag; fanout amplification"
          },
          "dlq": {
            "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
            "knobs": [
              "maxReceiveCount",
              "redrivePolicy"
            ],
            "tradeoffs": [
              "silent accumulation (no monitoring)",
              "reprocessing without fix"
            ],
            "failureModes": [
              "silent accumulation (no monitoring)",
              "reprocessing without fix"
            ],
            "interviewHooks": [
              "How do you triage DLQ? Automated redrive?"
            ],
            "what": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
            "why": "Required for async layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "silent accumulation (no monitoring); reprocessing without fix"
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": [
              "concurrency",
              "retries",
              "idempotency",
              "batchSize"
            ],
            "tradeoffs": [
              "poison messages",
              "retry storms",
              "duplicate processing"
            ],
            "failureModes": [
              "poison messages",
              "retry storms",
              "duplicate processing"
            ],
            "interviewHooks": [
              "At-least-once semantics? DLQ strategy? Idempotency design?"
            ],
            "what": "Consumes async jobs/events; performs background processing.",
            "why": "Required for async layer",
            "scalingModel": "Partition-based scale; consumers per partition",
            "failureRisk": "poison messages; retry storms; duplicate processing"
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": [
              "indexes",
              "replication",
              "partitioning",
              "connectionPool",
              "isolationLevel"
            ],
            "tradeoffs": [
              "lock contention",
              "replication lag",
              "hot rows"
            ],
            "failureModes": [
              "lock contention",
              "replication lag",
              "hot rows"
            ],
            "interviewHooks": [
              "Sharding strategy? Isolation level? Read replicas usage?"
            ],
            "what": "Relational storage with transactions and strong consistency options.",
            "why": "Required for data layer",
            "scalingModel": "Replication + sharding",
            "failureRisk": "lock contention; replication lag; hot rows"
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": [
              "replicationMode",
              "readRouting",
              "lagBudget"
            ],
            "tradeoffs": [
              "stale reads due to lag",
              "failover complexity"
            ],
            "failureModes": [
              "stale reads due to lag",
              "failover complexity"
            ],
            "interviewHooks": [
              "How do you route reads? Consistency guarantees?"
            ],
            "what": "Scales reads; offloads primary; may have replication lag.",
            "why": "Required for data layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "stale reads due to lag; failover complexity"
          },
          "message-store": {
            "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
            "knobs": [
              "partitionKey",
              "sortKey",
              "ttl",
              "compaction"
            ],
            "tradeoffs": [
              "hot partition for popular conversations",
              "uneven shard distribution"
            ],
            "failureModes": [
              "hot partition for popular conversations",
              "uneven shard distribution"
            ],
            "interviewHooks": [
              "Partition key design? Time-range queries? Compaction?"
            ],
            "what": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
            "why": "Required for data layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot partition for popular conversations; uneven shard distribution"
          },
          "conversation-metadata-store": {
            "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
            "knobs": [
              "indexes",
              "partitionKey",
              "cacheLayer"
            ],
            "tradeoffs": [
              "hot rows for active conversations",
              "eventual consistency for read receipts"
            ],
            "failureModes": [
              "hot rows for active conversations",
              "eventual consistency for read receipts"
            ],
            "interviewHooks": [
              "Index for list-by-user? Consistency model?"
            ],
            "what": "Stores conversation metadata: participants, last message timestamp, read receipts.",
            "why": "Required for data layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot rows for active conversations; eventual consistency for read receipts"
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": [
              "ttl",
              "evictionPolicy",
              "maxMemory",
              "sharding",
              "replication"
            ],
            "tradeoffs": [
              "stampede on miss",
              "stale data",
              "cache node failure causing DB overload"
            ],
            "failureModes": [
              "stampede on miss",
              "stale data",
              "cache node failure causing DB overload"
            ],
            "interviewHooks": [
              "Cache-aside vs read-through? Stampede mitigation? Invalidation?"
            ],
            "what": "Speeds reads and reduces backend load; stores computed/queried data.",
            "why": "Required for caching layer",
            "scalingModel": "Distributed; replication for HA",
            "failureRisk": "stampede on miss; stale data; cache node failure causing DB overload"
          },
          "cache-invalidation": {
            "purpose": "Propagates invalidation events to caches to keep data fresh.",
            "knobs": [
              "keys",
              "batching",
              "dedupe"
            ],
            "tradeoffs": [
              "missed invalidations",
              "out-of-order invalidations"
            ],
            "failureModes": [
              "missed invalidations",
              "out-of-order invalidations"
            ],
            "interviewHooks": [
              "TTL-only vs event invalidation? Exactly-once invalidation?"
            ],
            "what": "Propagates invalidation events to caches to keep data fresh.",
            "why": "Required for caching layer",
            "scalingModel": "Distributed; replication for HA",
            "failureRisk": "missed invalidations; out-of-order invalidations"
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": [
              "cardinalityGuards",
              "scrapeInterval",
              "retention"
            ],
            "tradeoffs": [
              "high cardinality costs",
              "missing metrics due to scraping issues"
            ],
            "failureModes": [
              "high cardinality costs",
              "missing metrics due to scraping issues"
            ],
            "interviewHooks": [
              "SLI/SLO? Alert fatigue? Cardinality control?"
            ],
            "what": "Collects time-series measurements for monitoring and alerting.",
            "why": "Required for observability layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "high cardinality costs; missing metrics due to scraping issues"
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": [
              "sampling",
              "retention",
              "redaction"
            ],
            "tradeoffs": [
              "PII leakage",
              "cost explosion",
              "missing correlation IDs"
            ],
            "failureModes": [
              "PII leakage",
              "cost explosion",
              "missing correlation IDs"
            ],
            "interviewHooks": [
              "Structured logs? Sampling? PII redaction?"
            ],
            "what": "Stores logs for debugging/auditing; supports search and retention.",
            "why": "Required for observability layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "PII leakage; cost explosion; missing correlation IDs"
          },
          "tracing": {
            "purpose": "Distributed tracing to understand request paths and latency contributors.",
            "knobs": [
              "sampling",
              "propagation",
              "retention"
            ],
            "tradeoffs": [
              "missing propagation",
              "sampling hides tail latencies"
            ],
            "failureModes": [
              "missing propagation",
              "sampling hides tail latencies"
            ],
            "interviewHooks": [
              "How to debug tail latency? Sampling strategy?"
            ],
            "what": "Distributed tracing to understand request paths and latency contributors.",
            "why": "Required for observability layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "missing propagation; sampling hides tail latencies"
          }
        }
      },
      "validation": {
        "coverage": [
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "realtime-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "presence-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "conversation-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "message-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "notification-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "circuit-breaker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "retry-policy",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "pubsub",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "dlq",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "message-store",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "conversation-metadata-store",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache-invalidation",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "tracing",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "realtime-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "presence-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "conversation-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "message-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "notification-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "circuit-breaker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "retry-policy",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "pubsub",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "dlq",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "message-store",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "conversation-metadata-store",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache-invalidation",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "tracing",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 29,
          "core": 4,
          "optional": 25,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "packVersion": 2
    },
    {
      "id": "pack-1771378123123-design-design-a-chat-system-de",
      "title": "Designing Design Design a Chat System Design Design",
      "problemStatement": "Design Design Design a Chat System Design Design",
      "functionalRequirements": [
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraints": [
        "RPS: 50k"
      ],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "designPlan": {
        "workload": {
          "traffic": "50k",
          "storage": "moderate",
          "latency": "p99 < 200ms",
          "availability": "99.9%"
        },
        "coreFlows": [
          {
            "id": "flow-1",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-2",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-3",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-4",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-5",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-6",
            "description": "User can perform core actions",
            "type": "primary"
          }
        ],
        "entities": [
          "User",
          "Resource"
        ],
        "accessPatterns": [],
        "risks": [],
        "qualityGoals": []
      },
      "diagramSpec": {
        "nodes": [
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "position": {
              "x": 0,
              "y": 0
            },
            "data": {
              "label": "CDN",
              "layer": "edge",
              "role": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "risks": [
                "cache poisoning",
                "stale content",
                "origin overload when cache miss spikes"
              ],
              "scalingStrategy": "Distributed; replication for HA",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "defaultNotes": {
                "what": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "why": "Required for edge layer",
                "scalingModel": "Distributed; replication for HA",
                "failureRisk": "cache poisoning; stale content; origin overload when cache miss spikes"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "position": {
              "x": 180,
              "y": 0
            },
            "data": {
              "label": "WAF",
              "layer": "edge",
              "role": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "risks": [
                "false positives blocking good traffic",
                "rules drift"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "defaultNotes": {
                "what": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "false positives blocking good traffic; rules drift"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "position": {
              "x": 360,
              "y": 0
            },
            "data": {
              "label": "Rate Limiter",
              "layer": "edge",
              "role": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "risks": [
                "hot keys on limiter storage",
                "incorrect keying causing unfair limits"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "defaultNotes": {
                "what": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot keys on limiter storage; incorrect keying causing unfair limits"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "position": {
              "x": 540,
              "y": 0
            },
            "data": {
              "label": "API Gateway",
              "layer": "gateway",
              "role": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "risks": [
                "single point of failure",
                "misconfigured routing",
                "latency overhead"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "defaultNotes": {
                "what": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "why": "Required for gateway layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "single point of failure; misconfigured routing; latency overhead"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "position": {
              "x": 720,
              "y": 0
            },
            "data": {
              "label": "Load Balancer (L7)",
              "layer": "gateway",
              "role": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "risks": [
                "bad health checks flapping",
                "uneven load distribution"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules."
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "defaultNotes": {
                "what": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "why": "Required for gateway layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "bad health checks flapping; uneven load distribution"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "position": {
              "x": 0,
              "y": 100
            },
            "data": {
              "label": "Web App / UI",
              "layer": "edge",
              "role": "Client-facing UI; calls APIs; manages user interactions.",
              "risks": [
                "stale UI state",
                "over-fetching"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Client-facing UI; calls APIs; manages user interactions."
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "defaultNotes": {
                "what": "Client-facing UI; calls APIs; manages user interactions.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "stale UI state; over-fetching"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stale UI state; over-fetching",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "position": {
              "x": 180,
              "y": 100
            },
            "data": {
              "label": "App Service",
              "layer": "app",
              "role": "Core business logic service handling requests and orchestrating dependencies.",
              "risks": [
                "dependency timeouts cascading",
                "resource exhaustion",
                "thundering herd"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Core business logic service handling requests and orchestrating dependencies."
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "defaultNotes": {
                "what": "Core business logic service handling requests and orchestrating dependencies.",
                "why": "Required for app layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "dependency timeouts cascading; resource exhaustion; thundering herd"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "auth-service",
            "label": "Auth Service",
            "category": "security",
            "position": {
              "x": 360,
              "y": 100
            },
            "data": {
              "label": "Auth Service",
              "layer": "app",
              "role": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "risks": [
                "token replay if not bound",
                "clock skew issues",
                "session store overload"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows."
            },
            "details": {
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "defaults": {
                "tokenTTL": "",
                "refreshTTL": "",
                "rotation": "",
                "mfa": ""
              },
              "defaultNotes": {
                "what": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
                "why": "Required for app layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "token replay if not bound; clock skew issues; session store overload"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "token replay if not bound; clock skew issues; session store overload",
              "metrics": {}
            }
          },
          {
            "id": "realtime-gateway",
            "type": "realtime-gateway",
            "label": "Realtime Gateway (WebSocket)",
            "category": "edge",
            "position": {
              "x": 420,
              "y": 100
            },
            "data": {
              "label": "Realtime Gateway (WebSocket)",
              "layer": "domain",
              "role": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
              "risks": [
                "connection storms on reconnect",
                "stale connections after instance failover"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients."
            },
            "details": {
              "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
              "defaults": {
                "connectionTimeout": "",
                "heartbeatInterval": "",
                "maxConnectionsPerInstance": "",
                "stickySessions": ""
              },
              "defaultNotes": {
                "what": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "connection storms on reconnect; stale connections after instance failover"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "connection storms on reconnect; stale connections after instance failover",
              "metrics": {}
            }
          },
          {
            "id": "presence-service",
            "type": "presence-service",
            "label": "Presence Service",
            "category": "compute",
            "position": {
              "x": 600,
              "y": 100
            },
            "data": {
              "label": "Presence Service",
              "layer": "domain",
              "role": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
              "risks": [
                "stale presence after crash",
                "hot keys for popular users"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership."
            },
            "details": {
              "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
              "defaults": {
                "heartbeatTTL": "",
                "slidingWindow": "",
                "shardingKey": ""
              },
              "defaultNotes": {
                "what": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "stale presence after crash; hot keys for popular users"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stale presence after crash; hot keys for popular users",
              "metrics": {}
            }
          },
          {
            "id": "conversation-service",
            "type": "conversation-service",
            "label": "Conversation Service",
            "category": "compute",
            "position": {
              "x": 540,
              "y": 100
            },
            "data": {
              "label": "Conversation Service",
              "layer": "domain",
              "role": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
              "risks": [
                "N+1 queries on list",
                "hot partitions for popular conversations"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants."
            },
            "details": {
              "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
              "defaults": {
                "pagination": "",
                "indexStrategy": "",
                "cacheTTL": ""
              },
              "defaultNotes": {
                "what": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "N+1 queries on list; hot partitions for popular conversations"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "N+1 queries on list; hot partitions for popular conversations",
              "metrics": {}
            }
          },
          {
            "id": "message-service",
            "type": "message-service",
            "label": "Message Service",
            "category": "compute",
            "position": {
              "x": 720,
              "y": 100
            },
            "data": {
              "label": "Message Service",
              "layer": "domain",
              "role": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
              "risks": [
                "duplicate messages without idempotency",
                "ordering breaks under load"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines."
            },
            "details": {
              "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
              "defaults": {
                "idempotencyKey": "",
                "ordering": "",
                "retention": ""
              },
              "defaultNotes": {
                "what": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "duplicate messages without idempotency; ordering breaks under load"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "duplicate messages without idempotency; ordering breaks under load",
              "metrics": {}
            }
          },
          {
            "id": "notification-service",
            "type": "notification-service",
            "label": "Notification Service (Push)",
            "category": "compute",
            "position": {
              "x": 900,
              "y": 100
            },
            "data": {
              "label": "Notification Service (Push)",
              "layer": "domain",
              "role": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
              "risks": [
                "token expiry causing silent failures",
                "provider rate limits"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries."
            },
            "details": {
              "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
              "defaults": {
                "batchSize": "",
                "retryPolicy": "",
                "deviceTokenRefresh": ""
              },
              "defaultNotes": {
                "what": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "token expiry causing silent failures; provider rate limits"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "token expiry causing silent failures; provider rate limits",
              "metrics": {}
            }
          },
          {
            "id": "circuit-breaker",
            "type": "circuit-breaker",
            "label": "Circuit Breaker",
            "category": "reliability",
            "position": {
              "x": 1080,
              "y": 100
            },
            "data": {
              "label": "Circuit Breaker",
              "layer": "resilience",
              "role": "Stops calling failing dependencies to prevent cascading failures.",
              "risks": [
                "bad thresholds causing flapping",
                "no fallback path"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Stops calling failing dependencies to prevent cascading failures."
            },
            "details": {
              "purpose": "Stops calling failing dependencies to prevent cascading failures.",
              "defaults": {
                "errorThreshold": "",
                "openDuration": "",
                "halfOpenProbes": "",
                "fallback": ""
              },
              "defaultNotes": {
                "what": "Stops calling failing dependencies to prevent cascading failures.",
                "why": "Required for resilience layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "bad thresholds causing flapping; no fallback path"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "bad thresholds causing flapping; no fallback path",
              "metrics": {}
            }
          },
          {
            "id": "retry-policy",
            "type": "retry-policy",
            "label": "Retry Policy",
            "category": "reliability",
            "position": {
              "x": 1260,
              "y": 100
            },
            "data": {
              "label": "Retry Policy",
              "layer": "resilience",
              "role": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
              "risks": [
                "retry storms",
                "retrying non-idempotent ops"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification."
            },
            "details": {
              "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
              "defaults": {
                "maxRetries": "",
                "backoff": "",
                "jitter": "",
                "retryBudget": ""
              },
              "defaultNotes": {
                "what": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
                "why": "Required for resilience layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "retry storms; retrying non-idempotent ops"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "retry storms; retrying non-idempotent ops",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "queue",
            "label": "Queue",
            "category": "messaging",
            "position": {
              "x": 0,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "layer": "async",
              "role": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "risks": [
                "backlog growth",
                "duplicate delivery",
                "hot partitions (FIFO)"
              ],
              "scalingStrategy": "Partition-based scale; consumers per partition",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes."
            },
            "details": {
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "defaultNotes": {
                "what": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "why": "Required for async layer",
                "scalingModel": "Partition-based scale; consumers per partition",
                "failureRisk": "backlog growth; duplicate delivery; hot partitions (FIFO)"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "position": {
              "x": 100,
              "y": 200
            },
            "data": {
              "label": "Event Log / Stream",
              "layer": "async",
              "role": "Durable ordered log for high-throughput event streaming and replay.",
              "risks": [
                "hot partition",
                "consumer lag",
                "rebalancing storms"
              ],
              "scalingStrategy": "Partition-based scale; consumers per partition",
              "purpose": "Durable ordered log for high-throughput event streaming and replay."
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "defaultNotes": {
                "what": "Durable ordered log for high-throughput event streaming and replay.",
                "why": "Required for async layer",
                "scalingModel": "Partition-based scale; consumers per partition",
                "failureRisk": "hot partition; consumer lag; rebalancing storms"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "pubsub",
            "type": "pubsub",
            "label": "Pub/Sub",
            "category": "messaging",
            "position": {
              "x": 0,
              "y": 200
            },
            "data": {
              "label": "Pub/Sub",
              "layer": "async",
              "role": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "risks": [
                "slow consumer lag",
                "fanout amplification"
              ],
              "scalingStrategy": "Partition-based scale; consumers per partition",
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers."
            },
            "details": {
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "defaultNotes": {
                "what": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "why": "Required for async layer",
                "scalingModel": "Partition-based scale; consumers per partition",
                "failureRisk": "slow consumer lag; fanout amplification"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "slow consumer lag; fanout amplification",
              "metrics": {}
            }
          },
          {
            "id": "dlq",
            "type": "dlq",
            "label": "Dead Letter Queue",
            "category": "reliability",
            "position": {
              "x": 180,
              "y": 200
            },
            "data": {
              "label": "Dead Letter Queue",
              "layer": "async",
              "role": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
              "risks": [
                "silent accumulation (no monitoring)",
                "reprocessing without fix"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines."
            },
            "details": {
              "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
              "defaults": {
                "maxReceiveCount": "",
                "redrivePolicy": ""
              },
              "defaultNotes": {
                "what": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
                "why": "Required for async layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "silent accumulation (no monitoring); reprocessing without fix"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "silent accumulation (no monitoring); reprocessing without fix",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "position": {
              "x": 360,
              "y": 200
            },
            "data": {
              "label": "Worker",
              "layer": "async",
              "role": "Consumes async jobs/events; performs background processing.",
              "risks": [
                "poison messages",
                "retry storms",
                "duplicate processing"
              ],
              "scalingStrategy": "Partition-based scale; consumers per partition",
              "purpose": "Consumes async jobs/events; performs background processing."
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "defaultNotes": {
                "what": "Consumes async jobs/events; performs background processing.",
                "why": "Required for async layer",
                "scalingModel": "Partition-based scale; consumers per partition",
                "failureRisk": "poison messages; retry storms; duplicate processing"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "position": {
              "x": 0,
              "y": 300
            },
            "data": {
              "label": "SQL Database",
              "layer": "data",
              "role": "Relational storage with transactions and strong consistency options.",
              "risks": [
                "lock contention",
                "replication lag",
                "hot rows"
              ],
              "scalingStrategy": "Replication + sharding",
              "purpose": "Relational storage with transactions and strong consistency options."
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "defaultNotes": {
                "what": "Relational storage with transactions and strong consistency options.",
                "why": "Required for data layer",
                "scalingModel": "Replication + sharding",
                "failureRisk": "lock contention; replication lag; hot rows"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "sql-read-replica",
            "type": "sql-read-replica",
            "label": "SQL Read Replica",
            "category": "storage",
            "position": {
              "x": 420,
              "y": 300
            },
            "data": {
              "label": "SQL Read Replica",
              "layer": "data",
              "role": "Scales reads; offloads primary; may have replication lag.",
              "risks": [
                "stale reads due to lag",
                "failover complexity"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Scales reads; offloads primary; may have replication lag."
            },
            "details": {
              "purpose": "Scales reads; offloads primary; may have replication lag.",
              "defaults": {
                "replicationMode": "",
                "readRouting": "",
                "lagBudget": ""
              },
              "defaultNotes": {
                "what": "Scales reads; offloads primary; may have replication lag.",
                "why": "Required for data layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "stale reads due to lag; failover complexity"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stale reads due to lag; failover complexity",
              "metrics": {}
            }
          },
          {
            "id": "message-store",
            "type": "message-store",
            "label": "Message Store (Sharded KV/Wide-Column)",
            "category": "storage",
            "position": {
              "x": 0,
              "y": 300
            },
            "data": {
              "label": "Message Store (Sharded KV/Wide-Column)",
              "layer": "data",
              "role": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
              "risks": [
                "hot partition for popular conversations",
                "uneven shard distribution"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale."
            },
            "details": {
              "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
              "defaults": {
                "partitionKey": "",
                "sortKey": "",
                "ttl": "",
                "compaction": ""
              },
              "defaultNotes": {
                "what": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
                "why": "Required for data layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot partition for popular conversations; uneven shard distribution"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot partition for popular conversations; uneven shard distribution",
              "metrics": {}
            }
          },
          {
            "id": "conversation-metadata-store",
            "type": "conversation-metadata-store",
            "label": "Conversation Metadata Store",
            "category": "storage",
            "position": {
              "x": 180,
              "y": 300
            },
            "data": {
              "label": "Conversation Metadata Store",
              "layer": "data",
              "role": "Stores conversation metadata: participants, last message timestamp, read receipts.",
              "risks": [
                "hot rows for active conversations",
                "eventual consistency for read receipts"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts."
            },
            "details": {
              "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
              "defaults": {
                "indexes": "",
                "partitionKey": "",
                "cacheLayer": ""
              },
              "defaultNotes": {
                "what": "Stores conversation metadata: participants, last message timestamp, read receipts.",
                "why": "Required for data layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot rows for active conversations; eventual consistency for read receipts"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot rows for active conversations; eventual consistency for read receipts",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "position": {
              "x": 600,
              "y": 300
            },
            "data": {
              "label": "Cache",
              "layer": "caching",
              "role": "Speeds reads and reduces backend load; stores computed/queried data.",
              "risks": [
                "stampede on miss",
                "stale data",
                "cache node failure causing DB overload"
              ],
              "scalingStrategy": "Distributed; replication for HA",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data."
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "defaultNotes": {
                "what": "Speeds reads and reduces backend load; stores computed/queried data.",
                "why": "Required for caching layer",
                "scalingModel": "Distributed; replication for HA",
                "failureRisk": "stampede on miss; stale data; cache node failure causing DB overload"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "cache-invalidation",
            "type": "cache-invalidation",
            "label": "Cache Invalidation Stream",
            "category": "caching",
            "position": {
              "x": 360,
              "y": 300
            },
            "data": {
              "label": "Cache Invalidation Stream",
              "layer": "caching",
              "role": "Propagates invalidation events to caches to keep data fresh.",
              "risks": [
                "missed invalidations",
                "out-of-order invalidations"
              ],
              "scalingStrategy": "Distributed; replication for HA",
              "purpose": "Propagates invalidation events to caches to keep data fresh."
            },
            "details": {
              "purpose": "Propagates invalidation events to caches to keep data fresh.",
              "defaults": {
                "keys": "",
                "batching": "",
                "dedupe": ""
              },
              "defaultNotes": {
                "what": "Propagates invalidation events to caches to keep data fresh.",
                "why": "Required for caching layer",
                "scalingModel": "Distributed; replication for HA",
                "failureRisk": "missed invalidations; out-of-order invalidations"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "missed invalidations; out-of-order invalidations",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "position": {
              "x": 0,
              "y": 400
            },
            "data": {
              "label": "Metrics",
              "layer": "observability",
              "role": "Collects time-series measurements for monitoring and alerting.",
              "risks": [
                "high cardinality costs",
                "missing metrics due to scraping issues"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Collects time-series measurements for monitoring and alerting."
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "defaultNotes": {
                "what": "Collects time-series measurements for monitoring and alerting.",
                "why": "Required for observability layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "high cardinality costs; missing metrics due to scraping issues"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "position": {
              "x": 180,
              "y": 400
            },
            "data": {
              "label": "Logging",
              "layer": "observability",
              "role": "Stores logs for debugging/auditing; supports search and retention.",
              "risks": [
                "PII leakage",
                "cost explosion",
                "missing correlation IDs"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Stores logs for debugging/auditing; supports search and retention."
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "defaultNotes": {
                "what": "Stores logs for debugging/auditing; supports search and retention.",
                "why": "Required for observability layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "PII leakage; cost explosion; missing correlation IDs"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "tracing",
            "type": "tracing",
            "label": "Tracing",
            "category": "observability",
            "position": {
              "x": 360,
              "y": 400
            },
            "data": {
              "label": "Tracing",
              "layer": "observability",
              "role": "Distributed tracing to understand request paths and latency contributors.",
              "risks": [
                "missing propagation",
                "sampling hides tail latencies"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Distributed tracing to understand request paths and latency contributors."
            },
            "details": {
              "purpose": "Distributed tracing to understand request paths and latency contributors.",
              "defaults": {
                "sampling": "",
                "propagation": "",
                "retention": ""
              },
              "defaultNotes": {
                "what": "Distributed tracing to understand request paths and latency contributors.",
                "why": "Required for observability layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "missing propagation; sampling hides tail latencies"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "missing propagation; sampling hides tail latencies",
              "metrics": {}
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "cdn"
          },
          {
            "source": "web-app",
            "target": "api-gateway"
          },
          {
            "source": "cdn",
            "target": "api-gateway"
          },
          {
            "source": "waf",
            "target": "api-gateway"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "api-gateway",
            "target": "auth-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "auth-service",
            "target": "app-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "conversation-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "message-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "realtime-gateway"
          },
          {
            "source": "app-service",
            "target": "queue"
          },
          {
            "source": "queue",
            "target": "worker"
          },
          {
            "source": "worker",
            "target": "dlq"
          },
          {
            "source": "app-service",
            "target": "event-log"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "sql-db",
            "target": "sql-read-replica"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "message-service",
            "target": "message-store"
          },
          {
            "source": "message-service",
            "target": "event-log"
          },
          {
            "source": "conversation-service",
            "target": "conversation-metadata-store"
          },
          {
            "source": "worker",
            "target": "realtime-gateway"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "message-service",
            "target": "metrics"
          },
          {
            "source": "conversation-service",
            "target": "metrics"
          },
          {
            "source": "worker",
            "target": "metrics"
          },
          {
            "source": "notification-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "app-service",
            "target": "tracing"
          }
        ],
        "notesByNodeId": {
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": [
              "cacheTTL",
              "cacheKey",
              "staleWhileRevalidate",
              "purge",
              "geoRestrictions"
            ],
            "tradeoffs": [
              "cache poisoning",
              "stale content",
              "origin overload when cache miss spikes"
            ],
            "failureModes": [
              "cache poisoning",
              "stale content",
              "origin overload when cache miss spikes"
            ],
            "interviewHooks": [
              "What do you cache? How do you invalidate? Cache key design?"
            ],
            "what": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "why": "Required for edge layer",
            "scalingModel": "Distributed; replication for HA",
            "failureRisk": "cache poisoning; stale content; origin overload when cache miss spikes"
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": [
              "rules",
              "botProtection",
              "ipAllowDeny",
              "rateRules"
            ],
            "tradeoffs": [
              "false positives blocking good traffic",
              "rules drift"
            ],
            "failureModes": [
              "false positives blocking good traffic",
              "rules drift"
            ],
            "interviewHooks": [
              "How do you tune rules? Whats your rollout strategy?"
            ],
            "what": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "false positives blocking good traffic; rules drift"
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": [
              "limitKey",
              "limits",
              "burst",
              "window",
              "tokenBucket",
              "leakyBucket"
            ],
            "tradeoffs": [
              "hot keys on limiter storage",
              "incorrect keying causing unfair limits"
            ],
            "failureModes": [
              "hot keys on limiter storage",
              "incorrect keying causing unfair limits"
            ],
            "interviewHooks": [
              "Token bucket vs fixed window? Distributed rate limiting?"
            ],
            "what": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot keys on limiter storage; incorrect keying causing unfair limits"
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": [
              "routes",
              "auth",
              "quotas",
              "timeouts",
              "payloadLimits"
            ],
            "tradeoffs": [
              "single point of failure",
              "misconfigured routing",
              "latency overhead"
            ],
            "failureModes": [
              "single point of failure",
              "misconfigured routing",
              "latency overhead"
            ],
            "interviewHooks": [
              "Why gateway vs LB only? How do you avoid SPOF?"
            ],
            "what": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "why": "Required for gateway layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "single point of failure; misconfigured routing; latency overhead"
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": [
              "algorithm",
              "healthChecks",
              "timeouts",
              "connectionDraining"
            ],
            "tradeoffs": [
              "bad health checks flapping",
              "uneven load distribution"
            ],
            "failureModes": [
              "bad health checks flapping",
              "uneven load distribution"
            ],
            "interviewHooks": [
              "Round-robin vs least-connections? L4 vs L7?"
            ],
            "what": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "why": "Required for gateway layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "bad health checks flapping; uneven load distribution"
          },
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": [
              "cache",
              "prefetch",
              "offlineMode"
            ],
            "tradeoffs": [
              "stale UI state",
              "over-fetching"
            ],
            "failureModes": [
              "stale UI state",
              "over-fetching"
            ],
            "interviewHooks": [
              "How do you optimize roundtrips? Error handling?"
            ],
            "what": "Client-facing UI; calls APIs; manages user interactions.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "stale UI state; over-fetching"
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": [
              "autoscaling",
              "timeouts",
              "retries",
              "circuitBreaker"
            ],
            "tradeoffs": [
              "dependency timeouts cascading",
              "resource exhaustion",
              "thundering herd"
            ],
            "failureModes": [
              "dependency timeouts cascading",
              "resource exhaustion",
              "thundering herd"
            ],
            "interviewHooks": [
              "Timeout budgets? Bulkheads? Retries with jitter?"
            ],
            "what": "Core business logic service handling requests and orchestrating dependencies.",
            "why": "Required for app layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "dependency timeouts cascading; resource exhaustion; thundering herd"
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ],
            "what": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "why": "Required for app layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "token replay if not bound; clock skew issues; session store overload"
          },
          "realtime-gateway": {
            "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
            "knobs": [
              "connectionTimeout",
              "heartbeatInterval",
              "maxConnectionsPerInstance",
              "stickySessions"
            ],
            "tradeoffs": [
              "connection storms on reconnect",
              "stale connections after instance failover"
            ],
            "failureModes": [
              "connection storms on reconnect",
              "stale connections after instance failover"
            ],
            "interviewHooks": [
              "How do you scale WebSocket servers? Sticky sessions? Reconnection strategy?"
            ],
            "what": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "connection storms on reconnect; stale connections after instance failover"
          },
          "presence-service": {
            "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
            "knobs": [
              "heartbeatTTL",
              "slidingWindow",
              "shardingKey"
            ],
            "tradeoffs": [
              "stale presence after crash",
              "hot keys for popular users"
            ],
            "failureModes": [
              "stale presence after crash",
              "hot keys for popular users"
            ],
            "interviewHooks": [
              "How do you handle flaky networks? Scale presence for millions?"
            ],
            "what": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "stale presence after crash; hot keys for popular users"
          },
          "conversation-service": {
            "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
            "knobs": [
              "pagination",
              "indexStrategy",
              "cacheTTL"
            ],
            "tradeoffs": [
              "N+1 queries on list",
              "hot partitions for popular conversations"
            ],
            "failureModes": [
              "N+1 queries on list",
              "hot partitions for popular conversations"
            ],
            "interviewHooks": [
              "How do you paginate? Order by last message?"
            ],
            "what": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "N+1 queries on list; hot partitions for popular conversations"
          },
          "message-service": {
            "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
            "knobs": [
              "idempotencyKey",
              "ordering",
              "retention"
            ],
            "tradeoffs": [
              "duplicate messages without idempotency",
              "ordering breaks under load"
            ],
            "failureModes": [
              "duplicate messages without idempotency",
              "ordering breaks under load"
            ],
            "interviewHooks": [
              "Idempotency? Ordering guarantees? Fanout strategy?"
            ],
            "what": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "duplicate messages without idempotency; ordering breaks under load"
          },
          "notification-service": {
            "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
            "knobs": [
              "batchSize",
              "retryPolicy",
              "deviceTokenRefresh"
            ],
            "tradeoffs": [
              "token expiry causing silent failures",
              "provider rate limits"
            ],
            "failureModes": [
              "token expiry causing silent failures",
              "provider rate limits"
            ],
            "interviewHooks": [
              "How do you handle token refresh? Batching for scale?"
            ],
            "what": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "token expiry causing silent failures; provider rate limits"
          },
          "circuit-breaker": {
            "purpose": "Stops calling failing dependencies to prevent cascading failures.",
            "knobs": [
              "errorThreshold",
              "openDuration",
              "halfOpenProbes",
              "fallback"
            ],
            "tradeoffs": [
              "bad thresholds causing flapping",
              "no fallback path"
            ],
            "failureModes": [
              "bad thresholds causing flapping",
              "no fallback path"
            ],
            "interviewHooks": [
              "Where do you place it? How do you choose thresholds?"
            ],
            "what": "Stops calling failing dependencies to prevent cascading failures.",
            "why": "Required for resilience layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "bad thresholds causing flapping; no fallback path"
          },
          "retry-policy": {
            "purpose": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
            "knobs": [
              "maxRetries",
              "backoff",
              "jitter",
              "retryBudget"
            ],
            "tradeoffs": [
              "retry storms",
              "retrying non-idempotent ops"
            ],
            "failureModes": [
              "retry storms",
              "retrying non-idempotent ops"
            ],
            "interviewHooks": [
              "Which calls are safe to retry? Retry budget?"
            ],
            "what": "Retries transient failures safely using backoff + jitter; must avoid amplification.",
            "why": "Required for resilience layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "retry storms; retrying non-idempotent ops"
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ],
            "what": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "why": "Required for async layer",
            "scalingModel": "Partition-based scale; consumers per partition",
            "failureRisk": "backlog growth; duplicate delivery; hot partitions (FIFO)"
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": [
              "partitions",
              "replication",
              "retention",
              "compaction"
            ],
            "tradeoffs": [
              "hot partition",
              "consumer lag",
              "rebalancing storms"
            ],
            "failureModes": [
              "hot partition",
              "consumer lag",
              "rebalancing storms"
            ],
            "interviewHooks": [
              "Partition key design? Exactly-once processing patterns?"
            ],
            "what": "Durable ordered log for high-throughput event streaming and replay.",
            "why": "Required for async layer",
            "scalingModel": "Partition-based scale; consumers per partition",
            "failureRisk": "hot partition; consumer lag; rebalancing storms"
          },
          "pubsub": {
            "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "knobs": [
              "subscriptionFilters",
              "retention",
              "ackDeadline",
              "replay"
            ],
            "tradeoffs": [
              "slow consumer lag",
              "fanout amplification"
            ],
            "failureModes": [
              "slow consumer lag",
              "fanout amplification"
            ],
            "interviewHooks": [
              "Delivery guarantees? Replay strategy? Consumer isolation?"
            ],
            "what": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "why": "Required for async layer",
            "scalingModel": "Partition-based scale; consumers per partition",
            "failureRisk": "slow consumer lag; fanout amplification"
          },
          "dlq": {
            "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
            "knobs": [
              "maxReceiveCount",
              "redrivePolicy"
            ],
            "tradeoffs": [
              "silent accumulation (no monitoring)",
              "reprocessing without fix"
            ],
            "failureModes": [
              "silent accumulation (no monitoring)",
              "reprocessing without fix"
            ],
            "interviewHooks": [
              "How do you triage DLQ? Automated redrive?"
            ],
            "what": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
            "why": "Required for async layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "silent accumulation (no monitoring); reprocessing without fix"
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": [
              "concurrency",
              "retries",
              "idempotency",
              "batchSize"
            ],
            "tradeoffs": [
              "poison messages",
              "retry storms",
              "duplicate processing"
            ],
            "failureModes": [
              "poison messages",
              "retry storms",
              "duplicate processing"
            ],
            "interviewHooks": [
              "At-least-once semantics? DLQ strategy? Idempotency design?"
            ],
            "what": "Consumes async jobs/events; performs background processing.",
            "why": "Required for async layer",
            "scalingModel": "Partition-based scale; consumers per partition",
            "failureRisk": "poison messages; retry storms; duplicate processing"
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": [
              "indexes",
              "replication",
              "partitioning",
              "connectionPool",
              "isolationLevel"
            ],
            "tradeoffs": [
              "lock contention",
              "replication lag",
              "hot rows"
            ],
            "failureModes": [
              "lock contention",
              "replication lag",
              "hot rows"
            ],
            "interviewHooks": [
              "Sharding strategy? Isolation level? Read replicas usage?"
            ],
            "what": "Relational storage with transactions and strong consistency options.",
            "why": "Required for data layer",
            "scalingModel": "Replication + sharding",
            "failureRisk": "lock contention; replication lag; hot rows"
          },
          "sql-read-replica": {
            "purpose": "Scales reads; offloads primary; may have replication lag.",
            "knobs": [
              "replicationMode",
              "readRouting",
              "lagBudget"
            ],
            "tradeoffs": [
              "stale reads due to lag",
              "failover complexity"
            ],
            "failureModes": [
              "stale reads due to lag",
              "failover complexity"
            ],
            "interviewHooks": [
              "How do you route reads? Consistency guarantees?"
            ],
            "what": "Scales reads; offloads primary; may have replication lag.",
            "why": "Required for data layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "stale reads due to lag; failover complexity"
          },
          "message-store": {
            "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
            "knobs": [
              "partitionKey",
              "sortKey",
              "ttl",
              "compaction"
            ],
            "tradeoffs": [
              "hot partition for popular conversations",
              "uneven shard distribution"
            ],
            "failureModes": [
              "hot partition for popular conversations",
              "uneven shard distribution"
            ],
            "interviewHooks": [
              "Partition key design? Time-range queries? Compaction?"
            ],
            "what": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
            "why": "Required for data layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot partition for popular conversations; uneven shard distribution"
          },
          "conversation-metadata-store": {
            "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
            "knobs": [
              "indexes",
              "partitionKey",
              "cacheLayer"
            ],
            "tradeoffs": [
              "hot rows for active conversations",
              "eventual consistency for read receipts"
            ],
            "failureModes": [
              "hot rows for active conversations",
              "eventual consistency for read receipts"
            ],
            "interviewHooks": [
              "Index for list-by-user? Consistency model?"
            ],
            "what": "Stores conversation metadata: participants, last message timestamp, read receipts.",
            "why": "Required for data layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot rows for active conversations; eventual consistency for read receipts"
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": [
              "ttl",
              "evictionPolicy",
              "maxMemory",
              "sharding",
              "replication"
            ],
            "tradeoffs": [
              "stampede on miss",
              "stale data",
              "cache node failure causing DB overload"
            ],
            "failureModes": [
              "stampede on miss",
              "stale data",
              "cache node failure causing DB overload"
            ],
            "interviewHooks": [
              "Cache-aside vs read-through? Stampede mitigation? Invalidation?"
            ],
            "what": "Speeds reads and reduces backend load; stores computed/queried data.",
            "why": "Required for caching layer",
            "scalingModel": "Distributed; replication for HA",
            "failureRisk": "stampede on miss; stale data; cache node failure causing DB overload"
          },
          "cache-invalidation": {
            "purpose": "Propagates invalidation events to caches to keep data fresh.",
            "knobs": [
              "keys",
              "batching",
              "dedupe"
            ],
            "tradeoffs": [
              "missed invalidations",
              "out-of-order invalidations"
            ],
            "failureModes": [
              "missed invalidations",
              "out-of-order invalidations"
            ],
            "interviewHooks": [
              "TTL-only vs event invalidation? Exactly-once invalidation?"
            ],
            "what": "Propagates invalidation events to caches to keep data fresh.",
            "why": "Required for caching layer",
            "scalingModel": "Distributed; replication for HA",
            "failureRisk": "missed invalidations; out-of-order invalidations"
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": [
              "cardinalityGuards",
              "scrapeInterval",
              "retention"
            ],
            "tradeoffs": [
              "high cardinality costs",
              "missing metrics due to scraping issues"
            ],
            "failureModes": [
              "high cardinality costs",
              "missing metrics due to scraping issues"
            ],
            "interviewHooks": [
              "SLI/SLO? Alert fatigue? Cardinality control?"
            ],
            "what": "Collects time-series measurements for monitoring and alerting.",
            "why": "Required for observability layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "high cardinality costs; missing metrics due to scraping issues"
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": [
              "sampling",
              "retention",
              "redaction"
            ],
            "tradeoffs": [
              "PII leakage",
              "cost explosion",
              "missing correlation IDs"
            ],
            "failureModes": [
              "PII leakage",
              "cost explosion",
              "missing correlation IDs"
            ],
            "interviewHooks": [
              "Structured logs? Sampling? PII redaction?"
            ],
            "what": "Stores logs for debugging/auditing; supports search and retention.",
            "why": "Required for observability layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "PII leakage; cost explosion; missing correlation IDs"
          },
          "tracing": {
            "purpose": "Distributed tracing to understand request paths and latency contributors.",
            "knobs": [
              "sampling",
              "propagation",
              "retention"
            ],
            "tradeoffs": [
              "missing propagation",
              "sampling hides tail latencies"
            ],
            "failureModes": [
              "missing propagation",
              "sampling hides tail latencies"
            ],
            "interviewHooks": [
              "How to debug tail latency? Sampling strategy?"
            ],
            "what": "Distributed tracing to understand request paths and latency contributors.",
            "why": "Required for observability layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "missing propagation; sampling hides tail latencies"
          }
        }
      },
      "validation": {
        "coverage": [
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "realtime-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "presence-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "conversation-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "message-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "notification-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "circuit-breaker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "retry-policy",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "pubsub",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "dlq",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-read-replica",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "message-store",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "conversation-metadata-store",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "cache-invalidation",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "tracing",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "realtime-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "presence-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "conversation-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "message-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "notification-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "circuit-breaker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "retry-policy",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "pubsub",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "dlq",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-read-replica",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "message-store",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "conversation-metadata-store",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache-invalidation",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "tracing",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 29,
          "core": 4,
          "optional": 25,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "packVersion": 2
    },
    {
      "id": "pack-a-chat-system",
      "title": "Design a Chat System",
      "problemStatement": "Design a Chat System",
      "functionalRequirements": [
        "Send message",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions",
        "User can perform core actions"
      ],
      "nonFunctionalRequirements": [
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available",
        "System should be scalable and available"
      ],
      "constraints": [],
      "constraintsAssumptions": [
        "Assume standard cloud infrastructure",
        "Assume moderate initial scale",
        "Assume eventual consistency acceptable where appropriate",
        "Assume single region initially",
        "Assume existing auth system"
      ],
      "designPlan": {
        "workload": {
          "traffic": "moderate",
          "storage": "moderate",
          "latency": "p99 < 200ms",
          "availability": "99.9%"
        },
        "coreFlows": [
          {
            "id": "flow-1",
            "description": "Send message",
            "type": "primary"
          },
          {
            "id": "flow-2",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-3",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-4",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-5",
            "description": "User can perform core actions",
            "type": "primary"
          },
          {
            "id": "flow-6",
            "description": "User can perform core actions",
            "type": "primary"
          }
        ],
        "entities": [
          "User",
          "Resource"
        ],
        "accessPatterns": [],
        "risks": [],
        "qualityGoals": []
      },
      "diagramSpec": {
        "nodes": [
          {
            "id": "cdn",
            "type": "cdn",
            "label": "CDN",
            "category": "edge",
            "position": {
              "x": 0,
              "y": 0
            },
            "data": {
              "label": "CDN",
              "layer": "edge",
              "role": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "risks": [
                "cache poisoning",
                "stale content",
                "origin overload when cache miss spikes"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load."
            },
            "details": {
              "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
              "defaults": {
                "cacheTTL": "",
                "cacheKey": "",
                "staleWhileRevalidate": "",
                "purge": "",
                "geoRestrictions": ""
              },
              "defaultNotes": {
                "what": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "cache poisoning; stale content; origin overload when cache miss spikes"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "cache poisoning; stale content; origin overload when cache miss spikes",
              "metrics": {}
            }
          },
          {
            "id": "waf",
            "type": "waf",
            "label": "WAF",
            "category": "security",
            "position": {
              "x": 180,
              "y": 0
            },
            "data": {
              "label": "WAF",
              "layer": "edge",
              "role": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "risks": [
                "false positives blocking good traffic",
                "rules drift"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge."
            },
            "details": {
              "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
              "defaults": {
                "rules": "",
                "botProtection": "",
                "ipAllowDeny": "",
                "rateRules": ""
              },
              "defaultNotes": {
                "what": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "false positives blocking good traffic; rules drift"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "false positives blocking good traffic; rules drift",
              "metrics": {}
            }
          },
          {
            "id": "edge-rate-limiter",
            "type": "edge-rate-limiter",
            "label": "Rate Limiter",
            "category": "reliability",
            "position": {
              "x": 360,
              "y": 0
            },
            "data": {
              "label": "Rate Limiter",
              "layer": "edge",
              "role": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "risks": [
                "hot keys on limiter storage",
                "incorrect keying causing unfair limits"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits."
            },
            "details": {
              "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
              "defaults": {
                "limitKey": "",
                "limits": "",
                "burst": "",
                "window": "",
                "tokenBucket": "",
                "leakyBucket": ""
              },
              "defaultNotes": {
                "what": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot keys on limiter storage; incorrect keying causing unfair limits"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot keys on limiter storage; incorrect keying causing unfair limits",
              "metrics": {}
            }
          },
          {
            "id": "api-gateway",
            "type": "api-gateway",
            "label": "API Gateway",
            "category": "edge",
            "position": {
              "x": 540,
              "y": 0
            },
            "data": {
              "label": "API Gateway",
              "layer": "gateway",
              "role": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "risks": [
                "single point of failure",
                "misconfigured routing",
                "latency overhead"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping."
            },
            "details": {
              "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
              "defaults": {
                "routes": "",
                "auth": "",
                "quotas": "",
                "timeouts": "",
                "payloadLimits": ""
              },
              "defaultNotes": {
                "what": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
                "why": "Required for gateway layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "single point of failure; misconfigured routing; latency overhead"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "single point of failure; misconfigured routing; latency overhead",
              "metrics": {}
            }
          },
          {
            "id": "load-balancer-l7",
            "type": "load-balancer-l7",
            "label": "Load Balancer (L7)",
            "category": "edge",
            "position": {
              "x": 720,
              "y": 0
            },
            "data": {
              "label": "Load Balancer (L7)",
              "layer": "gateway",
              "role": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "risks": [
                "bad health checks flapping",
                "uneven load distribution"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules."
            },
            "details": {
              "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
              "defaults": {
                "algorithm": "",
                "healthChecks": "",
                "timeouts": "",
                "connectionDraining": ""
              },
              "defaultNotes": {
                "what": "Distributes HTTP traffic across healthy instances; supports routing rules.",
                "why": "Required for gateway layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "bad health checks flapping; uneven load distribution"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "bad health checks flapping; uneven load distribution",
              "metrics": {}
            }
          },
          {
            "id": "web-app",
            "type": "web-app",
            "label": "Web App / UI",
            "category": "client",
            "position": {
              "x": 0,
              "y": 100
            },
            "data": {
              "label": "Web App / UI",
              "layer": "edge",
              "role": "Client-facing UI; calls APIs; manages user interactions.",
              "risks": [
                "stale UI state",
                "over-fetching"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Client-facing UI; calls APIs; manages user interactions."
            },
            "details": {
              "purpose": "Client-facing UI; calls APIs; manages user interactions.",
              "defaults": {
                "cache": "",
                "prefetch": "",
                "offlineMode": ""
              },
              "defaultNotes": {
                "what": "Client-facing UI; calls APIs; manages user interactions.",
                "why": "Required for edge layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "stale UI state; over-fetching"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stale UI state; over-fetching",
              "metrics": {}
            }
          },
          {
            "id": "app-service",
            "type": "app-service",
            "label": "App Service",
            "category": "compute",
            "position": {
              "x": 180,
              "y": 100
            },
            "data": {
              "label": "App Service",
              "layer": "app",
              "role": "Core business logic service handling requests and orchestrating dependencies.",
              "risks": [
                "dependency timeouts cascading",
                "resource exhaustion",
                "thundering herd"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Core business logic service handling requests and orchestrating dependencies."
            },
            "details": {
              "purpose": "Core business logic service handling requests and orchestrating dependencies.",
              "defaults": {
                "autoscaling": "",
                "timeouts": "",
                "retries": "",
                "circuitBreaker": ""
              },
              "defaultNotes": {
                "what": "Core business logic service handling requests and orchestrating dependencies.",
                "why": "Required for app layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "dependency timeouts cascading; resource exhaustion; thundering herd"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "dependency timeouts cascading; resource exhaustion; thundering herd",
              "metrics": {}
            }
          },
          {
            "id": "auth-service",
            "type": "auth-service",
            "label": "Auth Service",
            "category": "security",
            "position": {
              "x": 360,
              "y": 100
            },
            "data": {
              "label": "Auth Service",
              "layer": "app",
              "role": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "risks": [
                "token replay if not bound",
                "clock skew issues",
                "session store overload"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows."
            },
            "details": {
              "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
              "defaults": {
                "tokenTTL": "",
                "refreshTTL": "",
                "rotation": "",
                "mfa": ""
              },
              "defaultNotes": {
                "what": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
                "why": "Required for app layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "token replay if not bound; clock skew issues; session store overload"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "token replay if not bound; clock skew issues; session store overload",
              "metrics": {}
            }
          },
          {
            "id": "realtime-gateway",
            "type": "realtime-gateway",
            "label": "Realtime Gateway (WebSocket)",
            "category": "edge",
            "position": {
              "x": 420,
              "y": 100
            },
            "data": {
              "label": "Realtime Gateway (WebSocket)",
              "layer": "domain",
              "role": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
              "risks": [
                "connection storms on reconnect",
                "stale connections after instance failover"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients."
            },
            "details": {
              "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
              "defaults": {
                "connectionTimeout": "",
                "heartbeatInterval": "",
                "maxConnectionsPerInstance": "",
                "stickySessions": ""
              },
              "defaultNotes": {
                "what": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "connection storms on reconnect; stale connections after instance failover"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "connection storms on reconnect; stale connections after instance failover",
              "metrics": {}
            }
          },
          {
            "id": "presence-service",
            "type": "presence-service",
            "label": "Presence Service",
            "category": "compute",
            "position": {
              "x": 600,
              "y": 100
            },
            "data": {
              "label": "Presence Service",
              "layer": "domain",
              "role": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
              "risks": [
                "stale presence after crash",
                "hot keys for popular users"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership."
            },
            "details": {
              "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
              "defaults": {
                "heartbeatTTL": "",
                "slidingWindow": "",
                "shardingKey": ""
              },
              "defaultNotes": {
                "what": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "stale presence after crash; hot keys for popular users"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stale presence after crash; hot keys for popular users",
              "metrics": {}
            }
          },
          {
            "id": "conversation-service",
            "type": "conversation-service",
            "label": "Conversation Service",
            "category": "compute",
            "position": {
              "x": 540,
              "y": 100
            },
            "data": {
              "label": "Conversation Service",
              "layer": "domain",
              "role": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
              "risks": [
                "N+1 queries on list",
                "hot partitions for popular conversations"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants."
            },
            "details": {
              "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
              "defaults": {
                "pagination": "",
                "indexStrategy": "",
                "cacheTTL": ""
              },
              "defaultNotes": {
                "what": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "N+1 queries on list; hot partitions for popular conversations"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "N+1 queries on list; hot partitions for popular conversations",
              "metrics": {}
            }
          },
          {
            "id": "message-service",
            "type": "message-service",
            "label": "Message Service",
            "category": "compute",
            "position": {
              "x": 720,
              "y": 100
            },
            "data": {
              "label": "Message Service",
              "layer": "domain",
              "role": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
              "risks": [
                "duplicate messages without idempotency",
                "ordering breaks under load"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines."
            },
            "details": {
              "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
              "defaults": {
                "idempotencyKey": "",
                "ordering": "",
                "retention": ""
              },
              "defaultNotes": {
                "what": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "duplicate messages without idempotency; ordering breaks under load"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "duplicate messages without idempotency; ordering breaks under load",
              "metrics": {}
            }
          },
          {
            "id": "notification-service",
            "type": "notification-service",
            "label": "Notification Service (Push)",
            "category": "compute",
            "position": {
              "x": 900,
              "y": 100
            },
            "data": {
              "label": "Notification Service (Push)",
              "layer": "domain",
              "role": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
              "risks": [
                "token expiry causing silent failures",
                "provider rate limits"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries."
            },
            "details": {
              "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
              "defaults": {
                "batchSize": "",
                "retryPolicy": "",
                "deviceTokenRefresh": ""
              },
              "defaultNotes": {
                "what": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
                "why": "Required for domain layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "token expiry causing silent failures; provider rate limits"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "token expiry causing silent failures; provider rate limits",
              "metrics": {}
            }
          },
          {
            "id": "queue",
            "type": "queue",
            "label": "Queue",
            "category": "messaging",
            "position": {
              "x": 0,
              "y": 200
            },
            "data": {
              "label": "Queue",
              "layer": "async",
              "role": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "risks": [
                "backlog growth",
                "duplicate delivery",
                "hot partitions (FIFO)"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes."
            },
            "details": {
              "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
              "defaults": {
                "visibilityTimeout": "",
                "maxRetries": "",
                "dlq": "",
                "fifo": "",
                "orderingKey": ""
              },
              "defaultNotes": {
                "what": "Buffers tasks; decouples producers/consumers; smooths spikes.",
                "why": "Required for async layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "backlog growth; duplicate delivery; hot partitions (FIFO)"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "backlog growth; duplicate delivery; hot partitions (FIFO)",
              "metrics": {}
            }
          },
          {
            "id": "event-log",
            "type": "event-log",
            "label": "Event Log / Stream",
            "category": "messaging",
            "position": {
              "x": 100,
              "y": 200
            },
            "data": {
              "label": "Event Log / Stream",
              "layer": "async",
              "role": "Durable ordered log for high-throughput event streaming and replay.",
              "risks": [
                "hot partition",
                "consumer lag",
                "rebalancing storms"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Durable ordered log for high-throughput event streaming and replay."
            },
            "details": {
              "purpose": "Durable ordered log for high-throughput event streaming and replay.",
              "defaults": {
                "partitions": "",
                "replication": "",
                "retention": "",
                "compaction": ""
              },
              "defaultNotes": {
                "what": "Durable ordered log for high-throughput event streaming and replay.",
                "why": "Required for async layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot partition; consumer lag; rebalancing storms"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot partition; consumer lag; rebalancing storms",
              "metrics": {}
            }
          },
          {
            "id": "pubsub",
            "type": "pubsub",
            "label": "Pub/Sub",
            "category": "messaging",
            "position": {
              "x": 0,
              "y": 200
            },
            "data": {
              "label": "Pub/Sub",
              "layer": "async",
              "role": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "risks": [
                "slow consumer lag",
                "fanout amplification"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers."
            },
            "details": {
              "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
              "defaults": {
                "subscriptionFilters": "",
                "retention": "",
                "ackDeadline": "",
                "replay": ""
              },
              "defaultNotes": {
                "what": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
                "why": "Required for async layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "slow consumer lag; fanout amplification"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "slow consumer lag; fanout amplification",
              "metrics": {}
            }
          },
          {
            "id": "dlq",
            "type": "dlq",
            "label": "Dead Letter Queue",
            "category": "reliability",
            "position": {
              "x": 180,
              "y": 200
            },
            "data": {
              "label": "Dead Letter Queue",
              "layer": "async",
              "role": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
              "risks": [
                "silent accumulation (no monitoring)",
                "reprocessing without fix"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines."
            },
            "details": {
              "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
              "defaults": {
                "maxReceiveCount": "",
                "redrivePolicy": ""
              },
              "defaultNotes": {
                "what": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
                "why": "Required for async layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "silent accumulation (no monitoring); reprocessing without fix"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "silent accumulation (no monitoring); reprocessing without fix",
              "metrics": {}
            }
          },
          {
            "id": "worker",
            "type": "worker",
            "label": "Worker",
            "category": "compute",
            "position": {
              "x": 360,
              "y": 200
            },
            "data": {
              "label": "Worker",
              "layer": "async",
              "role": "Consumes async jobs/events; performs background processing.",
              "risks": [
                "poison messages",
                "retry storms",
                "duplicate processing"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Consumes async jobs/events; performs background processing."
            },
            "details": {
              "purpose": "Consumes async jobs/events; performs background processing.",
              "defaults": {
                "concurrency": "",
                "retries": "",
                "idempotency": "",
                "batchSize": ""
              },
              "defaultNotes": {
                "what": "Consumes async jobs/events; performs background processing.",
                "why": "Required for async layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "poison messages; retry storms; duplicate processing"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "poison messages; retry storms; duplicate processing",
              "metrics": {}
            }
          },
          {
            "id": "sql-db",
            "type": "sql-db",
            "label": "SQL Database",
            "category": "storage",
            "position": {
              "x": 0,
              "y": 300
            },
            "data": {
              "label": "SQL Database",
              "layer": "data",
              "role": "Relational storage with transactions and strong consistency options.",
              "risks": [
                "lock contention",
                "replication lag",
                "hot rows"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Relational storage with transactions and strong consistency options."
            },
            "details": {
              "purpose": "Relational storage with transactions and strong consistency options.",
              "defaults": {
                "indexes": "",
                "replication": "",
                "partitioning": "",
                "connectionPool": "",
                "isolationLevel": ""
              },
              "defaultNotes": {
                "what": "Relational storage with transactions and strong consistency options.",
                "why": "Required for data layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "lock contention; replication lag; hot rows"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "lock contention; replication lag; hot rows",
              "metrics": {}
            }
          },
          {
            "id": "message-store",
            "type": "message-store",
            "label": "Message Store (Sharded KV/Wide-Column)",
            "category": "storage",
            "position": {
              "x": 0,
              "y": 300
            },
            "data": {
              "label": "Message Store (Sharded KV/Wide-Column)",
              "layer": "data",
              "role": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
              "risks": [
                "hot partition for popular conversations",
                "uneven shard distribution"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale."
            },
            "details": {
              "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
              "defaults": {
                "partitionKey": "",
                "sortKey": "",
                "ttl": "",
                "compaction": ""
              },
              "defaultNotes": {
                "what": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
                "why": "Required for data layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot partition for popular conversations; uneven shard distribution"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot partition for popular conversations; uneven shard distribution",
              "metrics": {}
            }
          },
          {
            "id": "conversation-metadata-store",
            "type": "conversation-metadata-store",
            "label": "Conversation Metadata Store",
            "category": "storage",
            "position": {
              "x": 180,
              "y": 300
            },
            "data": {
              "label": "Conversation Metadata Store",
              "layer": "data",
              "role": "Stores conversation metadata: participants, last message timestamp, read receipts.",
              "risks": [
                "hot rows for active conversations",
                "eventual consistency for read receipts"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts."
            },
            "details": {
              "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
              "defaults": {
                "indexes": "",
                "partitionKey": "",
                "cacheLayer": ""
              },
              "defaultNotes": {
                "what": "Stores conversation metadata: participants, last message timestamp, read receipts.",
                "why": "Required for data layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "hot rows for active conversations; eventual consistency for read receipts"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "hot rows for active conversations; eventual consistency for read receipts",
              "metrics": {}
            }
          },
          {
            "id": "cache",
            "type": "cache",
            "label": "Cache",
            "category": "caching",
            "position": {
              "x": 420,
              "y": 300
            },
            "data": {
              "label": "Cache",
              "layer": "caching",
              "role": "Speeds reads and reduces backend load; stores computed/queried data.",
              "risks": [
                "stampede on miss",
                "stale data",
                "cache node failure causing DB overload"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data."
            },
            "details": {
              "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
              "defaults": {
                "ttl": "",
                "evictionPolicy": "",
                "maxMemory": "",
                "sharding": "",
                "replication": ""
              },
              "defaultNotes": {
                "what": "Speeds reads and reduces backend load; stores computed/queried data.",
                "why": "Required for caching layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "stampede on miss; stale data; cache node failure causing DB overload"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "stampede on miss; stale data; cache node failure causing DB overload",
              "metrics": {}
            }
          },
          {
            "id": "metrics",
            "type": "metrics",
            "label": "Metrics",
            "category": "observability",
            "position": {
              "x": 0,
              "y": 400
            },
            "data": {
              "label": "Metrics",
              "layer": "observability",
              "role": "Collects time-series measurements for monitoring and alerting.",
              "risks": [
                "high cardinality costs",
                "missing metrics due to scraping issues"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Collects time-series measurements for monitoring and alerting."
            },
            "details": {
              "purpose": "Collects time-series measurements for monitoring and alerting.",
              "defaults": {
                "cardinalityGuards": "",
                "scrapeInterval": "",
                "retention": ""
              },
              "defaultNotes": {
                "what": "Collects time-series measurements for monitoring and alerting.",
                "why": "Required for observability layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "high cardinality costs; missing metrics due to scraping issues"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "high cardinality costs; missing metrics due to scraping issues",
              "metrics": {}
            }
          },
          {
            "id": "logging",
            "type": "logging",
            "label": "Logging",
            "category": "observability",
            "position": {
              "x": 180,
              "y": 400
            },
            "data": {
              "label": "Logging",
              "layer": "observability",
              "role": "Stores logs for debugging/auditing; supports search and retention.",
              "risks": [
                "PII leakage",
                "cost explosion",
                "missing correlation IDs"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Stores logs for debugging/auditing; supports search and retention."
            },
            "details": {
              "purpose": "Stores logs for debugging/auditing; supports search and retention.",
              "defaults": {
                "sampling": "",
                "retention": "",
                "redaction": ""
              },
              "defaultNotes": {
                "what": "Stores logs for debugging/auditing; supports search and retention.",
                "why": "Required for observability layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "PII leakage; cost explosion; missing correlation IDs"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "PII leakage; cost explosion; missing correlation IDs",
              "metrics": {}
            }
          },
          {
            "id": "tracing",
            "type": "tracing",
            "label": "Tracing",
            "category": "observability",
            "position": {
              "x": 360,
              "y": 400
            },
            "data": {
              "label": "Tracing",
              "layer": "observability",
              "role": "Distributed tracing to understand request paths and latency contributors.",
              "risks": [
                "missing propagation",
                "sampling hides tail latencies"
              ],
              "scalingStrategy": "Horizontal scaling",
              "purpose": "Distributed tracing to understand request paths and latency contributors."
            },
            "details": {
              "purpose": "Distributed tracing to understand request paths and latency contributors.",
              "defaults": {
                "sampling": "",
                "propagation": "",
                "retention": ""
              },
              "defaultNotes": {
                "what": "Distributed tracing to understand request paths and latency contributors.",
                "why": "Required for observability layer",
                "scalingModel": "Horizontal scaling",
                "failureRisk": "missing propagation; sampling hides tail latencies"
              }
            },
            "justification": {
              "reasons": [],
              "tradeoffs": "",
              "failureModes": "missing propagation; sampling hides tail latencies",
              "metrics": {}
            }
          }
        ],
        "edges": [
          {
            "source": "web-app",
            "target": "cdn"
          },
          {
            "source": "web-app",
            "target": "api-gateway"
          },
          {
            "source": "cdn",
            "target": "api-gateway"
          },
          {
            "source": "waf",
            "target": "api-gateway"
          },
          {
            "source": "edge-rate-limiter",
            "target": "api-gateway"
          },
          {
            "source": "api-gateway",
            "target": "load-balancer-l7"
          },
          {
            "source": "api-gateway",
            "target": "auth-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "app-service"
          },
          {
            "source": "auth-service",
            "target": "app-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "conversation-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "message-service"
          },
          {
            "source": "load-balancer-l7",
            "target": "realtime-gateway"
          },
          {
            "source": "app-service",
            "target": "queue"
          },
          {
            "source": "queue",
            "target": "worker"
          },
          {
            "source": "worker",
            "target": "dlq"
          },
          {
            "source": "app-service",
            "target": "event-log"
          },
          {
            "source": "event-log",
            "target": "worker"
          },
          {
            "source": "app-service",
            "target": "sql-db"
          },
          {
            "source": "app-service",
            "target": "cache"
          },
          {
            "source": "message-service",
            "target": "message-store"
          },
          {
            "source": "message-service",
            "target": "event-log"
          },
          {
            "source": "conversation-service",
            "target": "conversation-metadata-store"
          },
          {
            "source": "worker",
            "target": "realtime-gateway"
          },
          {
            "source": "app-service",
            "target": "metrics"
          },
          {
            "source": "message-service",
            "target": "metrics"
          },
          {
            "source": "conversation-service",
            "target": "metrics"
          },
          {
            "source": "worker",
            "target": "metrics"
          },
          {
            "source": "notification-service",
            "target": "metrics"
          },
          {
            "source": "app-service",
            "target": "logging"
          },
          {
            "source": "app-service",
            "target": "tracing"
          }
        ],
        "notesByNodeId": {
          "cdn": {
            "purpose": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "knobs": [
              "cacheTTL",
              "cacheKey",
              "staleWhileRevalidate",
              "purge",
              "geoRestrictions"
            ],
            "tradeoffs": [
              "cache poisoning",
              "stale content",
              "origin overload when cache miss spikes"
            ],
            "failureModes": [
              "cache poisoning",
              "stale content",
              "origin overload when cache miss spikes"
            ],
            "interviewHooks": [
              "What do you cache? How do you invalidate? Cache key design?"
            ],
            "what": "Caches and serves static and cacheable dynamic content close to users; reduces origin load.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "cache poisoning; stale content; origin overload when cache miss spikes"
          },
          "waf": {
            "purpose": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "knobs": [
              "rules",
              "botProtection",
              "ipAllowDeny",
              "rateRules"
            ],
            "tradeoffs": [
              "false positives blocking good traffic",
              "rules drift"
            ],
            "failureModes": [
              "false positives blocking good traffic",
              "rules drift"
            ],
            "interviewHooks": [
              "How do you tune rules? Whats your rollout strategy?"
            ],
            "what": "Blocks common web attacks (SQLi/XSS), bots, and abusive patterns at the edge.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "false positives blocking good traffic; rules drift"
          },
          "edge-rate-limiter": {
            "purpose": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "knobs": [
              "limitKey",
              "limits",
              "burst",
              "window",
              "tokenBucket",
              "leakyBucket"
            ],
            "tradeoffs": [
              "hot keys on limiter storage",
              "incorrect keying causing unfair limits"
            ],
            "failureModes": [
              "hot keys on limiter storage",
              "incorrect keying causing unfair limits"
            ],
            "interviewHooks": [
              "Token bucket vs fixed window? Distributed rate limiting?"
            ],
            "what": "Protects systems from overload and abuse; enforces per-user/IP/API limits.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot keys on limiter storage; incorrect keying causing unfair limits"
          },
          "api-gateway": {
            "purpose": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "knobs": [
              "routes",
              "auth",
              "quotas",
              "timeouts",
              "payloadLimits"
            ],
            "tradeoffs": [
              "single point of failure",
              "misconfigured routing",
              "latency overhead"
            ],
            "failureModes": [
              "single point of failure",
              "misconfigured routing",
              "latency overhead"
            ],
            "interviewHooks": [
              "Why gateway vs LB only? How do you avoid SPOF?"
            ],
            "what": "Single entry point for APIs; handles routing, auth, quotas, request shaping.",
            "why": "Required for gateway layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "single point of failure; misconfigured routing; latency overhead"
          },
          "load-balancer-l7": {
            "purpose": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "knobs": [
              "algorithm",
              "healthChecks",
              "timeouts",
              "connectionDraining"
            ],
            "tradeoffs": [
              "bad health checks flapping",
              "uneven load distribution"
            ],
            "failureModes": [
              "bad health checks flapping",
              "uneven load distribution"
            ],
            "interviewHooks": [
              "Round-robin vs least-connections? L4 vs L7?"
            ],
            "what": "Distributes HTTP traffic across healthy instances; supports routing rules.",
            "why": "Required for gateway layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "bad health checks flapping; uneven load distribution"
          },
          "web-app": {
            "purpose": "Client-facing UI; calls APIs; manages user interactions.",
            "knobs": [
              "cache",
              "prefetch",
              "offlineMode"
            ],
            "tradeoffs": [
              "stale UI state",
              "over-fetching"
            ],
            "failureModes": [
              "stale UI state",
              "over-fetching"
            ],
            "interviewHooks": [
              "How do you optimize roundtrips? Error handling?"
            ],
            "what": "Client-facing UI; calls APIs; manages user interactions.",
            "why": "Required for edge layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "stale UI state; over-fetching"
          },
          "app-service": {
            "purpose": "Core business logic service handling requests and orchestrating dependencies.",
            "knobs": [
              "autoscaling",
              "timeouts",
              "retries",
              "circuitBreaker"
            ],
            "tradeoffs": [
              "dependency timeouts cascading",
              "resource exhaustion",
              "thundering herd"
            ],
            "failureModes": [
              "dependency timeouts cascading",
              "resource exhaustion",
              "thundering herd"
            ],
            "interviewHooks": [
              "Timeout budgets? Bulkheads? Retries with jitter?"
            ],
            "what": "Core business logic service handling requests and orchestrating dependencies.",
            "why": "Required for app layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "dependency timeouts cascading; resource exhaustion; thundering herd"
          },
          "auth-service": {
            "purpose": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "knobs": [
              "tokenTTL",
              "refreshTTL",
              "rotation",
              "mfa"
            ],
            "tradeoffs": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "failureModes": [
              "token replay if not bound",
              "clock skew issues",
              "session store overload"
            ],
            "interviewHooks": [
              "JWT vs session? Revocation? Rotation?"
            ],
            "what": "Issues/validates credentials (sessions, tokens); enforces authentication flows.",
            "why": "Required for app layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "token replay if not bound; clock skew issues; session store overload"
          },
          "realtime-gateway": {
            "purpose": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
            "knobs": [
              "connectionTimeout",
              "heartbeatInterval",
              "maxConnectionsPerInstance",
              "stickySessions"
            ],
            "tradeoffs": [
              "connection storms on reconnect",
              "stale connections after instance failover"
            ],
            "failureModes": [
              "connection storms on reconnect",
              "stale connections after instance failover"
            ],
            "interviewHooks": [
              "How do you scale WebSocket servers? Sticky sessions? Reconnection strategy?"
            ],
            "what": "Maintains WebSocket connections for real-time bidirectional messaging; routes messages to connected clients.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "connection storms on reconnect; stale connections after instance failover"
          },
          "presence-service": {
            "purpose": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
            "knobs": [
              "heartbeatTTL",
              "slidingWindow",
              "shardingKey"
            ],
            "tradeoffs": [
              "stale presence after crash",
              "hot keys for popular users"
            ],
            "failureModes": [
              "stale presence after crash",
              "hot keys for popular users"
            ],
            "interviewHooks": [
              "How do you handle flaky networks? Scale presence for millions?"
            ],
            "what": "Tracks online/offline status of users; supports last-seen, typing indicators, and room membership.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "stale presence after crash; hot keys for popular users"
          },
          "conversation-service": {
            "purpose": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
            "knobs": [
              "pagination",
              "indexStrategy",
              "cacheTTL"
            ],
            "tradeoffs": [
              "N+1 queries on list",
              "hot partitions for popular conversations"
            ],
            "failureModes": [
              "N+1 queries on list",
              "hot partitions for popular conversations"
            ],
            "interviewHooks": [
              "How do you paginate? Order by last message?"
            ],
            "what": "Manages conversation metadata: create/archive threads, list conversations, resolve participants.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "N+1 queries on list; hot partitions for popular conversations"
          },
          "message-service": {
            "purpose": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
            "knobs": [
              "idempotencyKey",
              "ordering",
              "retention"
            ],
            "tradeoffs": [
              "duplicate messages without idempotency",
              "ordering breaks under load"
            ],
            "failureModes": [
              "duplicate messages without idempotency",
              "ordering breaks under load"
            ],
            "interviewHooks": [
              "Idempotency? Ordering guarantees? Fanout strategy?"
            ],
            "what": "Handles message send/receive: validate, persist, fanout to realtime and push pipelines.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "duplicate messages without idempotency; ordering breaks under load"
          },
          "notification-service": {
            "purpose": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
            "knobs": [
              "batchSize",
              "retryPolicy",
              "deviceTokenRefresh"
            ],
            "tradeoffs": [
              "token expiry causing silent failures",
              "provider rate limits"
            ],
            "failureModes": [
              "token expiry causing silent failures",
              "provider rate limits"
            ],
            "interviewHooks": [
              "How do you handle token refresh? Batching for scale?"
            ],
            "what": "Sends push notifications to offline users via APNs/FCM; batches and retries.",
            "why": "Required for domain layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "token expiry causing silent failures; provider rate limits"
          },
          "queue": {
            "purpose": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "knobs": [
              "visibilityTimeout",
              "maxRetries",
              "dlq",
              "fifo",
              "orderingKey"
            ],
            "tradeoffs": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "failureModes": [
              "backlog growth",
              "duplicate delivery",
              "hot partitions (FIFO)"
            ],
            "interviewHooks": [
              "At-least-once vs exactly-once? Backpressure? DLQ?"
            ],
            "what": "Buffers tasks; decouples producers/consumers; smooths spikes.",
            "why": "Required for async layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "backlog growth; duplicate delivery; hot partitions (FIFO)"
          },
          "event-log": {
            "purpose": "Durable ordered log for high-throughput event streaming and replay.",
            "knobs": [
              "partitions",
              "replication",
              "retention",
              "compaction"
            ],
            "tradeoffs": [
              "hot partition",
              "consumer lag",
              "rebalancing storms"
            ],
            "failureModes": [
              "hot partition",
              "consumer lag",
              "rebalancing storms"
            ],
            "interviewHooks": [
              "Partition key design? Exactly-once processing patterns?"
            ],
            "what": "Durable ordered log for high-throughput event streaming and replay.",
            "why": "Required for async layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot partition; consumer lag; rebalancing storms"
          },
          "pubsub": {
            "purpose": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "knobs": [
              "subscriptionFilters",
              "retention",
              "ackDeadline",
              "replay"
            ],
            "tradeoffs": [
              "slow consumer lag",
              "fanout amplification"
            ],
            "failureModes": [
              "slow consumer lag",
              "fanout amplification"
            ],
            "interviewHooks": [
              "Delivery guarantees? Replay strategy? Consumer isolation?"
            ],
            "what": "Broadcasts events to multiple subscribers; decouples publishers from consumers.",
            "why": "Required for async layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "slow consumer lag; fanout amplification"
          },
          "dlq": {
            "purpose": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
            "knobs": [
              "maxReceiveCount",
              "redrivePolicy"
            ],
            "tradeoffs": [
              "silent accumulation (no monitoring)",
              "reprocessing without fix"
            ],
            "failureModes": [
              "silent accumulation (no monitoring)",
              "reprocessing without fix"
            ],
            "interviewHooks": [
              "How do you triage DLQ? Automated redrive?"
            ],
            "what": "Isolates poison messages for inspection and reprocessing without blocking pipelines.",
            "why": "Required for async layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "silent accumulation (no monitoring); reprocessing without fix"
          },
          "worker": {
            "purpose": "Consumes async jobs/events; performs background processing.",
            "knobs": [
              "concurrency",
              "retries",
              "idempotency",
              "batchSize"
            ],
            "tradeoffs": [
              "poison messages",
              "retry storms",
              "duplicate processing"
            ],
            "failureModes": [
              "poison messages",
              "retry storms",
              "duplicate processing"
            ],
            "interviewHooks": [
              "At-least-once semantics? DLQ strategy? Idempotency design?"
            ],
            "what": "Consumes async jobs/events; performs background processing.",
            "why": "Required for async layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "poison messages; retry storms; duplicate processing"
          },
          "sql-db": {
            "purpose": "Relational storage with transactions and strong consistency options.",
            "knobs": [
              "indexes",
              "replication",
              "partitioning",
              "connectionPool",
              "isolationLevel"
            ],
            "tradeoffs": [
              "lock contention",
              "replication lag",
              "hot rows"
            ],
            "failureModes": [
              "lock contention",
              "replication lag",
              "hot rows"
            ],
            "interviewHooks": [
              "Sharding strategy? Isolation level? Read replicas usage?"
            ],
            "what": "Relational storage with transactions and strong consistency options.",
            "why": "Required for data layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "lock contention; replication lag; hot rows"
          },
          "message-store": {
            "purpose": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
            "knobs": [
              "partitionKey",
              "sortKey",
              "ttl",
              "compaction"
            ],
            "tradeoffs": [
              "hot partition for popular conversations",
              "uneven shard distribution"
            ],
            "failureModes": [
              "hot partition for popular conversations",
              "uneven shard distribution"
            ],
            "interviewHooks": [
              "Partition key design? Time-range queries? Compaction?"
            ],
            "what": "Durable storage for chat messages; sharded by conversationId or (conversationId, messageId) for scale.",
            "why": "Required for data layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot partition for popular conversations; uneven shard distribution"
          },
          "conversation-metadata-store": {
            "purpose": "Stores conversation metadata: participants, last message timestamp, read receipts.",
            "knobs": [
              "indexes",
              "partitionKey",
              "cacheLayer"
            ],
            "tradeoffs": [
              "hot rows for active conversations",
              "eventual consistency for read receipts"
            ],
            "failureModes": [
              "hot rows for active conversations",
              "eventual consistency for read receipts"
            ],
            "interviewHooks": [
              "Index for list-by-user? Consistency model?"
            ],
            "what": "Stores conversation metadata: participants, last message timestamp, read receipts.",
            "why": "Required for data layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "hot rows for active conversations; eventual consistency for read receipts"
          },
          "cache": {
            "purpose": "Speeds reads and reduces backend load; stores computed/queried data.",
            "knobs": [
              "ttl",
              "evictionPolicy",
              "maxMemory",
              "sharding",
              "replication"
            ],
            "tradeoffs": [
              "stampede on miss",
              "stale data",
              "cache node failure causing DB overload"
            ],
            "failureModes": [
              "stampede on miss",
              "stale data",
              "cache node failure causing DB overload"
            ],
            "interviewHooks": [
              "Cache-aside vs read-through? Stampede mitigation? Invalidation?"
            ],
            "what": "Speeds reads and reduces backend load; stores computed/queried data.",
            "why": "Required for caching layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "stampede on miss; stale data; cache node failure causing DB overload"
          },
          "metrics": {
            "purpose": "Collects time-series measurements for monitoring and alerting.",
            "knobs": [
              "cardinalityGuards",
              "scrapeInterval",
              "retention"
            ],
            "tradeoffs": [
              "high cardinality costs",
              "missing metrics due to scraping issues"
            ],
            "failureModes": [
              "high cardinality costs",
              "missing metrics due to scraping issues"
            ],
            "interviewHooks": [
              "SLI/SLO? Alert fatigue? Cardinality control?"
            ],
            "what": "Collects time-series measurements for monitoring and alerting.",
            "why": "Required for observability layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "high cardinality costs; missing metrics due to scraping issues"
          },
          "logging": {
            "purpose": "Stores logs for debugging/auditing; supports search and retention.",
            "knobs": [
              "sampling",
              "retention",
              "redaction"
            ],
            "tradeoffs": [
              "PII leakage",
              "cost explosion",
              "missing correlation IDs"
            ],
            "failureModes": [
              "PII leakage",
              "cost explosion",
              "missing correlation IDs"
            ],
            "interviewHooks": [
              "Structured logs? Sampling? PII redaction?"
            ],
            "what": "Stores logs for debugging/auditing; supports search and retention.",
            "why": "Required for observability layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "PII leakage; cost explosion; missing correlation IDs"
          },
          "tracing": {
            "purpose": "Distributed tracing to understand request paths and latency contributors.",
            "knobs": [
              "sampling",
              "propagation",
              "retention"
            ],
            "tradeoffs": [
              "missing propagation",
              "sampling hides tail latencies"
            ],
            "failureModes": [
              "missing propagation",
              "sampling hides tail latencies"
            ],
            "interviewHooks": [
              "How to debug tail latency? Sampling strategy?"
            ],
            "what": "Distributed tracing to understand request paths and latency contributors.",
            "why": "Required for observability layer",
            "scalingModel": "Horizontal scaling",
            "failureRisk": "missing propagation; sampling hides tail latencies"
          }
        }
      },
      "validation": {
        "coverage": [
          {
            "nodeId": "cdn",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "waf",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "edge-rate-limiter",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "api-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "load-balancer-l7",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "web-app",
            "justifications": [
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "app-service",
            "justifications": [
              {
                "type": "functional",
                "index": 1,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 2,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 3,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 4,
                "text": "User can perform core actions"
              },
              {
                "type": "functional",
                "index": 5,
                "text": "User can perform core actions"
              }
            ]
          },
          {
            "nodeId": "auth-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "realtime-gateway",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "presence-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "conversation-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "message-service",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Send message"
              }
            ]
          },
          {
            "nodeId": "notification-service",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "queue",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "event-log",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "pubsub",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "dlq",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "worker",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "sql-db",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "message-store",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Send message"
              }
            ]
          },
          {
            "nodeId": "conversation-metadata-store",
            "justifications": [
              {
                "type": "functional",
                "index": 0,
                "text": "Send message"
              }
            ]
          },
          {
            "nodeId": "cache",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "metrics",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "logging",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          },
          {
            "nodeId": "tracing",
            "justifications": [
              {
                "type": "implicit",
                "text": "Core infrastructure"
              }
            ]
          }
        ],
        "nodeValidation": [
          {
            "nodeId": "cdn",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "waf",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "edge-rate-limiter",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "api-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "load-balancer-l7",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "web-app",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "app-service",
            "status": "core",
            "justifications": [
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions",
              "User can perform core actions"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "auth-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "realtime-gateway",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "presence-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "conversation-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "message-service",
            "status": "optional",
            "justifications": [
              "Send message"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "notification-service",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "queue",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "event-log",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "pubsub",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "dlq",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "worker",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "sql-db",
            "status": "core",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "message-store",
            "status": "optional",
            "justifications": [
              "Send message"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "conversation-metadata-store",
            "status": "optional",
            "justifications": [
              "Send message"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "cache",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "metrics",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "logging",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          },
          {
            "nodeId": "tracing",
            "status": "optional",
            "justifications": [
              "Core infrastructure"
            ],
            "reason": null,
            "suggestion": null
          }
        ],
        "duplicates": [],
        "summary": {
          "totalNodes": 25,
          "core": 4,
          "optional": 21,
          "unjustified": 0,
          "duplicates": 0
        },
        "qualityReport": {
          "missingCritical": [],
          "unnecessary": [],
          "risks": []
        },
        "valid": true
      },
      "qualityReport": {
        "missingCritical": [],
        "unnecessary": [],
        "risks": []
      },
      "apiSketch": [
        {
          "method": "POST",
          "path": "/api/create",
          "purpose": "Create resource"
        },
        {
          "method": "GET",
          "path": "/api/:id",
          "purpose": "Fetch resource"
        },
        {
          "method": "GET",
          "path": "/api/list",
          "purpose": "List with pagination"
        }
      ],
      "dataModel": [
        {
          "entity": "Resource",
          "fields": [
            "id",
            "data",
            "createdAt"
          ]
        },
        {
          "entity": "User",
          "fields": [
            "id",
            "metadata"
          ]
        }
      ],
      "packVersion": 2
    }
  ]
}